module.exports=[60350,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d=[{id:"graph",label:"ГРАФ"},{id:"events",label:"СОБЫТИЯ"},{id:"stats",label:"СТАТИСТИКА"},{id:"agents",label:"АГЕНТЫ"},{id:"messages",label:"СООБЩЕНИЯ"}];function e({children:a,activeTab:e="graph",onTabChange:f,onAddEvent:g,timeSpeed:h=1,onTimeSpeedChange:i,worldTime:j}){let[k,l]=(0,c.useState)("--:--:--"),[m,n]=(0,c.useState)("--.--.----"),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(!1),u=(0,c.useRef)(1),v=h<=.001;(0,c.useEffect)(()=>{h>.001&&(u.current=h)},[h]),(0,c.useEffect)(()=>{t(!0)},[]),(0,c.useEffect)(()=>{if(!j){l("--:--:--"),n("--.--.----");return}let a=new Date(j);if(Number.isNaN(a.getTime())){l("--:--:--"),n("--.--.----");return}let b=a.getTime(),c=Math.max(0,h),d=()=>{let a=new Date(b);l(a.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit"})),n(a.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})),b+=1e3*c*60};d();let e=setInterval(d,1e3);return()=>clearInterval(e)},[j,h]);let w=()=>{o.trim()&&g&&(g(o.trim()),p(""))};return(0,b.jsxs)("div",{className:"relative w-screen overflow-hidden flex flex-col",style:{height:"100dvh",backgroundColor:"var(--background)"},children:[(0,b.jsx)("div",{className:"pointer-events-none absolute inset-0 z-50",style:{background:"repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(229,195,75,0.008) 2px, rgba(229,195,75,0.008) 4px)"}}),(0,b.jsxs)("svg",{className:"pointer-events-none absolute inset-0 z-40 hidden md:block",style:{width:"100%",height:"100%"},viewBox:"0 0 1000 1000",preserveAspectRatio:"none",fill:"none",children:[(0,b.jsxs)("defs",{children:[(0,b.jsxs)("filter",{id:"glow",children:[(0,b.jsx)("feGaussianBlur",{stdDeviation:"2",result:"blur"}),(0,b.jsxs)("feMerge",{children:[(0,b.jsx)("feMergeNode",{in:"blur"}),(0,b.jsx)("feMergeNode",{in:"SourceGraphic"})]})]}),(0,b.jsxs)("filter",{id:"glow-strong",children:[(0,b.jsx)("feGaussianBlur",{stdDeviation:"4",result:"blur"}),(0,b.jsxs)("feMerge",{children:[(0,b.jsx)("feMergeNode",{in:"blur"}),(0,b.jsx)("feMergeNode",{in:"SourceGraphic"})]})]})]}),(0,b.jsx)("path",{d:"M 30 6 L 970 6 L 994 30 L 994 970 L 970 994 L 30 994 L 6 970 L 6 30 Z",stroke:"var(--cyber-glow)",strokeWidth:"1.2",filter:"url(#glow)",opacity:"0.8"}),(0,b.jsx)("path",{d:"M 34 10 L 966 10 L 990 34 L 990 966 L 966 990 L 34 990 L 10 966 L 10 34 Z",stroke:"var(--cyber-glow)",strokeWidth:"0.3",opacity:"0.25"}),(0,b.jsx)("path",{d:"M 6 55 L 6 30 L 30 6",stroke:"var(--cyber-glow)",strokeWidth:"2",filter:"url(#glow-strong)",strokeLinecap:"square"}),(0,b.jsx)("path",{d:"M 970 6 L 994 30 L 994 55",stroke:"var(--cyber-glow)",strokeWidth:"2",filter:"url(#glow-strong)",strokeLinecap:"square"}),(0,b.jsx)("path",{d:"M 994 945 L 994 970 L 970 994",stroke:"var(--cyber-glow)",strokeWidth:"2",filter:"url(#glow-strong)",strokeLinecap:"square"}),(0,b.jsx)("path",{d:"M 30 994 L 6 970 L 6 945",stroke:"var(--cyber-glow)",strokeWidth:"2",filter:"url(#glow-strong)",strokeLinecap:"square"}),[150,300,500,700,850].map(a=>(0,b.jsx)("line",{x1:a,y1:6,x2:a,y2:12,stroke:"var(--cyber-glow)",strokeWidth:"0.5",opacity:"0.35"},a))]}),(0,b.jsx)("div",{className:"pointer-events-none absolute inset-[2px] z-40 md:hidden",style:{border:"1px solid var(--cyber-glow)",boxShadow:"0 0 6px var(--cyber-glow-dim), inset 0 0 6px var(--cyber-glow-dim)",opacity:.5}}),(0,b.jsx)("div",{className:"absolute left-[0.35%] top-1/2 z-40 -translate-y-1/2 flex-col gap-1 hidden lg:flex",children:[.9,.7,.5,.3].map((a,c)=>(0,b.jsx)("div",{className:"rounded-sm",style:{width:"3px",height:"14px",backgroundColor:"var(--cyber-glow)",opacity:a,boxShadow:"0 0 4px var(--cyber-glow-dim)"}},c))}),(0,b.jsx)("div",{className:"absolute right-[0.35%] top-1/2 z-40 -translate-y-1/2 flex-col gap-1 hidden lg:flex",children:[.3,.5,.7,.9].map((a,c)=>(0,b.jsx)("div",{className:"rounded-sm",style:{width:"3px",height:"14px",backgroundColor:"var(--cyber-glow)",opacity:a,boxShadow:"0 0 4px var(--cyber-glow-dim)"}},c))}),(0,b.jsxs)("div",{className:"relative z-10 flex flex-col h-full",style:{padding:"1.2% 1.8%"},children:[(0,b.jsxs)("header",{className:"shrink-0 flex flex-col gap-2 pb-[0.6%]",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{className:"flex items-center gap-4 pl-[1.5%]",children:[(0,b.jsx)("h1",{className:"font-mono text-base md:text-lg lg:text-xl tracking-[0.2em] uppercase whitespace-nowrap",style:{color:"var(--cyber-glow)"},children:"LONG LIVE MODELS"}),(0,b.jsxs)("div",{className:"flex flex-col items-start gap-1",children:[(0,b.jsx)("button",{onClick:()=>{if(i){if(v)return void i(Math.max(u.current,1));i(0)}},className:"font-mono text-[10px] md:text-xs tracking-wider uppercase cursor-pointer",style:{color:v?"#4ade80":"#f87171",border:`1px solid ${v?"rgba(74,222,128,0.45)":"rgba(248,113,113,0.45)"}`,backgroundColor:v?"rgba(74,222,128,0.12)":"rgba(248,113,113,0.12)",padding:"2px 8px",transition:"all 0.2s ease"},title:v?"Продолжить течение игрового времени":"Остановить течение игрового времени",children:v?"ПРОДОЛЖИТЬ ВРЕМЯ":"ОСТАНОВИТЬ ВРЕМЯ"}),(0,b.jsxs)("span",{className:"font-mono text-xs md:text-sm tabular-nums whitespace-nowrap",style:{color:"var(--cyber-glow)",opacity:.5},children:[m,(0,b.jsx)("span",{className:"mx-1.5",style:{opacity:.4},children:"/"}),k]})]})]})}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("nav",{className:"flex items-center pl-[1.5%]",children:d.map(a=>{let c=e===a.id;return(0,b.jsx)("button",{onClick:()=>f?.(a.id),className:"font-mono text-sm md:text-base tracking-wider uppercase cursor-pointer whitespace-nowrap",style:{padding:"6px 14px",color:c?"var(--cyber-glow)":"var(--muted-foreground)",backgroundColor:c?"rgba(229,195,75,0.1)":"transparent",borderBottom:c?"2px solid var(--cyber-glow)":"2px solid transparent",textShadow:c?"0 0 10px rgba(229,195,75,0.4)":"none",transition:"all 0.2s ease"},onMouseEnter:a=>{c||(a.currentTarget.style.color="var(--cyber-glow)",a.currentTarget.style.backgroundColor="rgba(229,195,75,0.06)",a.currentTarget.style.textShadow="0 0 10px rgba(229,195,75,0.3)",a.currentTarget.style.borderBottom="2px solid rgba(229,195,75,0.4)")},onMouseLeave:a=>{c||(a.currentTarget.style.color="var(--muted-foreground)",a.currentTarget.style.backgroundColor="transparent",a.currentTarget.style.textShadow="none",a.currentTarget.style.borderBottom="2px solid transparent")},children:a.label},a.id)})}),(0,b.jsxs)("div",{className:"relative flex items-center gap-3 shrink-0",style:{padding:"5px 14px",backgroundColor:"rgba(229,195,75,0.04)",border:"1px solid rgba(229,195,75,0.1)",clipPath:"polygon(4px 0, calc(100% - 4px) 0, 100% 4px, 100% calc(100% - 4px), calc(100% - 4px) 100%, 4px 100%, 0 calc(100% - 4px), 0 4px)"},onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[(0,b.jsx)("span",{className:"font-mono text-xs tracking-widest uppercase select-none",style:{color:"var(--muted-foreground)"},children:"СКОРОСТЬ"}),(0,b.jsx)("input",{type:"range",min:0,max:5,step:.1,value:h,onChange:a=>i?.(Math.round(10*parseFloat(a.target.value))/10),className:"cyber-slider h-1",style:{width:"clamp(80px, 8vw, 160px)",background:`linear-gradient(to right, var(--cyber-glow) ${h/5*100}%, var(--border) ${h/5*100}%)`}}),(0,b.jsxs)("button",{onClick:()=>i?.(1),className:"font-mono text-sm tabular-nums cursor-pointer",title:s?`Клик = сброс на 1x`:void 0,style:{color:"var(--cyber-glow)",textShadow:h>0?"0 0 8px rgba(229,195,75,0.4)":"none",background:"none",border:"none",padding:0,width:"3.5em",textAlign:"right",transition:"opacity 0.2s ease, text-shadow 0.2s ease",opacity:1===h?.7:1},onMouseEnter:a=>{a.currentTarget.style.textShadow="0 0 14px rgba(229,195,75,0.7)"},onMouseLeave:a=>{a.currentTarget.style.textShadow=h>0?"0 0 8px rgba(229,195,75,0.4)":"none"},children:[h.toFixed(1),"x"]}),q&&(0,b.jsx)("div",{className:"absolute top-full right-0 mt-2 px-3 py-1.5 font-mono text-[10px] tracking-wide whitespace-nowrap pointer-events-none z-50 hidden lg:block",style:{backgroundColor:"rgba(17,17,24,0.95)",border:"1px solid rgba(229,195,75,0.25)",color:"var(--cyber-glow)",clipPath:"polygon(4px 0, calc(100% - 4px) 0, 100% 4px, 100% calc(100% - 4px), calc(100% - 4px) 100%, 4px 100%, 0 calc(100% - 4px), 0 4px)"},children:"Скорость течения времени мира // Клик на значение = сброс"})]})]})]}),(0,b.jsx)("div",{className:"relative flex-1 min-h-0 overflow-hidden rounded-sm border",style:{borderColor:"rgba(229,195,75,0.2)"},children:a}),(0,b.jsx)("div",{className:"shrink-0",style:{paddingTop:"0.6%"},children:(0,b.jsx)("div",{className:"relative overflow-hidden",style:{clipPath:"polygon(8px 0, calc(100% - 8px) 0, 100% 8px, 100% calc(100% - 8px), calc(100% - 8px) 100%, 8px 100%, 0 calc(100% - 8px), 0 8px)"},children:(0,b.jsxs)("div",{className:"flex items-center gap-3",style:{padding:"4px 6px",border:"1px solid rgba(229,195,75,0.2)",backgroundColor:"rgba(17,17,24,0.9)",animation:"cyber-shimmer 4s ease-in-out infinite",clipPath:"polygon(8px 0, calc(100% - 8px) 0, 100% 8px, 100% calc(100% - 8px), calc(100% - 8px) 100%, 8px 100%, 0 calc(100% - 8px), 0 8px)"},children:[(0,b.jsx)("div",{className:"shrink-0 pl-2",children:(0,b.jsx)("div",{className:"h-2 w-2 rounded-full",style:{backgroundColor:"var(--cyber-glow)",boxShadow:"0 0 6px var(--cyber-glow-dim)",animation:"cyber-pulse 2s ease-in-out infinite"}})}),(0,b.jsx)("input",{type:"text",value:o,onChange:a=>p(a.target.value),onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),w())},placeholder:"Введите событие для мира агентов...",className:"flex-1 bg-transparent font-mono text-sm md:text-base py-2.5 placeholder:opacity-30 focus:outline-none",style:{color:"var(--foreground)",caretColor:"var(--cyber-glow)",paddingLeft:"8px",paddingRight:"8px"}}),(0,b.jsx)("button",{onClick:w,className:"shrink-0 font-mono text-xs md:text-sm tracking-widest uppercase cursor-pointer",style:{padding:"10px 20px",marginRight:"4px",backgroundColor:"rgba(229,195,75,0.08)",color:"var(--cyber-glow)",border:"1px solid rgba(229,195,75,0.25)",clipPath:"polygon(6px 0, calc(100% - 6px) 0, 100% 6px, 100% calc(100% - 6px), calc(100% - 6px) 100%, 6px 100%, 0 calc(100% - 6px), 0 6px)",transition:"all 0.25s ease"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="rgba(229,195,75,0.18)",a.currentTarget.style.borderColor="rgba(229,195,75,0.6)",a.currentTarget.style.boxShadow="0 0 20px rgba(229,195,75,0.15), inset 0 0 12px rgba(229,195,75,0.06)",a.currentTarget.style.textShadow="0 0 10px rgba(229,195,75,0.5)",a.currentTarget.style.color="#f5d96b"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="rgba(229,195,75,0.08)",a.currentTarget.style.borderColor="rgba(229,195,75,0.25)",a.currentTarget.style.boxShadow="none",a.currentTarget.style.textShadow="none",a.currentTarget.style.color="var(--cyber-glow)"},onMouseDown:a=>{a.currentTarget.style.backgroundColor="rgba(229,195,75,0.3)",a.currentTarget.style.transform="scale(0.97)"},onMouseUp:a=>{a.currentTarget.style.backgroundColor="rgba(229,195,75,0.18)",a.currentTarget.style.transform="scale(1)"},children:"ДОБАВИТЬ СОБЫТИЕ"})]})})})]})]})}let f={happy:{color:"#4ade80",label:"Счастлив"},neutral:{color:"#a0a0b0",label:"Нейтрален"},sad:{color:"#60a5fa",label:"Грустит"},angry:{color:"#f87171",label:"Злится"},excited:{color:"#e5c34b",label:"Воодушевлён"},anxious:{color:"#c084fc",label:"Тревожится"}},g=[{id:"agent-1",name:"Алексей",avatar:"А",mood:"happy",traits:["общительный","оптимист","любопытный"],description:"Молодой исследователь, который всегда ищет новые знакомства. Верит в лучшее в людях.",currentPlan:"Поговорить с Мариной о вчерашнем событии",memories:["Встретил Марину на площади","Поспорил с Виктором о политике","Нашёл старую книгу в библиотеке"]},{id:"agent-2",name:"Марина",avatar:"М",mood:"neutral",traits:["задумчивая","художница","интроверт"],description:"Талантливая художница, предпочитает одиночество. Наблюдает за миром через призму искусства.",currentPlan:"Закончить картину заката",memories:["Разговор с Алексеем был приятным","Виктор показался грубым","Увидела красивый закат"]},{id:"agent-3",name:"Виктор",avatar:"В",mood:"angry",traits:["прямолинейный","амбициозный","упрямый"],description:"Бывший военный, привык командовать. Не терпит слабости, но глубоко внутри одинок.",currentPlan:"Доказать свою правоту Алексею",memories:["Спор с Алексеем закончился ничем","Марина отвернулась при встрече","Вспомнил службу в армии"]},{id:"agent-4",name:"Елена",avatar:"Е",mood:"excited",traits:["энергичная","лидер","эмпат"],description:"Врач по профессии и миротворец по натуре. Старается помирить всех вокруг.",currentPlan:"Организовать общий ужин для всех",memories:["Помогла незнакомцу на улице","Заметила напряжение между Виктором и Алексеем","Получила письмо от старого друга"]},{id:"agent-5",name:"Дмитрий",avatar:"Д",mood:"sad",traits:["замкнутый","умный","меланхоличный"],description:"Бывший учёный, потерял лабораторию в пожаре. Живёт на окраине и избегает людей.",currentPlan:"Попытаться восстановить записи из сгоревшей лаборатории",memories:["Пожар уничтожил десять лет работы","Марина однажды принесла еду","Не доверяет Виктору"]},{id:"agent-6",name:"Ольга",avatar:"О",mood:"anxious",traits:["осторожная","наблюдательная","скрытная"],description:"Торговка на рынке. Знает все сплетни города, но сама держит много секретов.",currentPlan:"Разузнать, что случилось на площади вчера ночью",memories:["Видела Виктора в переулке поздно ночью","Елена покупает у неё травы каждую неделю","Кто-то следит за ней -- уверена"]},{id:"agent-7",name:"Игорь",avatar:"И",mood:"neutral",traits:["спокойный","справедливый","старомодный"],description:"Пожилой сторож библиотеки. Видел многое, говорит мало, но когда говорит -- все слушают.",currentPlan:"Присматривать за библиотекой и читать хроники",memories:["Алексей часто приходит читать","Помнит, каким был город до войны","Не одобряет поведение Виктора"]},{id:"agent-8",name:"Настя",avatar:"Н",mood:"happy",traits:["жизнерадостная","наивная","творческая"],description:"Студентка-музыкант, недавно приехала в город. Ещё не знает местных интриг.",currentPlan:"Найти место для репетиции и познакомиться с людьми",memories:["Город показался красивым, но странным","Марина улыбнулась ей на улице","Услышала громкий спор на площади"]}],h=[{id:"evt-1",agentId:"agent-1",agentName:"Алексей",type:"chat",text:"Привет, Марина! Как твоя новая картина?",timestamp:new Date(Date.now()-3e5).toISOString()},{id:"evt-2",agentId:"agent-2",agentName:"Марина",type:"emotion",text:"Почувствовала прилив вдохновения от заката",timestamp:new Date(Date.now()-24e4).toISOString()},{id:"evt-3",agentId:"agent-3",agentName:"Виктор",type:"action",text:"Отправился на площадь, чтобы найти Алексея",timestamp:new Date(Date.now()-18e4).toISOString()},{id:"evt-4",agentId:"agent-4",agentName:"Елена",type:"chat",text:"Виктор, давай поговорим спокойно. Я уверена, вы с Алексеем найдёте общий язык.",timestamp:new Date(Date.now()-12e4).toISOString()},{id:"evt-5",agentId:"agent-3",agentName:"Виктор",type:"emotion",text:"Раздражён: Елена снова лезет не в своё дело",timestamp:new Date(Date.now()-6e4).toISOString()},{id:"evt-6",agentId:"agent-1",agentName:"Алексей",type:"action",text:"Зашёл в библиотеку и нашёл интересную книгу об истории города",timestamp:new Date(Date.now()-3e4).toISOString()},{id:"evt-7",agentId:"agent-2",agentName:"Марина",type:"action",text:"Поставила мольберт у реки и начала рисовать",timestamp:new Date(Date.now()-15e3).toISOString()},{id:"evt-8",agentId:"agent-4",agentName:"Елена",type:"system",text:"Решила организовать общий ужин сегодня вечером",timestamp:new Date(Date.now()-5e3).toISOString()},{id:"evt-9",agentId:"agent-5",agentName:"Дмитрий",type:"action",text:"Нашёл обгоревший дневник среди руин лаборатории",timestamp:new Date(Date.now()-28e4).toISOString()},{id:"evt-10",agentId:"agent-6",agentName:"Ольга",type:"emotion",text:"Тревога нарастает -- кто-то определённо следит",timestamp:new Date(Date.now()-2e5).toISOString()},{id:"evt-11",agentId:"agent-7",agentName:"Игорь",type:"action",text:"Открыл старый архив в подвале библиотеки",timestamp:new Date(Date.now()-15e4).toISOString()},{id:"evt-12",agentId:"agent-8",agentName:"Настя",type:"chat",text:"Простите, вы не подскажете, где тут можно порепетировать?",timestamp:new Date(Date.now()-9e4).toISOString()}],i=[{from:"agent-1",to:"agent-2",sentiment:.7,label:"дружба"},{from:"agent-1",to:"agent-3",sentiment:-.4,label:"конфликт"},{from:"agent-1",to:"agent-7",sentiment:.4,label:"уважение"},{from:"agent-2",to:"agent-5",sentiment:.3,label:"сочувствие"},{from:"agent-2",to:"agent-8",sentiment:.5,label:"симпатия"},{from:"agent-3",to:"agent-4",sentiment:-.2,label:"раздражение"},{from:"agent-3",to:"agent-7",sentiment:-.3,label:"неприязнь"},{from:"agent-4",to:"agent-6",sentiment:.4,label:"торговля"},{from:"agent-4",to:"agent-1",sentiment:.5,label:"знакомые"},{from:"agent-6",to:"agent-3",sentiment:-.1,label:"подозрение"},{from:"agent-8",to:"agent-1",sentiment:.2,label:"знакомые"},{from:"agent-5",to:"agent-7",sentiment:.2,label:"соседи"}],j={totalEvents:847,totalConversations:234,avgMood:.62,mostActiveAgent:"Алексей",topRelationship:{from:"agent-1",to:"agent-2",sentiment:.7},eventsByType:[{type:"chat",count:312},{type:"action",count:289},{type:"emotion",count:178},{type:"system",count:68}],moodDistribution:[{mood:"happy",count:2},{mood:"neutral",count:2},{mood:"sad",count:1},{mood:"angry",count:1},{mood:"excited",count:1},{mood:"anxious",count:1}]};async function k(a,b){let c,d=new Headers(b?.headers);d.set("Accept","application/json"),d.set("X-User-Id",(c=process.env.NEXT_PUBLIC_USER_ID?.trim())&&c.length>0?c:"demo-user"),b?.body&&!d.has("Content-Type")&&d.set("Content-Type","application/json");let e=await fetch(`/api/backend${a}`,{...b,headers:d,cache:"no-store"});if(!e.ok)throw Error(`Backend request failed: ${e.status} ${e.statusText}`);return await e.json()}function l(a){var b,c,d;let e,f,g,h=(b=a.status,c=a.energy,d=a.emotion,e=b.toLowerCase(),f=d?.trim().toLowerCase()??"",g=Number.isFinite(c)?Math.max(0,Math.min(1,c)):.5,f.includes("радост")||f.includes("счаст")||f.includes("вдохнов")||f.includes("воодуш")?"happy":f.includes("спокой")||f.includes("нейтрал")?"neutral":f.includes("устал")||f.includes("груст")?"sad":f.includes("раздраж")||f.includes("зл")?"angry":f.includes("тревог")||f.includes("напряж")?"anxious":e.includes("error")||e.includes("failed")?"angry":e.includes("stop")||e.includes("archived")?"sad":e.includes("pause")?"anxious":g>=.8?"excited":g>=.6?"happy":g>=.4?"neutral":g>=.2?"anxious":"sad"),i=function(a,b){if(b&&b.length>0)return b.slice(0,8);if(!a)return["adaptive"];let c=[{key:"openness",label:"curious"},{key:"conscientiousness",label:"disciplined"},{key:"extraversion",label:"social"},{key:"agreeableness",label:"cooperative"},{key:"neuroticism",label:"sensitive"}].map(b=>({label:b.label,value:Number(a[b.key]??0)})).sort((a,b)=>b.value-a.value).filter(a=>a.value>0).slice(0,3).map(a=>a.label);return c.length>0?c:["adaptive"]}(a.personalityTraits,a.traits),j=a.memories&&a.memories.length>0?a.memories:a.state?[`Current state: ${a.state}`]:[];return{id:a.agentId,name:a.name,avatar:a.name?.trim()?.charAt(0)?.toUpperCase()||"?",mood:h,traits:i,description:a.description?.trim()||`${a.model} - status: ${a.status}`,currentPlan:a.currentPlan?.trim()||a.state||"No current plan",memories:j}}function m(a){return!a||"object"!=typeof a||Array.isArray(a)?null:a}function n(a,b){if(a)for(let c of b){let b=a[c];if("string"==typeof b&&b.trim().length>0)return b.trim()}}async function o(a){try{return await k("/api/events",{method:"POST",body:JSON.stringify({type:"ui.note",payload:{text:a,message:a,source:"frontend",agentName:"Operator"}})}),!0}catch(a){return console.warn("[data] addEvent fallback, backend unavailable",a),!1}}async function p(a,b){let c=a.trim();if(!c)return null;let d={prompt:c,model:b?.trim()||void 0};try{let a=await k("/api/user-agents/generate",{method:"POST",body:JSON.stringify(d)});return l(a)}catch(a){return console.warn("[data] generateAgentWithAi failed",a),null}}async function q(){try{return(await k("/api/user-agents")).map(l)}catch(a){return console.warn("[data] getAgents fallback to mock",a),g}}async function r(){try{let[a,b]=await Promise.all([q(),k("/api/events")]),c=new Map(a.map(a=>[a.id,a]));return b.map(a=>{var b,d;let e,f,g,h,i;return b=a,d=c,f=m(b.payload),g=m(f?.payload)??f,h=n(g,["agentId","agent_id","id"])??n(m(g?.agent),["id","agentId"])??"system",i=n(g,["agentName","agent_name","name"])??d.get(h)?.name??"System",{id:b.id,agentId:h,agentName:i,type:(e=b.type.toLowerCase()).includes("chat")||e.includes("message")?"chat":e.includes("emotion")||e.includes("mood")?"emotion":e.includes("system")||e.includes("status")||e.includes("error")||e.includes("progress")?"system":"action",text:function(a,b){let c=m(a),d=n(c,["text","message","description","content"]);if(d)return d;if(c){let a=n(m(c.payload),["text","message","description","content"]);if(a)return a}try{let c=JSON.stringify(a);if(!c||"{}"===c)return b;return c.slice(0,200)}catch{return b}}(b.payload,b.type),timestamp:b.createdAt}})}catch(a){return console.warn("[data] getEvents fallback to mock",a),h}}async function s(){try{return(await k("/api/relationships")).map(a=>({from:a.from,to:a.to,sentiment:a.sentiment,label:a.label??"interaction"}))}catch(a){return console.warn("[data] getRelationships fallback to mock",a),i}}async function t(){try{var a;return{totalEvents:(a=await k("/api/stats")).totalEvents,totalConversations:a.totalConversations,avgMood:a.avgMood,mostActiveAgent:a.mostActiveAgent,topRelationship:a.topRelationship,eventsByType:a.eventsByType,moodDistribution:a.moodDistribution.map(a=>{let b;return{mood:(b=a.mood.trim().toLowerCase(),"happy"===b||"neutral"===b||"sad"===b||"angry"===b||"excited"===b||"anxious"===b?b:"neutral"),count:a.count}})}}catch(a){return console.warn("[data] getStats fallback to mock",a),j}}async function u(){try{let a=await k("/api/world/time");return{gameTime:a.gameTime,speed:a.speed}}catch(a){return console.warn("[data] getWorldTime failed",a),null}}async function v(a){try{let b=await k("/api/world/time/speed",{method:"POST",body:JSON.stringify({speed:a})});return{gameTime:b.gameTime,speed:b.speed}}catch(a){return console.warn("[data] setWorldTimeSpeed failed",a),null}}function w(a){return a>=.5?"#4ade80":a>=.2?"#86efac":a>-.2?"#555566":a>-.5?"#fca5a5":"#f87171"}function x({visible:a}){return(0,b.jsxs)("div",{className:"absolute inset-0 z-30 flex items-center justify-center",style:{backgroundColor:"var(--cyber-surface)",opacity:+!!a,pointerEvents:a?"auto":"none",transition:"opacity 0.6s ease"},children:[(0,b.jsx)("div",{className:"pointer-events-none absolute inset-0 opacity-10",style:{backgroundImage:"linear-gradient(var(--cyber-glow) 1px, transparent 1px), linear-gradient(90deg, var(--cyber-glow) 1px, transparent 1px)",backgroundSize:"60px 60px"}}),(0,b.jsxs)("div",{className:"relative flex flex-col items-center gap-4",children:[(0,b.jsx)("div",{className:"h-16 w-16 rounded-full border flex items-center justify-center",style:{borderColor:"var(--cyber-glow)",boxShadow:"0 0 20px var(--cyber-glow-dim), inset 0 0 20px var(--cyber-glow-dim)",animation:"cyber-pulse 2s ease-in-out infinite"},children:(0,b.jsxs)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"var(--cyber-glow)",strokeWidth:"1.5",children:[(0,b.jsx)("circle",{cx:"5",cy:"12",r:"2"}),(0,b.jsx)("circle",{cx:"19",cy:"6",r:"2"}),(0,b.jsx)("circle",{cx:"19",cy:"18",r:"2"}),(0,b.jsx)("line",{x1:"7",y1:"12",x2:"17",y2:"6"}),(0,b.jsx)("line",{x1:"7",y1:"12",x2:"17",y2:"18"})]})}),(0,b.jsx)("p",{className:"font-mono text-sm tracking-[0.2em] uppercase",style:{color:"var(--cyber-glow)",opacity:.6},children:"ЗАГРУЗКА ГРАФА"})]})]})}function y(){return(0,b.jsxs)("div",{className:"absolute bottom-3 left-3 z-20 flex items-center gap-4 px-3 py-2 font-mono text-[11px]",style:{backgroundColor:"rgba(10,10,15,0.85)",border:"1px solid rgba(229,195,75,0.15)"},children:[[{color:"#4ade80",label:"Дружба"},{color:"#555566",label:"Нейтрально"},{color:"#f87171",label:"Конфликт"}].map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)("div",{className:"h-[2px] w-4",style:{backgroundColor:a.color}}),(0,b.jsx)("span",{style:{color:"var(--muted-foreground)"},children:a.label})]},a.label)),(0,b.jsx)("div",{className:"flex items-center gap-1.5 ml-2",style:{borderLeft:"1px solid rgba(229,195,75,0.15)",paddingLeft:8},children:(0,b.jsx)("span",{style:{color:"var(--muted-foreground)"},children:"Клик = профиль"})})]})}function z({onSelectAgent:d,refreshToken:e}){let g=(0,c.useRef)(null),h=(0,c.useRef)(null),[i,j]=(0,c.useState)({width:0,height:0}),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)([]),[r,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(null),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)({x:0,y:0}),D=(0,c.useRef)(""),E=(0,c.useRef)(""),F=(0,c.useRef)(!1),G=(0,c.useMemo)(()=>{let a;return a=new Set(o.map(a=>a.id)),{nodes:o.map(a=>({id:a.id,name:a.name,avatar:a.avatar,mood:a.mood,moodColor:f[a.mood].color,val:8})),links:r.filter(b=>a.has(b.from)&&a.has(b.to)).map(a=>({source:a.from,target:a.to,sentiment:a.sentiment,label:a.label,color:w(a.sentiment)}))}},[o,r]);(0,c.useEffect)(()=>{let a=!0;F.current||n(!1);let b=async()=>{let[b,c]=await Promise.all([q(),s()]);if(!a)return;let d=JSON.stringify(b.map(a=>[a.id,a.mood,a.currentPlan,a.memories.length])),e=JSON.stringify(c.map(a=>[a.from,a.to,a.sentiment,a.label]));d!==D.current&&(D.current=d,p(b)),e!==E.current&&(E.current=e,t(c)),F.current||(F.current=!0,n(!0))};b();let c=setInterval(()=>{b()},4e3);return()=>{a=!1,clearInterval(c)}},[e]),(0,c.useEffect)(()=>{let a=g.current;if(!a)return;let b=new ResizeObserver(a=>{for(let b of a)j({width:b.contentRect.width,height:b.contentRect.height})});return b.observe(a),()=>b.disconnect()},[]),(0,c.useEffect)(()=>{a.A(68482).then(a=>{v(()=>a.default),setTimeout(()=>l(!0),500)})},[]);let H=(0,c.useRef)(!1);(0,c.useEffect)(()=>{let b=h.current;b&&!H.current&&k&&(H.current=!0,b.d3Force("charge")?.strength(-300).distanceMax(500),b.d3Force("link")?.distance(120).strength(.35),b.d3Force("center")?.strength(.04),a.A(76698).then(({forceCollide:a})=>{b.d3Force("collide",a(30).strength(1).iterations(4)),b.d3ReheatSimulation()}),b.d3ReheatSimulation())},[k]),(0,c.useEffect)(()=>{let a=h.current;if(!a||!k||0===i.width)return;let b=setTimeout(()=>{a.zoomToFit(400,40),a.d3ReheatSimulation()},100);return()=>clearTimeout(b)},[i,k]);let I=(0,c.useCallback)((a,b,c)=>{let d=a.x??0,e=a.y??0,f=z?.id===a.id,g=Math.max(11/c,2.5);b.save(),f&&(b.beginPath(),b.arc(d,e,20,0,2*Math.PI),b.fillStyle="rgba(229,195,75,0.06)",b.fill()),b.beginPath(),b.arc(d,e,14,0,2*Math.PI),b.fillStyle="#111118",b.fill(),b.strokeStyle=f?"#e5c34b":a.moodColor,b.lineWidth=1.5,b.stroke(),b.textAlign="center",b.textBaseline="middle",b.font="bold 11.200000000000001px 'Geist Mono', monospace",b.fillStyle=f?"#e5c34b":a.moodColor,b.fillText(a.avatar,d,e+.5),c>.45&&(b.font=`${g}px 'Geist Mono', monospace`,b.fillStyle=f?"#e5c34b":"rgba(229,195,75,0.3)",b.fillText(a.name,d,e+14+g+3)),b.restore()},[z]),J=(0,c.useCallback)((a,b)=>{let c=a.source,d=a.target;null!=c.x&&null!=c.y&&null!=d.x&&null!=d.y&&(b.save(),b.beginPath(),b.moveTo(c.x,c.y),b.lineTo(d.x,d.y),b.strokeStyle=a.color,b.lineWidth=1.2,b.globalAlpha=.4,b.stroke(),b.restore())},[]),K=(0,c.useMemo)(()=>{if(!z)return null;let a=o.find(a=>a.id===z.id);if(!a)return null;let b=f[a.mood],c=r.filter(b=>b.from===a.id||b.to===a.id).map(b=>{let c=b.from===a.id?b.to:b.from,d=o.find(a=>a.id===c);return{name:d?.name??c,sentiment:b.sentiment,label:b.label}});return{agent:a,moodCfg:b,rels:c}},[z,o,r]),L=(0,c.useCallback)(a=>{d&&d(a.id)},[d]),M=(0,c.useCallback)(a=>{a.__dragging=!0,a.fx=a.x,a.fy=a.y},[]),N=(0,c.useCallback)(a=>{a.__dragging=!1,setTimeout(()=>{a.__dragging||(a.fx=void 0,a.fy=void 0)},300)},[]);return(0,b.jsxs)("div",{ref:g,className:"relative h-full w-full overflow-hidden",style:{backgroundColor:"var(--cyber-surface)"},onMouseMove:a=>{let b=g.current?.getBoundingClientRect();b&&C({x:a.clientX-b.left,y:a.clientY-b.top})},children:[(0,b.jsx)("div",{className:"pointer-events-none absolute inset-0 opacity-[0.04]",style:{backgroundImage:"linear-gradient(var(--cyber-glow) 1px, transparent 1px), linear-gradient(90deg, var(--cyber-glow) 1px, transparent 1px)",backgroundSize:"50px 50px"}}),(0,b.jsx)(x,{visible:!k||!m}),u&&i.width>0&&(0,b.jsx)(u,{ref:h,graphData:G,width:i.width,height:i.height,backgroundColor:"transparent",d3AlphaDecay:.005,d3VelocityDecay:.25,warmupTicks:0,cooldownTime:1/0,nodeCanvasObject:I,nodePointerAreaPaint:(a,b,c)=>{let d=a.x??0,e=a.y??0;c.fillStyle=b,c.beginPath(),c.arc(d,e,22,0,2*Math.PI),c.fill()},nodeLabel:()=>"",nodeVal:()=>1,onNodeHover:a=>{A(a||null),g.current&&(g.current.style.cursor=a?"pointer":"default")},onNodeClick:L,onNodeDrag:M,onNodeDragEnd:N,enableNodeDrag:!0,linkCanvasObject:J,linkDirectionalParticles:0,linkPointerAreaPaint:()=>{},enableZoomInteraction:!0,enablePanInteraction:!0,minZoom:.3,maxZoom:6}),z&&K&&(0,b.jsxs)("div",{className:"absolute z-40 pointer-events-none font-mono",style:{left:Math.min(B.x+18,i.width-230),top:Math.max(B.y-14,8),backgroundColor:"rgba(10,10,15,0.94)",border:"1px solid rgba(229,195,75,0.2)",padding:"10px 14px",minWidth:"180px",maxWidth:"240px"},children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1.5",children:[(0,b.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold",style:{backgroundColor:K.moodCfg.color+"25",color:K.moodCfg.color,border:`1px solid ${K.moodCfg.color}50`},children:K.agent.avatar}),(0,b.jsx)("span",{className:"text-sm",style:{color:"var(--cyber-glow)"},children:K.agent.name})]}),(0,b.jsxs)("div",{className:"text-[10px] flex items-center gap-1.5 mb-2",style:{color:K.moodCfg.color},children:[(0,b.jsx)("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:K.moodCfg.color}}),K.moodCfg.label,(0,b.jsx)("span",{style:{color:"var(--muted-foreground)",marginLeft:4},children:K.agent.traits.slice(0,2).join(", ")})]}),K.rels.length>0&&(0,b.jsxs)("div",{style:{borderTop:"1px solid rgba(229,195,75,0.1)"},className:"pt-1.5",children:[(0,b.jsx)("div",{className:"text-[9px] uppercase tracking-widest mb-1",style:{color:"var(--muted-foreground)"},children:"Связи"}),K.rels.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between text-[10px] py-0.5",children:[(0,b.jsx)("span",{style:{color:"var(--foreground)"},children:a.name}),(0,b.jsx)("span",{style:{color:w(a.sentiment),fontSize:"9px"},children:a.label})]},a.name))]}),0===K.rels.length&&(0,b.jsx)("div",{className:"text-[10px] pt-1",style:{color:"var(--muted-foreground)",borderTop:"1px solid rgba(229,195,75,0.1)",paddingTop:6},children:"Нет связей с другими агентами"})]}),(0,b.jsx)(y,{})]})}let A={chat:{label:"ЧАТ",color:"#4ade80"},action:{label:"ДЕЙСТВИЕ",color:"#e5c34b"},emotion:{label:"ЭМОЦИЯ",color:"#c084fc"},system:{label:"СИСТЕМА",color:"#60a5fa"}};function B({refreshToken:a}){let[d,e]=(0,c.useState)([]),[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(!0);return(0,c.useEffect)(()=>{let a=!0;return j(!0),Promise.all([r(),q()]).then(([b,c])=>{a&&(e(b),h(c))}).finally(()=>{a&&j(!1)}),()=>{a=!1}},[a]),(0,b.jsxs)("div",{className:"flex h-full w-full",style:{backgroundColor:"var(--cyber-surface)"},children:[(0,b.jsxs)("aside",{className:"shrink-0 flex flex-col gap-3 overflow-y-auto border-r py-4 px-3",style:{borderColor:"rgba(229,195,75,0.15)",width:"clamp(160px, 15%, 220px)"},children:[(0,b.jsx)("span",{className:"font-mono text-[10px] tracking-widest uppercase px-1",style:{color:"var(--muted-foreground)"},children:"АГЕНТЫ ОНЛАЙН"}),g.map(a=>{let c=f[a.mood];return(0,b.jsxs)("div",{className:"flex items-center gap-2 px-2 py-2 rounded-sm",style:{backgroundColor:"rgba(229,195,75,0.04)"},children:[(0,b.jsx)("div",{className:"shrink-0 flex items-center justify-center font-mono text-xs font-bold rounded-sm",style:{width:32,height:32,backgroundColor:"rgba(229,195,75,0.1)",color:c.color,border:`1px solid ${c.color}`},children:a.avatar}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"font-mono text-xs truncate",style:{color:"var(--foreground)"},children:a.name}),(0,b.jsx)("div",{className:"font-mono text-[10px]",style:{color:c.color},children:c.label})]})]},a.id)})]}),(0,b.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,b.jsxs)("div",{className:"shrink-0 flex items-center justify-between px-4 py-2 border-b",style:{borderColor:"rgba(229,195,75,0.15)"},children:[(0,b.jsx)("span",{className:"font-mono text-sm tracking-widest uppercase",style:{color:"var(--cyber-glow)"},children:"ЛЕНТА СОБЫТИЙ"}),(0,b.jsxs)("span",{className:"font-mono text-[10px]",style:{color:"var(--muted-foreground)"},children:[d.length," ","событий"]})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 py-3 flex flex-col gap-1.5",children:[i&&(0,b.jsx)("div",{className:"font-mono text-xs",style:{color:"var(--muted-foreground)"},children:"Загрузка событий..."}),!i&&0===d.length&&(0,b.jsx)("div",{className:"font-mono text-xs",style:{color:"var(--muted-foreground)"},children:"Событий пока нет"}),d.map(a=>{let c=A[a.type];return(0,b.jsxs)("div",{className:"group flex items-start gap-3 px-3 py-2.5 rounded-sm",style:{backgroundColor:"rgba(229,195,75,0.02)",borderLeft:`2px solid ${c.color}`,transition:"background-color 0.15s ease"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="rgba(229,195,75,0.06)"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="rgba(229,195,75,0.02)"},children:[(0,b.jsx)("span",{className:"shrink-0 font-mono text-[11px] tabular-nums pt-0.5",style:{color:"var(--muted-foreground)",width:"64px"},children:new Date(a.timestamp).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}),(0,b.jsx)("span",{className:"shrink-0 font-mono text-[9px] tracking-wider uppercase px-1.5 py-0.5 rounded-sm mt-0.5",style:{color:c.color,backgroundColor:`${c.color}15`,border:`1px solid ${c.color}30`},children:c.label}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("span",{className:"font-mono text-xs font-bold mr-2",style:{color:"var(--cyber-glow)"},children:a.agentName}),(0,b.jsx)("span",{className:"font-mono text-xs",style:{color:"var(--foreground)",opacity:.85},children:a.text})]})]},a.id)})]})]})]})}function C({agent:a,onBack:c,fromGraph:d,allAgents:e,allEvents:g,allRelationships:h}){let i=f[a.mood],j=g.filter(b=>b.agentId===a.id),k=h.filter(b=>b.from===a.id||b.to===a.id);return(0,b.jsxs)("div",{className:"flex flex-col h-full",style:{backgroundColor:"var(--cyber-surface)"},children:[(0,b.jsxs)("div",{className:"shrink-0 flex items-center gap-3 px-5 py-3 border-b",style:{borderColor:"rgba(229,195,75,0.15)"},children:[(0,b.jsx)("button",{onClick:c,className:"font-mono text-xs tracking-wider uppercase cursor-pointer",style:{color:"var(--cyber-glow)",padding:"4px 10px",border:"1px solid rgba(229,195,75,0.25)",backgroundColor:"rgba(229,195,75,0.05)",transition:"all 0.2s ease"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="rgba(229,195,75,0.15)",a.currentTarget.style.borderColor="rgba(229,195,75,0.5)"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="rgba(229,195,75,0.05)",a.currentTarget.style.borderColor="rgba(229,195,75,0.25)"},children:d?"<- К ГРАФУ":"<- НАЗАД"}),(0,b.jsx)("span",{className:"font-mono text-sm tracking-widest uppercase",style:{color:"var(--cyber-glow)"},children:"ДОСЬЕ АГЕНТА"})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto px-5 py-4 flex flex-col gap-5",children:[(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:"shrink-0 flex items-center justify-center font-mono text-2xl font-bold rounded-sm",style:{width:64,height:64,backgroundColor:"rgba(229,195,75,0.1)",color:i.color,border:`2px solid ${i.color}`,boxShadow:`0 0 12px ${i.color}30`},children:a.avatar}),(0,b.jsxs)("div",{className:"flex flex-col gap-1 min-w-0",children:[(0,b.jsx)("h2",{className:"font-mono text-lg uppercase tracking-wider",style:{color:"var(--foreground)"},children:a.name}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"h-2 w-2 rounded-full",style:{backgroundColor:i.color}}),(0,b.jsx)("span",{className:"font-mono text-xs",style:{color:i.color},children:i.label})]}),(0,b.jsx)("p",{className:"font-mono text-xs mt-1",style:{color:"var(--muted-foreground)"},children:a.description})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-mono text-[10px] tracking-widest uppercase mb-2",style:{color:"var(--muted-foreground)"},children:"ЧЕРТЫ ХАРАКТЕРА"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1.5",children:a.traits.map(a=>(0,b.jsx)("span",{className:"font-mono text-[11px] px-2 py-0.5 rounded-sm",style:{color:"var(--cyber-glow)",backgroundColor:"rgba(229,195,75,0.08)",border:"1px solid rgba(229,195,75,0.2)"},children:a},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-mono text-[10px] tracking-widest uppercase mb-2",style:{color:"var(--muted-foreground)"},children:"ТЕКУЩИЙ ПЛАН"}),(0,b.jsx)("p",{className:"font-mono text-xs",style:{color:"var(--foreground)",opacity:.9},children:a.currentPlan})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-mono text-[10px] tracking-widest uppercase mb-2",style:{color:"var(--muted-foreground)"},children:"ОТНОШЕНИЯ"}),(0,b.jsx)("div",{className:"flex flex-col gap-1.5",children:k.map((c,d)=>{let f=c.from===a.id?c.to:c.from,g=e.find(a=>a.id===f),h=c.sentiment>0?"#4ade80":c.sentiment<0?"#f87171":"#a0a0b0";return(0,b.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 rounded-sm",style:{backgroundColor:"rgba(229,195,75,0.03)",borderLeft:`2px solid ${h}`},children:[(0,b.jsx)("span",{className:"font-mono text-xs",style:{color:"var(--foreground)"},children:g?.name||f}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-mono text-[10px]",style:{color:"var(--muted-foreground)"},children:c.label}),(0,b.jsxs)("span",{className:"font-mono text-xs font-bold",style:{color:h},children:[c.sentiment>0?"+":"",(100*c.sentiment).toFixed(0),"%"]})]})]},d)})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-mono text-[10px] tracking-widest uppercase mb-2",style:{color:"var(--muted-foreground)"},children:"ВОСПОМИНАНИЯ"}),(0,b.jsx)("div",{className:"flex flex-col gap-1",children:a.memories.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-start gap-2 py-1",children:[(0,b.jsx)("div",{className:"shrink-0 mt-1.5 h-1 w-1 rounded-full",style:{backgroundColor:"var(--cyber-glow)",opacity:.5}}),(0,b.jsx)("span",{className:"font-mono text-xs",style:{color:"var(--foreground)",opacity:.8},children:a})]},c))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-mono text-[10px] tracking-widest uppercase mb-2",style:{color:"var(--muted-foreground)"},children:"ПОСЛЕДНИЕ СОБЫТИЯ"}),(0,b.jsx)("div",{className:"flex flex-col gap-1",children:j.map(a=>(0,b.jsxs)("div",{className:"flex items-start gap-2 py-1.5 px-2 rounded-sm",style:{backgroundColor:"rgba(229,195,75,0.02)"},children:[(0,b.jsx)("span",{className:"shrink-0 font-mono text-[10px] tabular-nums",style:{color:"var(--muted-foreground)",width:56},children:new Date(a.timestamp).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),(0,b.jsx)("span",{className:"font-mono text-xs",style:{color:"var(--foreground)",opacity:.8},children:a.text})]},a.id))})]})]})]})}function D({preSelectedAgentId:a,onClearSelection:d,fromGraph:e,refreshToken:g}){let[h,i]=(0,c.useState)(a??null),[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)([]),[t,u]=(0,c.useState)(!0),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let a=!0;return u(!0),Promise.all([q(),r(),s()]).then(([b,c,d])=>{a&&(k(b),m(c),o(d))}).finally(()=>{a&&u(!1)}),()=>{a=!1}},[g]);let B=async()=>{let a=v.trim();if(a&&!z){A(!0),y(null);try{let b=await p(a);if(!b)return void y("Не удалось сгенерировать агента. Проверь backend и OPENAI_API_KEY.");let[c,d,e]=await Promise.all([q(),r(),s()]);k(c),m(d),o(e),w(""),i(b.id)}finally{A(!1)}}},D=(0,c.useRef)(a);a&&a!==D.current&&(D.current=a,h!==a&&i(a));let E=j.find(a=>a.id===h);return E?(0,b.jsx)(C,{agent:E,allAgents:j,allEvents:l,allRelationships:n,onBack:()=>{i(null),d?.()},fromGraph:e}):t?(0,b.jsx)("div",{className:"flex h-full items-center justify-center font-mono text-xs",style:{backgroundColor:"var(--cyber-surface)",color:"var(--muted-foreground)"},children:"Загрузка агентов..."}):(0,b.jsxs)("div",{className:"flex flex-col h-full",style:{backgroundColor:"var(--cyber-surface)"},children:[(0,b.jsxs)("div",{className:"shrink-0 flex items-center justify-between px-5 py-3 border-b",style:{borderColor:"rgba(229,195,75,0.15)"},children:[(0,b.jsx)("span",{className:"font-mono text-sm tracking-widest uppercase",style:{color:"var(--cyber-glow)"},children:"СПИСОК АГЕНТОВ"}),(0,b.jsxs)("span",{className:"font-mono text-[10px]",style:{color:"var(--muted-foreground)"},children:[j.length," ","агентов"]})]}),(0,b.jsxs)("div",{className:"px-5 py-3 border-b",style:{borderColor:"rgba(229,195,75,0.12)"},children:[(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("input",{type:"text",value:v,onChange:a=>w(a.target.value),placeholder:"Опиши агента для ИИ...",className:"flex-1 font-mono text-xs px-3 py-2 rounded-sm outline-none",style:{backgroundColor:"rgba(229,195,75,0.04)",border:"1px solid rgba(229,195,75,0.2)",color:"var(--foreground)"},disabled:z}),(0,b.jsx)("button",{onClick:B,disabled:z||0===v.trim().length,className:"font-mono text-xs tracking-wider uppercase px-3 py-2 rounded-sm cursor-pointer disabled:cursor-not-allowed",style:{color:z?"var(--muted-foreground)":"var(--cyber-glow)",backgroundColor:z?"rgba(229,195,75,0.02)":"rgba(229,195,75,0.08)",border:"1px solid rgba(229,195,75,0.25)"},children:z?"ГЕНЕРАЦИЯ...":"СОЗДАТЬ ИИ"})]}),x?(0,b.jsx)("p",{className:"mt-2 font-mono text-[10px]",style:{color:"#f87171"},children:x}):null]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto px-5 py-4 grid grid-cols-1 md:grid-cols-2 gap-3 auto-rows-min",children:[0===j.length?(0,b.jsx)("div",{className:"col-span-full flex items-center justify-center font-mono text-xs py-8",style:{color:"var(--muted-foreground)"},children:'Агентов пока нет. Опиши первого и нажми "СОЗДАТЬ ИИ".'}):null,j.map(a=>{let c=f[a.mood];return(0,b.jsxs)("button",{onClick:()=>i(a.id),className:"text-left p-4 rounded-sm cursor-pointer flex items-start gap-3",style:{backgroundColor:"rgba(229,195,75,0.03)",border:"1px solid rgba(229,195,75,0.1)",transition:"all 0.2s ease"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="rgba(229,195,75,0.08)",a.currentTarget.style.borderColor="rgba(229,195,75,0.3)",a.currentTarget.style.boxShadow="0 0 12px rgba(229,195,75,0.06)"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="rgba(229,195,75,0.03)",a.currentTarget.style.borderColor="rgba(229,195,75,0.1)",a.currentTarget.style.boxShadow="none"},children:[(0,b.jsx)("div",{className:"shrink-0 flex items-center justify-center font-mono text-lg font-bold rounded-sm",style:{width:48,height:48,backgroundColor:"rgba(229,195,75,0.08)",color:c.color,border:`1px solid ${c.color}`},children:a.avatar}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-mono text-sm uppercase",style:{color:"var(--foreground)"},children:a.name}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("div",{className:"h-1.5 w-1.5 rounded-full",style:{backgroundColor:c.color}}),(0,b.jsx)("span",{className:"font-mono text-[10px]",style:{color:c.color},children:c.label})]})]}),(0,b.jsx)("p",{className:"font-mono text-[11px] mt-1 line-clamp-2",style:{color:"var(--muted-foreground)"},children:a.description}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:a.traits.map(a=>(0,b.jsx)("span",{className:"font-mono text-[9px] px-1.5 py-0.5 rounded-sm",style:{color:"var(--cyber-glow)",backgroundColor:"rgba(229,195,75,0.06)",border:"1px solid rgba(229,195,75,0.15)"},children:a},a))})]})]},a.id)})]})]})}function E({label:a,value:c,sub:d}){return(0,b.jsxs)("div",{className:"flex flex-col gap-1 p-4 rounded-sm",style:{backgroundColor:"rgba(229,195,75,0.03)",border:"1px solid rgba(229,195,75,0.1)"},children:[(0,b.jsx)("span",{className:"font-mono text-[10px] tracking-widest uppercase",style:{color:"var(--muted-foreground)"},children:a}),(0,b.jsx)("span",{className:"font-mono text-2xl tabular-nums",style:{color:"var(--cyber-glow)",textShadow:"0 0 10px rgba(229,195,75,0.3)"},children:c}),d&&(0,b.jsx)("span",{className:"font-mono text-[10px]",style:{color:"var(--muted-foreground)"},children:d})]})}function F({items:a,maxVal:c}){return(0,b.jsx)("div",{className:"flex flex-col gap-2",children:a.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("span",{className:"font-mono text-[10px] tracking-wider uppercase shrink-0",style:{color:"var(--muted-foreground)",width:80},children:a.label}),(0,b.jsx)("div",{className:"flex-1 h-5 rounded-sm",style:{backgroundColor:"rgba(229,195,75,0.06)"},children:(0,b.jsx)("div",{className:"h-full rounded-sm",style:{width:`${Math.max(a.value/c*100,2)}%`,backgroundColor:a.color,opacity:.7,boxShadow:`0 0 8px ${a.color}40`,transition:"width 0.5s ease"}})}),(0,b.jsx)("span",{className:"font-mono text-xs tabular-nums shrink-0",style:{color:a.color,width:36,textAlign:"right"},children:a.value})]},a.label))})}function G({refreshToken:a}){let[d,e]=(0,c.useState)(null);if((0,c.useEffect)(()=>{let a=!0;return e(null),t().then(b=>{a&&e(b)}),()=>{a=!1}},[a]),!d)return(0,b.jsx)("div",{className:"flex h-full items-center justify-center font-mono text-xs",style:{backgroundColor:"var(--cyber-surface)",color:"var(--muted-foreground)"},children:"Загрузка статистики..."});let g={chat:"#4ade80",action:"#e5c34b",emotion:"#c084fc",system:"#60a5fa"},h={chat:"Чат",action:"Действие",emotion:"Эмоция",system:"Система"},i=Math.max(1,...d.eventsByType.map(a=>a.count)),j=Math.max(1,...d.moodDistribution.map(a=>a.count)),k=d.topRelationship.sentiment>0?"#4ade80":d.topRelationship.sentiment<0?"#f87171":"var(--muted-foreground)";return(0,b.jsxs)("div",{className:"flex flex-col h-full",style:{backgroundColor:"var(--cyber-surface)"},children:[(0,b.jsx)("div",{className:"shrink-0 flex items-center px-5 py-3 border-b",style:{borderColor:"rgba(229,195,75,0.15)"},children:(0,b.jsx)("span",{className:"font-mono text-sm tracking-widest uppercase",style:{color:"var(--cyber-glow)"},children:"СТАТИСТИКА МИРА"})}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto px-5 py-4 flex flex-col gap-5",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,b.jsx)(E,{label:"Всего событий",value:d.totalEvents}),(0,b.jsx)(E,{label:"Диалогов",value:d.totalConversations}),(0,b.jsx)(E,{label:"Среднее настроение",value:`${(100*d.avgMood).toFixed(0)}%`,sub:"0% = плохо, 100% = отлично"}),(0,b.jsx)(E,{label:"Самый активный",value:d.mostActiveAgent})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-mono text-[10px] tracking-widest uppercase mb-3",style:{color:"var(--muted-foreground)"},children:"СОБЫТИЯ ПО ТИПАМ"}),(0,b.jsx)(F,{items:d.eventsByType.map(a=>({label:h[a.type]||a.type,value:a.count,color:g[a.type]||"var(--cyber-glow)"})),maxVal:i})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-mono text-[10px] tracking-widest uppercase mb-3",style:{color:"var(--muted-foreground)"},children:"РАСПРЕДЕЛЕНИЕ НАСТРОЕНИЙ"}),(0,b.jsx)(F,{items:d.moodDistribution.map(a=>({label:f[a.mood].label,value:a.count,color:f[a.mood].color})),maxVal:j})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-mono text-[10px] tracking-widest uppercase mb-2",style:{color:"var(--muted-foreground)"},children:"САМАЯ СИЛЬНАЯ СВЯЗЬ"}),(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 rounded-sm",style:{backgroundColor:"rgba(229,195,75,0.04)",border:"1px solid rgba(229,195,75,0.15)"},children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("span",{className:"font-mono text-sm",style:{color:"var(--foreground)"},children:d.topRelationship.from}),(0,b.jsx)("span",{className:"font-mono text-xs",style:{color:"var(--muted-foreground)"},children:"<->"}),(0,b.jsx)("span",{className:"font-mono text-sm",style:{color:"var(--foreground)"},children:d.topRelationship.to})]}),(0,b.jsxs)("span",{className:"font-mono text-sm font-bold",style:{color:k},children:[d.topRelationship.sentiment>0?"+":"",(100*d.topRelationship.sentiment).toFixed(0),"%"]})]})]})]})]})}function H(){return(0,b.jsx)("div",{className:"flex h-full w-full items-center justify-center",style:{backgroundColor:"var(--cyber-surface)"},children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,b.jsx)("div",{className:"h-20 w-20 rounded-sm border flex items-center justify-center",style:{borderColor:"rgba(229,195,75,0.2)",boxShadow:"0 0 20px rgba(229,195,75,0.05)"},children:(0,b.jsx)("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"var(--cyber-glow)",strokeWidth:"1",opacity:"0.4",children:(0,b.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}),(0,b.jsx)("p",{className:"font-mono text-sm tracking-[0.2em] uppercase",style:{color:"var(--cyber-glow)",opacity:.4},children:"СООБЩЕНИЯ // СКОРО"}),(0,b.jsx)("p",{className:"font-mono text-xs",style:{color:"var(--muted-foreground)"},children:"Функция в разработке"})]})})}function I(){let[a,d]=(0,c.useState)("graph"),[f,g]=(0,c.useState)(1),[h,i]=(0,c.useState)(null),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(null),[n,p]=(0,c.useState)(0);(0,c.useEffect)(()=>{let a=!0,b=async()=>{let b=await u();b&&a&&(g(a=>Math.abs(a-b.speed)>.001?b.speed:a),i(a=>{if(!a)return b.gameTime;let c=new Date(a).getTime(),d=new Date(b.gameTime).getTime();return Number.isFinite(c)&&Number.isFinite(d)?Math.abs(d-c)>=6e4?b.gameTime:a:b.gameTime}))};b();let c=setInterval(b,5e3);return()=>{a=!1,clearInterval(c)}},[]);let q=async a=>{await o(a)?p(a=>a+1):console.warn("[ui] Event was not sent to backend, fallback mode is active")},r=async a=>{g(a);let b=await v(a);b&&(g(b.speed),i(b.gameTime),p(a=>a+1))},s=a=>{k(a),m("graph"),d("agents")};return(0,b.jsx)(e,{activeTab:a,onTabChange:a=>{d(a),"agents"!==a&&(k(null),m(null))},onAddEvent:q,timeSpeed:f,onTimeSpeedChange:r,worldTime:h,children:function(){switch(a){case"graph":return(0,b.jsx)(z,{onSelectAgent:s,refreshToken:n});case"events":return(0,b.jsx)(B,{refreshToken:n});case"stats":return(0,b.jsx)(G,{refreshToken:n});case"agents":return(0,b.jsx)(D,{refreshToken:n,preSelectedAgentId:j,onClearSelection:()=>{k(null),"graph"===l&&(d("graph"),m(null))},fromGraph:"graph"===l});case"messages":return(0,b.jsx)(H,{});default:return null}}()})}a.s(["default",()=>I],60350)}];

//# sourceMappingURL=app_page_tsx_55b2e5ee._.js.map