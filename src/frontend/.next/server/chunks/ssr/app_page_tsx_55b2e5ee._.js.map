{"version":3,"sources":["../../../../components/panels/graph-panel.tsx","../../../../components/cyber-frame.tsx","../../../../components/panels/events-panel.tsx","../../../../components/panels/agents-panel.tsx","../../../../components/panels/stats-panel.tsx","../../../../components/panels/messages-panel.tsx","../../../../app/page.tsx","../../../../node_modules/%40microsoft/signalr/src/HeaderNames.ts","../../../../node_modules/%40microsoft/signalr/src/Utils.ts","../../../../node_modules/%40microsoft/signalr/src/ServerSentEventsTransport.ts","../../../../node_modules/%40microsoft/signalr/src/DefaultHttpClient.ts","../../../../node_modules/%40microsoft/signalr/src/XhrHttpClient.ts","../../../../node_modules/%40microsoft/signalr/src/FetchHttpClient.ts","../../../../node_modules/%40microsoft/signalr/src/AccessTokenHttpClient.ts","../../../../node_modules/%40microsoft/signalr/src/MessageBuffer.ts","../../../../node_modules/%40microsoft/signalr/src/JsonHubProtocol.ts","../../../../node_modules/%40microsoft/signalr/src/WebSocketTransport.ts","../../../../node_modules/%40microsoft/signalr/src/LongPollingTransport.ts","../../../../node_modules/%40microsoft/signalr/src/TextMessageFormat.ts","../../../../node_modules/%40microsoft/signalr/src/HubConnection.ts","../../../../node_modules/%40microsoft/signalr/src/HandshakeProtocol.ts","../../../../node_modules/%40microsoft/signalr/src/Subject.ts","../../../../node_modules/%40microsoft/signalr/src/HttpConnection.ts","../../../../node_modules/%40microsoft/signalr/src/HubConnectionBuilder.ts","../../../../node_modules/%40microsoft/signalr/src/HttpClient.ts","../../../../node_modules/%40microsoft/signalr/src/IHubProtocol.ts","../../../../node_modules/%40microsoft/signalr/src/Errors.ts","../../../../node_modules/%40microsoft/signalr/src/DefaultReconnectPolicy.ts","../../../../node_modules/%40microsoft/signalr/src/ITransport.ts","../../../../node_modules/%40microsoft/signalr/src/AbortController.ts","../../../../node_modules/%40microsoft/signalr/src/Loggers.ts","../../../../node_modules/%40microsoft/signalr/src/ILogger.ts","../../../../lib/data.ts"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useRef, useState, useCallback, useMemo } from \"react\"\nimport {\r\n  MOOD_CONFIG,\r\n  getAgents,\r\n  getRelationships,\r\n  type Agent,\r\n  type Relationship,\r\n} from \"@/lib/data\"\r\n\r\n// Типы для графа\r\ninterface GraphNode {\r\n  id: string\r\n  name: string\r\n  avatar: string\r\n  mood: string\r\n  moodColor: string\r\n  val: number\r\n  x?: number\r\n  y?: number\r\n  fx?: number | null\r\n  fy?: number | null\r\n  __dragging?: boolean\r\n}\r\n\r\ninterface GraphLink {\r\n  source: string | GraphNode\r\n  target: string | GraphNode\r\n  sentiment: number\r\n  label?: string\r\n  color: string\r\n}\r\n\r\ninterface GraphData {\r\n  nodes: GraphNode[]\r\n  links: GraphLink[]\r\n}\r\n\r\n// Цвет связи по sentiment\r\nfunction sentimentToColor(s: number): string {\r\n  if (s >= 0.5) return \"#4ade80\"\r\n  if (s >= 0.2) return \"#86efac\"\r\n  if (s > -0.2) return \"#555566\"\r\n  if (s > -0.5) return \"#fca5a5\"\r\n  return \"#f87171\"\r\n}\r\n\r\n// Построить граф из агентов и связей\r\nfunction buildGraphData(agents: Agent[], rels: Relationship[]): GraphData {\n  const agentIds = new Set(agents.map((a) => a.id))\r\n\r\n  const nodes: GraphNode[] = agents.map((a) => ({\r\n    id: a.id,\r\n    name: a.name,\r\n    avatar: a.avatar,\r\n    mood: a.mood,\r\n    moodColor: MOOD_CONFIG[a.mood].color,\r\n    val: 8,\r\n  }))\r\n\r\n  const links: GraphLink[] = rels\r\n    .filter((r) => agentIds.has(r.from) && agentIds.has(r.to))\r\n    .map((r) => ({\r\n      source: r.from,\r\n      target: r.to,\r\n      sentiment: r.sentiment,\r\n      label: r.label,\r\n      color: sentimentToColor(r.sentiment),\r\n    }))\r\n\r\n  return { nodes, links }\n}\n\nfunction mergeGraphData(prev: GraphData, agents: Agent[], rels: Relationship[]): GraphData {\n  const next = buildGraphData(agents, rels)\n  const prevNodesById = new Map(prev.nodes.map((node) => [node.id, node]))\n\n  const mergedNodes = next.nodes.map((node) => {\n    const previous = prevNodesById.get(node.id)\n    if (!previous) {\n      return node\n    }\n\n    return {\n      ...node,\n      x: previous.x,\n      y: previous.y,\n      fx: previous.fx,\n      fy: previous.fy,\n      __dragging: previous.__dragging,\n    }\n  })\n\n  return {\n    nodes: mergedNodes,\n    links: next.links,\n  }\n}\n\r\n// Загрузочный оверлей\r\nfunction LoadingOverlay({ visible }: { visible: boolean }) {\r\n  return (\r\n    <div\r\n      className=\"absolute inset-0 z-30 flex items-center justify-center\"\r\n      style={{\r\n        backgroundColor: \"var(--cyber-surface)\",\r\n        opacity: visible ? 1 : 0,\r\n        pointerEvents: visible ? \"auto\" : \"none\",\r\n        transition: \"opacity 0.6s ease\",\r\n      }}\r\n    >\r\n      <div\r\n        className=\"pointer-events-none absolute inset-0 opacity-10\"\r\n        style={{\r\n          backgroundImage:\r\n            \"linear-gradient(var(--cyber-glow) 1px, transparent 1px), linear-gradient(90deg, var(--cyber-glow) 1px, transparent 1px)\",\r\n          backgroundSize: \"60px 60px\",\r\n        }}\r\n      />\r\n      <div className=\"relative flex flex-col items-center gap-4\">\r\n        <div\r\n          className=\"h-16 w-16 rounded-full border flex items-center justify-center\"\r\n          style={{\r\n            borderColor: \"var(--cyber-glow)\",\r\n            boxShadow: \"0 0 20px var(--cyber-glow-dim), inset 0 0 20px var(--cyber-glow-dim)\",\r\n            animation: \"cyber-pulse 2s ease-in-out infinite\",\r\n          }}\r\n        >\r\n          <svg width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"var(--cyber-glow)\" strokeWidth=\"1.5\">\r\n            <circle cx=\"5\" cy=\"12\" r=\"2\" />\r\n            <circle cx=\"19\" cy=\"6\" r=\"2\" />\r\n            <circle cx=\"19\" cy=\"18\" r=\"2\" />\r\n            <line x1=\"7\" y1=\"12\" x2=\"17\" y2=\"6\" />\r\n            <line x1=\"7\" y1=\"12\" x2=\"17\" y2=\"18\" />\r\n          </svg>\r\n        </div>\r\n        <p className=\"font-mono text-sm tracking-[0.2em] uppercase\" style={{ color: \"var(--cyber-glow)\", opacity: 0.6 }}>\r\n          {\"ЗАГРУЗКА ГРАФА\"}\r\n        </p>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n// Легенда\r\nfunction Legend() {\r\n  const items = [\r\n    { color: \"#4ade80\", label: \"Дружба\" },\r\n    { color: \"#555566\", label: \"Нейтрально\" },\r\n    { color: \"#f87171\", label: \"Конфликт\" },\r\n  ]\r\n  return (\r\n    <div\r\n      className=\"absolute bottom-3 left-3 z-20 flex items-center gap-4 px-3 py-2 font-mono text-[11px]\"\r\n      style={{\r\n        backgroundColor: \"rgba(10,10,15,0.85)\",\r\n        border: \"1px solid rgba(229,195,75,0.15)\",\r\n      }}\r\n    >\r\n      {items.map((item) => (\r\n        <div key={item.label} className=\"flex items-center gap-1.5\">\r\n          <div className=\"h-[2px] w-4\" style={{ backgroundColor: item.color }} />\r\n          <span style={{ color: \"var(--muted-foreground)\" }}>{item.label}</span>\r\n        </div>\r\n      ))}\r\n      <div className=\"flex items-center gap-1.5 ml-2\" style={{ borderLeft: \"1px solid rgba(229,195,75,0.15)\", paddingLeft: 8 }}>\r\n        <span style={{ color: \"var(--muted-foreground)\" }}>{\"Клик = профиль\"}</span>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n// Панель графа -- узлы, связи, физика\r\nexport function GraphPanel({\r\n  onSelectAgent,\r\n  refreshToken,\r\n}: {\r\n  onSelectAgent?: (agentId: string) => void\r\n  refreshToken?: number\r\n}) {\r\n  const containerRef = useRef<HTMLDivElement>(null)\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const fgRef = useRef<any>(null)\r\n  const [dimensions, setDimensions] = useState({ width: 0, height: 0 })\r\n  const [graphLoaded, setGraphLoaded] = useState(false)\r\n  const [dataLoaded, setDataLoaded] = useState(false)\n  const [agents, setAgents] = useState<Agent[]>([])\n  const [relationships, setRelationships] = useState<Relationship[]>([])\n  const [graphData, setGraphData] = useState<GraphData>({ nodes: [], links: [] })\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const [ForceGraph, setForceGraph] = useState<React.ComponentType<any> | null>(null)\n  const [hoveredNode, setHoveredNode] = useState<GraphNode | null>(null)\n  const [tooltipPos, setTooltipPos] = useState({ x: 0, y: 0 })\n  const agentsSignatureRef = useRef(\"\")\n  const relationshipsSignatureRef = useRef(\"\")\n  const initializedRef = useRef(false)\n\n  useEffect(() => {\n    let active = true\n    if (!initializedRef.current) {\n      setDataLoaded(false)\n    }\n\n    const loadData = async () => {\n      const [loadedAgents, loadedRelationships] = await Promise.all([getAgents(), getRelationships()])\n      if (!active) return\n\n      const agentsSignature = JSON.stringify(loadedAgents.map((agent) => [agent.id, agent.name, agent.avatar, agent.mood]))\n      const relationshipsSignature = JSON.stringify(\n        loadedRelationships.map((relationship) => [relationship.from, relationship.to, relationship.sentiment, relationship.label])\n      )\n\n      let graphNeedsUpdate = false\n      if (agentsSignature !== agentsSignatureRef.current) {\n        agentsSignatureRef.current = agentsSignature\n        setAgents(loadedAgents)\n        graphNeedsUpdate = true\n      }\n\n      if (relationshipsSignature !== relationshipsSignatureRef.current) {\n        relationshipsSignatureRef.current = relationshipsSignature\n        setRelationships(loadedRelationships)\n        graphNeedsUpdate = true\n      }\n\n      if (graphNeedsUpdate) {\n        setGraphData((prev) => mergeGraphData(prev, loadedAgents, loadedRelationships))\n      }\n\n      if (!initializedRef.current) {\n        initializedRef.current = true\n        setDataLoaded(true)\n      }\n    }\n\n    void loadData()\n    const timer = setInterval(() => {\n      void loadData()\n    }, 4000)\n\n    return () => {\n      active = false\n      clearInterval(timer)\n    }\n  }, [refreshToken])\n\r\n  // Track container size\r\n  useEffect(() => {\r\n    const el = containerRef.current\r\n    if (!el) return\r\n    const observer = new ResizeObserver((entries) => {\r\n      for (const entry of entries) {\r\n        setDimensions({\r\n          width: entry.contentRect.width,\r\n          height: entry.contentRect.height,\r\n        })\r\n      }\r\n    })\r\n    observer.observe(el)\r\n    return () => observer.disconnect()\r\n  }, [])\r\n\r\n  // Dynamic import (SSR-safe)\r\n  useEffect(() => {\r\n    import(\"react-force-graph-2d\").then((mod) => {\r\n      setForceGraph(() => mod.default)\r\n      setTimeout(() => setGraphLoaded(true), 500)\r\n    })\r\n  }, [])\r\n\r\n  // Configure physics ONCE after graph renders\r\n  const physicsConfigured = useRef(false)\r\n  useEffect(() => {\r\n    const fg = fgRef.current\r\n    if (!fg || physicsConfigured.current || !graphLoaded) return\r\n    physicsConfigured.current = true\r\n\r\n    // Charge: nodes repel each other\r\n    fg.d3Force(\"charge\")?.strength(-300).distanceMax(500)\r\n\r\n    // Links: connected nodes attract with moderate strength\r\n    fg.d3Force(\"link\")?.distance(120).strength(0.35)\r\n\r\n    // Center: weak gravity toward center -- keeps the cluster centered\r\n    fg.d3Force(\"center\")?.strength(0.04)\r\n\r\n    // Collision: prevent overlap (node radius 14 + padding = 30)\r\n    import(\"d3-force\").then(({ forceCollide }) => {\r\n      fg.d3Force(\"collide\", forceCollide(30).strength(1).iterations(4))\r\n      fg.d3ReheatSimulation()\r\n    })\r\n\r\n    fg.d3ReheatSimulation()\r\n  }, [graphLoaded])\r\n\r\n  // Обработать изменение размера (fullscreen toggle) -- центрировать и прогреть физику\r\n  useEffect(() => {\r\n    const fg = fgRef.current\r\n    if (!fg || !graphLoaded || dimensions.width === 0) return\r\n    \r\n    // Небольшая задержка чтобы canvas успел обновиться\r\n    const timer = setTimeout(() => {\r\n      fg.zoomToFit(400, 40)\r\n      fg.d3ReheatSimulation()\r\n    }, 100)\r\n    \r\n    return () => clearTimeout(timer)\r\n  }, [dimensions, graphLoaded])\r\n\r\n  // Paint node -- minimal, consistent stroke width\r\n  const paintNode = useCallback(\r\n    (node: Record<string, unknown>, ctx: CanvasRenderingContext2D, globalScale: number) => {\r\n      const n = node as unknown as GraphNode\r\n      const x = n.x ?? 0\r\n      const y = n.y ?? 0\r\n      const r = 14\r\n      const isHovered = hoveredNode?.id === n.id\r\n      const fontSize = Math.max(11 / globalScale, 2.5)\r\n\r\n      ctx.save()\r\n\r\n      // Subtle glow when hovered\r\n      if (isHovered) {\r\n        ctx.beginPath()\r\n        ctx.arc(x, y, r + 6, 0, 2 * Math.PI)\r\n        ctx.fillStyle = \"rgba(229,195,75,0.06)\"\r\n        ctx.fill()\r\n      }\r\n\r\n      // Fill\r\n      ctx.beginPath()\r\n      ctx.arc(x, y, r, 0, 2 * Math.PI)\r\n      ctx.fillStyle = \"#111118\"\r\n      ctx.fill()\r\n\r\n      // Stroke -- uniform 1.5px for all\r\n      ctx.strokeStyle = isHovered ? \"#e5c34b\" : n.moodColor\r\n      ctx.lineWidth = 1.5\r\n      ctx.stroke()\r\n\r\n      // Avatar letter\r\n      ctx.textAlign = \"center\"\r\n      ctx.textBaseline = \"middle\"\r\n      ctx.font = `bold ${r * 0.8}px 'Geist Mono', monospace`\r\n      ctx.fillStyle = isHovered ? \"#e5c34b\" : n.moodColor\r\n      ctx.fillText(n.avatar, x, y + 0.5)\r\n\r\n      // Name below node\r\n      if (globalScale > 0.45) {\r\n        ctx.font = `${fontSize}px 'Geist Mono', monospace`\r\n        ctx.fillStyle = isHovered ? \"#e5c34b\" : \"rgba(229,195,75,0.3)\"\r\n        ctx.fillText(n.name, x, y + r + fontSize + 3)\r\n      }\r\n\r\n      ctx.restore()\r\n    },\r\n    [hoveredNode]\r\n  )\r\n\r\n  // Paint link -- uniform width, no labels on canvas\r\n  const paintLink = useCallback(\r\n    (link: Record<string, unknown>, ctx: CanvasRenderingContext2D) => {\r\n      const l = link as unknown as GraphLink\r\n      const source = l.source as unknown as GraphNode\r\n      const target = l.target as unknown as GraphNode\r\n      if (source.x == null || source.y == null || target.x == null || target.y == null) return\r\n\r\n      ctx.save()\r\n      ctx.beginPath()\r\n      ctx.moveTo(source.x, source.y)\r\n      ctx.lineTo(target.x, target.y)\r\n      ctx.strokeStyle = l.color\r\n      ctx.lineWidth = 1.2\r\n      ctx.globalAlpha = 0.4\r\n      ctx.stroke()\r\n      ctx.restore()\r\n    },\r\n    []\r\n  )\r\n\r\n  // Tooltip content -- shows relationships when hovering\r\n  const tooltipContent = useMemo(() => {\r\n    if (!hoveredNode) return null\r\n    const agent = agents.find((a) => a.id === hoveredNode.id)\r\n    if (!agent) return null\r\n    const moodCfg = MOOD_CONFIG[agent.mood]\r\n\r\n    const rels = relationships.filter(\r\n      (r) => r.from === agent.id || r.to === agent.id\r\n    ).map((r) => {\r\n      const otherId = r.from === agent.id ? r.to : r.from\r\n      const other = agents.find((a) => a.id === otherId)\r\n      return { name: other?.name ?? otherId, sentiment: r.sentiment, label: r.label }\r\n    })\r\n\r\n    return { agent, moodCfg, rels }\r\n  }, [hoveredNode, agents, relationships])\r\n\r\n  // Node click -- navigate to agent profile\r\n  const handleNodeClick = useCallback(\r\n    (node: Record<string, unknown>) => {\r\n      const n = node as unknown as GraphNode\r\n      if (onSelectAgent) {\r\n        onSelectAgent(n.id)\r\n      }\r\n    },\r\n    [onSelectAgent]\r\n  )\r\n\r\n  // Drag -- temporary pin, release back to physics after drag end\r\n  const handleNodeDrag = useCallback((node: Record<string, unknown>) => {\r\n    const n = node as unknown as GraphNode\r\n    n.__dragging = true\r\n    n.fx = n.x\r\n    n.fy = n.y\r\n  }, [])\r\n\r\n  const handleNodeDragEnd = useCallback((node: Record<string, unknown>) => {\r\n    const n = node as unknown as GraphNode\r\n    n.__dragging = false\r\n    // Release back to physics after a short delay\r\n    setTimeout(() => {\r\n      if (!n.__dragging) {\r\n        n.fx = undefined as unknown as null\r\n        n.fy = undefined as unknown as null\r\n      }\r\n    }, 300)\r\n  }, [])\r\n\r\n  return (\r\n    <div\r\n      ref={containerRef}\r\n      className=\"relative h-full w-full overflow-hidden\"\r\n      style={{ backgroundColor: \"var(--cyber-surface)\" }}\r\n      onMouseMove={(e) => {\r\n        const rect = containerRef.current?.getBoundingClientRect()\r\n        if (rect) {\r\n          setTooltipPos({ x: e.clientX - rect.left, y: e.clientY - rect.top })\r\n        }\r\n      }}\r\n    >\r\n      {/* Grid background */}\r\n      <div\r\n        className=\"pointer-events-none absolute inset-0 opacity-[0.04]\"\r\n        style={{\r\n          backgroundImage:\r\n            \"linear-gradient(var(--cyber-glow) 1px, transparent 1px), linear-gradient(90deg, var(--cyber-glow) 1px, transparent 1px)\",\r\n          backgroundSize: \"50px 50px\",\r\n        }}\r\n      />\r\n\r\n      <LoadingOverlay visible={!graphLoaded || !dataLoaded} />\r\n\r\n      {ForceGraph && dimensions.width > 0 && (\r\n        <ForceGraph\r\n          ref={fgRef}\r\n          graphData={graphData}\r\n          width={dimensions.width}\r\n          height={dimensions.height}\r\n          backgroundColor=\"transparent\"\r\n          // Physics: never stop\r\n          d3AlphaDecay={0.005}\r\n          d3VelocityDecay={0.25}\r\n          warmupTicks={0}\r\n          cooldownTime={Infinity}\r\n          // Nodes\r\n          nodeCanvasObject={paintNode}\r\n          nodePointerAreaPaint={(node: Record<string, unknown>, color: string, ctx: CanvasRenderingContext2D) => {\r\n            const n = node as unknown as GraphNode\r\n            const x = n.x ?? 0\r\n            const y = n.y ?? 0\r\n            // Увеличенная зона клика для Firefox\r\n            ctx.fillStyle = color\r\n            ctx.beginPath()\r\n            ctx.arc(x, y, 22, 0, 2 * Math.PI)\r\n            ctx.fill()\r\n          }}\r\n          nodeLabel={() => \"\"}\r\n          nodeVal={() => 1}\r\n          onNodeHover={(node: Record<string, unknown> | null) => {\r\n            setHoveredNode(node ? (node as unknown as GraphNode) : null)\r\n            if (containerRef.current) {\r\n              containerRef.current.style.cursor = node ? \"pointer\" : \"default\"\r\n            }\r\n          }}\r\n          onNodeClick={handleNodeClick}\r\n          onNodeDrag={handleNodeDrag}\r\n          onNodeDragEnd={handleNodeDragEnd}\r\n          enableNodeDrag={true}\r\n          // Связи\r\n          linkCanvasObject={paintLink}\r\n          linkDirectionalParticles={0}\r\n          linkPointerAreaPaint={() => {}}\r\n          // Навигация\r\n          enableZoomInteraction={true}\r\n          enablePanInteraction={true}\r\n          minZoom={0.3}\r\n          maxZoom={6}\r\n        />\r\n      )}\r\n\r\n      {/* Tooltip -- only on hover, disappears immediately on leave */}\r\n      {hoveredNode && tooltipContent && (\r\n        <div\r\n          className=\"absolute z-40 pointer-events-none font-mono\"\r\n          style={{\r\n            left: Math.min(tooltipPos.x + 18, dimensions.width - 230),\r\n            top: Math.max(tooltipPos.y - 14, 8),\r\n            backgroundColor: \"rgba(10,10,15,0.94)\",\r\n            border: \"1px solid rgba(229,195,75,0.2)\",\r\n            padding: \"10px 14px\",\r\n            minWidth: \"180px\",\r\n            maxWidth: \"240px\",\r\n          }}\r\n        >\r\n          <div className=\"flex items-center gap-2 mb-1.5\">\r\n            <div\r\n              className=\"w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold\"\r\n              style={{\r\n                backgroundColor: tooltipContent.moodCfg.color + \"25\",\r\n                color: tooltipContent.moodCfg.color,\r\n                border: `1px solid ${tooltipContent.moodCfg.color}50`,\r\n              }}\r\n            >\r\n              {tooltipContent.agent.avatar}\r\n            </div>\r\n            <span className=\"text-sm\" style={{ color: \"var(--cyber-glow)\" }}>\r\n              {tooltipContent.agent.name}\r\n            </span>\r\n          </div>\r\n\r\n          <div className=\"text-[10px] flex items-center gap-1.5 mb-2\" style={{ color: tooltipContent.moodCfg.color }}>\r\n            <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: tooltipContent.moodCfg.color }} />\r\n            {tooltipContent.moodCfg.label}\r\n            <span style={{ color: \"var(--muted-foreground)\", marginLeft: 4 }}>\r\n              {tooltipContent.agent.traits.slice(0, 2).join(\", \")}\r\n            </span>\r\n          </div>\r\n\r\n          {tooltipContent.rels.length > 0 && (\r\n            <div style={{ borderTop: \"1px solid rgba(229,195,75,0.1)\" }} className=\"pt-1.5\">\r\n              <div className=\"text-[9px] uppercase tracking-widest mb-1\" style={{ color: \"var(--muted-foreground)\" }}>\r\n                {\"Связи\"}\r\n              </div>\r\n              {tooltipContent.rels.map((rel) => (\r\n                <div key={rel.name} className=\"flex items-center justify-between text-[10px] py-0.5\">\r\n                  <span style={{ color: \"var(--foreground)\" }}>{rel.name}</span>\r\n                  <span style={{ color: sentimentToColor(rel.sentiment), fontSize: \"9px\" }}>{rel.label}</span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          {tooltipContent.rels.length === 0 && (\r\n            <div className=\"text-[10px] pt-1\" style={{ color: \"var(--muted-foreground)\", borderTop: \"1px solid rgba(229,195,75,0.1)\", paddingTop: 6 }}>\r\n              {\"Нет связей с другими агентами\"}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      <Legend />\r\n    </div>\r\n  )\r\n}\r\n\r\n\r\n","\"use client\"\r\n\r\nimport { useEffect, useRef, useState } from \"react\"\n\r\nconst TABS = [\r\n  { id: \"graph\", label: \"ГРАФ\" },\r\n  { id: \"events\", label: \"СОБЫТИЯ\" },\r\n  { id: \"stats\", label: \"СТАТИСТИКА\" },\r\n  { id: \"agents\", label: \"АГЕНТЫ\" },\r\n  { id: \"messages\", label: \"СООБЩЕНИЯ\" },\r\n] as const\r\n\r\nexport type TabId = (typeof TABS)[number][\"id\"]\r\n\r\nconst DEFAULT_SPEED = 1\r\n\r\nexport function CyberFrame({\n  children,\n  activeTab = \"graph\",\n  onTabChange,\n  onAddEvent,\n  timeSpeed = 1,\n  onTimeSpeedChange,\n  onRestartSimulation,\n  worldTime,\n}: {\n  children: React.ReactNode\n  activeTab?: TabId\n  onTabChange?: (tab: TabId) => void\n  onAddEvent?: (text: string) => void\n  timeSpeed?: number\n  onTimeSpeedChange?: (speed: number) => void\n  onRestartSimulation?: () => void\n  worldTime?: string | null\n}) {\n  const [time, setTime] = useState(\"--:--:--\")\r\n  const [date, setDate] = useState(\"--.--.----\")\r\n  const [eventText, setEventText] = useState(\"\")\n  const [speedHover, setSpeedHover] = useState(false)\n  const [mounted, setMounted] = useState(false)\n  const lastNonZeroSpeedRef = useRef(DEFAULT_SPEED)\n\n  const isPaused = timeSpeed <= 0.001\n\n  useEffect(() => {\n    if (timeSpeed > 0.001) {\n      lastNonZeroSpeedRef.current = timeSpeed\n    }\n  }, [timeSpeed])\n\r\n  useEffect(() => {\r\n    setMounted(true)\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (!worldTime) {\r\n      setTime(\"--:--:--\")\r\n      setDate(\"--.--.----\")\r\n      return\r\n    }\r\n\r\n    const base = new Date(worldTime)\r\n    if (Number.isNaN(base.getTime())) {\r\n      setTime(\"--:--:--\")\r\n      setDate(\"--.--.----\")\r\n      return\r\n    }\r\n\r\n    let virtualTimeMs = base.getTime()\r\n    const speed = Math.max(0, timeSpeed)\r\n\r\n    const tick = () => {\r\n      const current = new Date(virtualTimeMs)\r\n      setTime(\r\n        current.toLocaleTimeString(\"ru-RU\", {\r\n          hour: \"2-digit\",\r\n          minute: \"2-digit\",\r\n          second: \"2-digit\",\r\n        })\r\n      )\r\n      setDate(\r\n        current.toLocaleDateString(\"ru-RU\", {\r\n          day: \"2-digit\",\r\n          month: \"2-digit\",\r\n          year: \"numeric\",\r\n        })\r\n      )\r\n\r\n      // 1.0x = 1 in-game minute per real second.\r\n      virtualTimeMs += 1000 * speed * 60\r\n    }\r\n\r\n    tick()\r\n    const id = setInterval(tick, 1000)\r\n    return () => clearInterval(id)\r\n  }, [worldTime, timeSpeed])\r\n\r\n  const handleSubmitEvent = () => {\n    if (eventText.trim() && onAddEvent) {\n      onAddEvent(eventText.trim())\n      setEventText(\"\")\n    }\n  }\n\n  const handleTogglePause = () => {\n    if (!onTimeSpeedChange) {\n      return\n    }\n\n    if (isPaused) {\n      onTimeSpeedChange(Math.max(lastNonZeroSpeedRef.current, DEFAULT_SPEED))\n      return\n    }\n\n    onTimeSpeedChange(0)\n  }\n\r\n  /* percentage-based paddings: 1.2% top/bottom, 1.5% sides -- scales with any screen */\r\n  const framePad = {\r\n    padding: \"1.2% 1.8%\",\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className=\"relative w-screen overflow-hidden flex flex-col\"\r\n      style={{ height: \"100dvh\", backgroundColor: \"var(--background)\" }}\r\n    >\r\n      {/* Scanline overlay */}\r\n      <div\r\n        className=\"pointer-events-none absolute inset-0 z-50\"\r\n        style={{\r\n          background:\r\n            \"repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(229,195,75,0.008) 2px, rgba(229,195,75,0.008) 4px)\",\r\n        }}\r\n      />\r\n\r\n      {/* ========== SVG frame (desktop) ========== */}\r\n      <svg\r\n        className=\"pointer-events-none absolute inset-0 z-40 hidden md:block\"\r\n        style={{ width: \"100%\", height: \"100%\" }}\r\n        viewBox=\"0 0 1000 1000\"\r\n        preserveAspectRatio=\"none\"\r\n        fill=\"none\"\r\n      >\r\n        <defs>\r\n          <filter id=\"glow\">\r\n            <feGaussianBlur stdDeviation=\"2\" result=\"blur\" />\r\n            <feMerge>\r\n              <feMergeNode in=\"blur\" />\r\n              <feMergeNode in=\"SourceGraphic\" />\r\n            </feMerge>\r\n          </filter>\r\n          <filter id=\"glow-strong\">\r\n            <feGaussianBlur stdDeviation=\"4\" result=\"blur\" />\r\n            <feMerge>\r\n              <feMergeNode in=\"blur\" />\r\n              <feMergeNode in=\"SourceGraphic\" />\r\n            </feMerge>\r\n          </filter>\r\n        </defs>\r\n\r\n        {/* Main border */}\r\n        <path\r\n          d=\"M 30 6 L 970 6 L 994 30 L 994 970 L 970 994 L 30 994 L 6 970 L 6 30 Z\"\r\n          stroke=\"var(--cyber-glow)\"\r\n          strokeWidth=\"1.2\"\r\n          filter=\"url(#glow)\"\r\n          opacity=\"0.8\"\r\n        />\r\n        {/* Inner border */}\r\n        <path\r\n          d=\"M 34 10 L 966 10 L 990 34 L 990 966 L 966 990 L 34 990 L 10 966 L 10 34 Z\"\r\n          stroke=\"var(--cyber-glow)\"\r\n          strokeWidth=\"0.3\"\r\n          opacity=\"0.25\"\r\n        />\r\n        {/* Corner accents */}\r\n        <path d=\"M 6 55 L 6 30 L 30 6\" stroke=\"var(--cyber-glow)\" strokeWidth=\"2\" filter=\"url(#glow-strong)\" strokeLinecap=\"square\" />\r\n        <path d=\"M 970 6 L 994 30 L 994 55\" stroke=\"var(--cyber-glow)\" strokeWidth=\"2\" filter=\"url(#glow-strong)\" strokeLinecap=\"square\" />\r\n        <path d=\"M 994 945 L 994 970 L 970 994\" stroke=\"var(--cyber-glow)\" strokeWidth=\"2\" filter=\"url(#glow-strong)\" strokeLinecap=\"square\" />\r\n        <path d=\"M 30 994 L 6 970 L 6 945\" stroke=\"var(--cyber-glow)\" strokeWidth=\"2\" filter=\"url(#glow-strong)\" strokeLinecap=\"square\" />\r\n        {/* Tick marks */}\r\n        {[150, 300, 500, 700, 850].map((x) => (\r\n          <line key={x} x1={x} y1={6} x2={x} y2={12} stroke=\"var(--cyber-glow)\" strokeWidth=\"0.5\" opacity=\"0.35\" />\r\n        ))}\r\n      </svg>\r\n\r\n      {/* Mobile border */}\r\n      <div\r\n        className=\"pointer-events-none absolute inset-[2px] z-40 md:hidden\"\r\n        style={{\r\n          border: \"1px solid var(--cyber-glow)\",\r\n          boxShadow: \"0 0 6px var(--cyber-glow-dim), inset 0 0 6px var(--cyber-glow-dim)\",\r\n          opacity: 0.5,\r\n        }}\r\n      />\r\n\r\n      {/* Side indicators */}\r\n      <div className=\"absolute left-[0.35%] top-1/2 z-40 -translate-y-1/2 flex-col gap-1 hidden lg:flex\">\r\n        {[0.9, 0.7, 0.5, 0.3].map((opacity, i) => (\r\n          <div\r\n            key={i}\r\n            className=\"rounded-sm\"\r\n            style={{\r\n              width: \"3px\",\r\n              height: \"14px\",\r\n              backgroundColor: \"var(--cyber-glow)\",\r\n              opacity,\r\n              boxShadow: \"0 0 4px var(--cyber-glow-dim)\",\r\n            }}\r\n          />\r\n        ))}\r\n      </div>\r\n      <div className=\"absolute right-[0.35%] top-1/2 z-40 -translate-y-1/2 flex-col gap-1 hidden lg:flex\">\r\n        {[0.3, 0.5, 0.7, 0.9].map((opacity, i) => (\r\n          <div\r\n            key={i}\r\n            className=\"rounded-sm\"\r\n            style={{\r\n              width: \"3px\",\r\n              height: \"14px\",\r\n              backgroundColor: \"var(--cyber-glow)\",\r\n              opacity,\r\n              boxShadow: \"0 0 4px var(--cyber-glow-dim)\",\r\n            }}\r\n          />\r\n        ))}\r\n      </div>\r\n\r\n      {/* ============================================= */}\r\n      {/* MAIN CONTENT -- percentage-based spacing      */}\r\n      {/* ============================================= */}\r\n      <div className=\"relative z-10 flex flex-col h-full\" style={framePad}>\r\n\r\n        {/* -------- HEADER -------- */}\r\n        <header className=\"shrink-0 flex flex-col gap-2 pb-[0.6%]\">\r\n          {/* Title row */}\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-4 pl-[1.5%]\">\r\n              <h1\r\n                className=\"font-mono text-base md:text-lg lg:text-xl tracking-[0.2em] uppercase whitespace-nowrap\"\r\n                style={{ color: \"var(--cyber-glow)\" }}\r\n              >\r\n                LONG LIVE MODELS\r\n              </h1>\r\n              <div className=\"flex flex-col items-start gap-1\">\n                <div className=\"flex items-center gap-2\">\n                  <button\n                    onClick={handleTogglePause}\n                    className=\"font-mono text-[10px] md:text-xs tracking-wider uppercase cursor-pointer\"\n                    style={{\n                      color: isPaused ? \"#4ade80\" : \"#f87171\",\n                      border: `1px solid ${isPaused ? \"rgba(74,222,128,0.45)\" : \"rgba(248,113,113,0.45)\"}`,\n                      backgroundColor: isPaused ? \"rgba(74,222,128,0.12)\" : \"rgba(248,113,113,0.12)\",\n                      padding: \"2px 8px\",\n                      transition: \"all 0.2s ease\",\n                    }}\n                    title={isPaused ? \"Продолжить течение игрового времени\" : \"Остановить течение игрового времени\"}\n                  >\n                    {isPaused ? \"ПРОДОЛЖИТЬ ВРЕМЯ\" : \"ОСТАНОВИТЬ ВРЕМЯ\"}\n                  </button>\n\n                  <button\n                    onClick={onRestartSimulation}\n                    disabled={!onRestartSimulation}\n                    className=\"font-mono text-[10px] md:text-xs tracking-wider uppercase cursor-pointer disabled:cursor-not-allowed\"\n                    style={{\n                      color: !onRestartSimulation ? \"var(--muted-foreground)\" : \"var(--cyber-glow)\",\n                      border: \"1px solid rgba(229,195,75,0.35)\",\n                      backgroundColor: !onRestartSimulation ? \"rgba(229,195,75,0.03)\" : \"rgba(229,195,75,0.1)\",\n                      padding: \"2px 8px\",\n                      transition: \"all 0.2s ease\",\n                    }}\n                    title=\"Полностью сбросить мир и начать симуляцию заново\"\n                  >\n                    НАЧАТЬ ЗАНОВО\n                  </button>\n                </div>\n\n                <span\n                  className=\"font-mono text-xs md:text-sm tabular-nums whitespace-nowrap\"\n                  style={{ color: \"var(--cyber-glow)\", opacity: 0.5 }}\n                >\n                  {date}\n                  <span className=\"mx-1.5\" style={{ opacity: 0.4 }}>{\"/\"}</span>\n                  {time}\n                </span>\n              </div>\n            </div>\n          </div>\n\r\n          {/* Nav row */}\r\n          <div className=\"flex items-center justify-between\">\r\n            <nav className=\"flex items-center pl-[1.5%]\">\r\n              {TABS.map((tab) => {\r\n                const isActive = activeTab === tab.id\r\n                return (\r\n                  <button\r\n                    key={tab.id}\r\n                    onClick={() => onTabChange?.(tab.id)}\r\n                    className=\"font-mono text-sm md:text-base tracking-wider uppercase cursor-pointer whitespace-nowrap\"\r\n                    style={{\r\n                      padding: \"6px 14px\",\r\n                      color: isActive ? \"var(--cyber-glow)\" : \"var(--muted-foreground)\",\r\n                      backgroundColor: isActive ? \"rgba(229,195,75,0.1)\" : \"transparent\",\r\n                      borderBottom: isActive ? \"2px solid var(--cyber-glow)\" : \"2px solid transparent\",\r\n                      textShadow: isActive ? \"0 0 10px rgba(229,195,75,0.4)\" : \"none\",\r\n                      transition: \"all 0.2s ease\",\r\n                    }}\r\n                    onMouseEnter={(e) => {\r\n                      if (!isActive) {\r\n                        e.currentTarget.style.color = \"var(--cyber-glow)\"\r\n                        e.currentTarget.style.backgroundColor = \"rgba(229,195,75,0.06)\"\r\n                        e.currentTarget.style.textShadow = \"0 0 10px rgba(229,195,75,0.3)\"\r\n                        e.currentTarget.style.borderBottom = \"2px solid rgba(229,195,75,0.4)\"\r\n                      }\r\n                    }}\r\n                    onMouseLeave={(e) => {\r\n                      if (!isActive) {\r\n                        e.currentTarget.style.color = \"var(--muted-foreground)\"\r\n                        e.currentTarget.style.backgroundColor = \"transparent\"\r\n                        e.currentTarget.style.textShadow = \"none\"\r\n                        e.currentTarget.style.borderBottom = \"2px solid transparent\"\r\n                      }\r\n                    }}\r\n                  >\r\n                    {tab.label}\r\n                  </button>\r\n                )\r\n              })}\r\n            </nav>\r\n\r\n            {/* Speed control */}\r\n            <div\r\n              className=\"relative flex items-center gap-3 shrink-0\"\r\n              style={{\r\n                padding: \"5px 14px\",\r\n                backgroundColor: \"rgba(229,195,75,0.04)\",\r\n                border: \"1px solid rgba(229,195,75,0.1)\",\r\n                clipPath: \"polygon(4px 0, calc(100% - 4px) 0, 100% 4px, 100% calc(100% - 4px), calc(100% - 4px) 100%, 4px 100%, 0 calc(100% - 4px), 0 4px)\",\r\n              }}\r\n              onMouseEnter={() => setSpeedHover(true)}\r\n              onMouseLeave={() => setSpeedHover(false)}\r\n            >\r\n              <span\r\n                className=\"font-mono text-xs tracking-widest uppercase select-none\"\r\n                style={{ color: \"var(--muted-foreground)\" }}\r\n              >\r\n                {\"СКОРОСТЬ\"}\r\n              </span>\r\n\r\n              <input\r\n                type=\"range\"\r\n                min={0}\r\n                max={5}\r\n                step={0.1}\r\n                value={timeSpeed}\r\n                onChange={(e) => onTimeSpeedChange?.(Math.round(parseFloat(e.target.value) * 10) / 10)}\r\n                className=\"cyber-slider h-1\"\r\n                style={{\r\n                  width: \"clamp(80px, 8vw, 160px)\",\r\n                  background: `linear-gradient(to right, var(--cyber-glow) ${(timeSpeed / 5) * 100}%, var(--border) ${(timeSpeed / 5) * 100}%)`,\r\n                }}\r\n              />\r\n\r\n              <button\r\n                onClick={() => onTimeSpeedChange?.(DEFAULT_SPEED)}\r\n                className=\"font-mono text-sm tabular-nums cursor-pointer\"\r\n                title={mounted ? `Клик = сброс на ${DEFAULT_SPEED}x` : undefined}\r\n                style={{\r\n                  color: \"var(--cyber-glow)\",\r\n                  textShadow: timeSpeed > 0 ? \"0 0 8px rgba(229,195,75,0.4)\" : \"none\",\r\n                  background: \"none\",\r\n                  border: \"none\",\r\n                  padding: 0,\r\n                  width: \"3.5em\",\r\n                  textAlign: \"right\",\r\n                  transition: \"opacity 0.2s ease, text-shadow 0.2s ease\",\r\n                  opacity: timeSpeed === DEFAULT_SPEED ? 0.7 : 1,\r\n                }}\r\n                onMouseEnter={(e) => {\r\n                  e.currentTarget.style.textShadow = \"0 0 14px rgba(229,195,75,0.7)\"\r\n                }}\r\n                onMouseLeave={(e) => {\r\n                  e.currentTarget.style.textShadow = timeSpeed > 0 ? \"0 0 8px rgba(229,195,75,0.4)\" : \"none\"\r\n                }}\r\n              >\r\n                {timeSpeed.toFixed(1)}x\r\n              </button>\r\n\r\n              {speedHover && (\r\n                <div\r\n                  className=\"absolute top-full right-0 mt-2 px-3 py-1.5 font-mono text-[10px] tracking-wide whitespace-nowrap pointer-events-none z-50 hidden lg:block\"\r\n                  style={{\r\n                    backgroundColor: \"rgba(17,17,24,0.95)\",\r\n                    border: \"1px solid rgba(229,195,75,0.25)\",\r\n                    color: \"var(--cyber-glow)\",\r\n                    clipPath: \"polygon(4px 0, calc(100% - 4px) 0, 100% 4px, 100% calc(100% - 4px), calc(100% - 4px) 100%, 4px 100%, 0 calc(100% - 4px), 0 4px)\",\r\n                  }}\r\n                >\r\n                  {\"Скорость течения времени мира // Клик на значение = сброс\"}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </header>\r\n\r\n        {/* -------- CONTENT -------- */}\r\n        <div\r\n          className=\"relative flex-1 min-h-0 overflow-hidden rounded-sm border\"\r\n          style={{ borderColor: \"rgba(229,195,75,0.2)\" }}\r\n        >\r\n          {children}\r\n        </div>\r\n\r\n        {/* -------- BOTTOM PANEL -------- */}\r\n        <div className=\"shrink-0\" style={{ paddingTop: \"0.6%\" }}>\r\n          <div\r\n            className=\"relative overflow-hidden\"\r\n            style={{\r\n              clipPath: \"polygon(8px 0, calc(100% - 8px) 0, 100% 8px, 100% calc(100% - 8px), calc(100% - 8px) 100%, 8px 100%, 0 calc(100% - 8px), 0 8px)\",\r\n            }}\r\n          >\r\n            <div\r\n              className=\"flex items-center gap-3\"\r\n              style={{\r\n                padding: \"4px 6px\",\r\n                border: \"1px solid rgba(229,195,75,0.2)\",\r\n                backgroundColor: \"rgba(17,17,24,0.9)\",\r\n                animation: \"cyber-shimmer 4s ease-in-out infinite\",\r\n                clipPath: \"polygon(8px 0, calc(100% - 8px) 0, 100% 8px, 100% calc(100% - 8px), calc(100% - 8px) 100%, 8px 100%, 0 calc(100% - 8px), 0 8px)\",\r\n              }}\r\n            >\r\n              {/* Pulsing dot */}\r\n              <div className=\"shrink-0 pl-2\">\r\n                <div\r\n                  className=\"h-2 w-2 rounded-full\"\r\n                  style={{\r\n                    backgroundColor: \"var(--cyber-glow)\",\r\n                    boxShadow: \"0 0 6px var(--cyber-glow-dim)\",\r\n                    animation: \"cyber-pulse 2s ease-in-out infinite\",\r\n                  }}\r\n                />\r\n              </div>\r\n\r\n              <input\r\n                type=\"text\"\r\n                value={eventText}\r\n                onChange={(e) => setEventText(e.target.value)}\r\n                onKeyDown={(e) => {\r\n                  if (e.key === \"Enter\") {\r\n                    e.preventDefault()\r\n                    handleSubmitEvent()\r\n                  }\r\n                }}\r\n                placeholder=\"Введите событие для мира агентов...\"\r\n                className=\"flex-1 bg-transparent font-mono text-sm md:text-base py-2.5 placeholder:opacity-30 focus:outline-none\"\r\n                style={{\r\n                  color: \"var(--foreground)\",\r\n                  caretColor: \"var(--cyber-glow)\",\r\n                  paddingLeft: \"8px\",\r\n                  paddingRight: \"8px\",\r\n                }}\r\n              />\r\n\r\n              <button\r\n                onClick={handleSubmitEvent}\r\n                className=\"shrink-0 font-mono text-xs md:text-sm tracking-widest uppercase cursor-pointer\"\r\n                style={{\r\n                  padding: \"10px 20px\",\r\n                  marginRight: \"4px\",\r\n                  backgroundColor: \"rgba(229,195,75,0.08)\",\r\n                  color: \"var(--cyber-glow)\",\r\n                  border: \"1px solid rgba(229,195,75,0.25)\",\r\n                  clipPath: \"polygon(6px 0, calc(100% - 6px) 0, 100% 6px, 100% calc(100% - 6px), calc(100% - 6px) 100%, 6px 100%, 0 calc(100% - 6px), 0 6px)\",\r\n                  transition: \"all 0.25s ease\",\r\n                }}\r\n                onMouseEnter={(e) => {\r\n                  e.currentTarget.style.backgroundColor = \"rgba(229,195,75,0.18)\"\r\n                  e.currentTarget.style.borderColor = \"rgba(229,195,75,0.6)\"\r\n                  e.currentTarget.style.boxShadow = \"0 0 20px rgba(229,195,75,0.15), inset 0 0 12px rgba(229,195,75,0.06)\"\r\n                  e.currentTarget.style.textShadow = \"0 0 10px rgba(229,195,75,0.5)\"\r\n                  e.currentTarget.style.color = \"#f5d96b\"\r\n                }}\r\n                onMouseLeave={(e) => {\r\n                  e.currentTarget.style.backgroundColor = \"rgba(229,195,75,0.08)\"\r\n                  e.currentTarget.style.borderColor = \"rgba(229,195,75,0.25)\"\r\n                  e.currentTarget.style.boxShadow = \"none\"\r\n                  e.currentTarget.style.textShadow = \"none\"\r\n                  e.currentTarget.style.color = \"var(--cyber-glow)\"\r\n                }}\r\n                onMouseDown={(e) => {\r\n                  e.currentTarget.style.backgroundColor = \"rgba(229,195,75,0.3)\"\r\n                  e.currentTarget.style.transform = \"scale(0.97)\"\r\n                }}\r\n                onMouseUp={(e) => {\r\n                  e.currentTarget.style.backgroundColor = \"rgba(229,195,75,0.18)\"\r\n                  e.currentTarget.style.transform = \"scale(1)\"\r\n                }}\r\n              >\r\n                {\"ДОБАВИТЬ СОБЫТИЕ\"}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","\"use client\"\n\nimport { useEffect, useState } from \"react\"\nimport {\n  HubConnectionBuilder,\n  LogLevel,\n  type HubConnection,\n} from \"@microsoft/signalr\"\nimport { MOOD_CONFIG, getAgents, getEvents, type Agent, type AgentEvent } from \"@/lib/data\"\n\nconst DEFAULT_USER_ID = \"demo-user\"\nconst REALTIME_EVENT_NAMES = [\n  \"events.updated\",\n  \"agents.list.updated\",\n  \"agent.status.changed\",\n  \"agent.message\",\n  \"agent.progress\",\n  \"agent.thought\",\n  \"agent.error\",\n]\n\nconst EVENT_TYPE_LABELS: Record<AgentEvent[\"type\"], { label: string; color: string }> = {\n  chat: { label: \"ЧАТ\", color: \"#4ade80\" },\n  action: { label: \"ДЕЙСТВИЕ\", color: \"#e5c34b\" },\n  emotion: { label: \"ЭМОЦИЯ\", color: \"#c084fc\" },\n  system: { label: \"СИСТЕМА\", color: \"#60a5fa\" },\n}\n\nfunction getRealtimeBackendBaseUrl(): string {\n  const raw = process.env.NEXT_PUBLIC_BACKEND_URL?.trim()\n  if (raw && raw.length > 0) {\n    return raw.replace(/\\/+$/, \"\")\n  }\n\n  return \"http://localhost:5133\"\n}\n\nfunction getUserId(): string {\n  const fromEnv = process.env.NEXT_PUBLIC_USER_ID?.trim()\n  return fromEnv && fromEnv.length > 0 ? fromEnv : DEFAULT_USER_ID\n}\n\nfunction formatTime(iso: string) {\n  const d = new Date(iso)\n  return d.toLocaleTimeString(\"ru-RU\", {\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n  })\n}\n\nexport function EventsPanel({ refreshToken }: { refreshToken?: number }) {\n  const [events, setEvents] = useState<AgentEvent[]>([])\n  const [agents, setAgents] = useState<Agent[]>([])\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    let active = true\n    let connection: HubConnection | null = null\n\n    const loadData = async ({ silent = false }: { silent?: boolean } = {}) => {\n      if (!silent) {\n        setLoading(true)\n      }\n\n      try {\n        const [loadedEvents, loadedAgents] = await Promise.all([getEvents(), getAgents()])\n        if (!active) {\n          return\n        }\n\n        setEvents(loadedEvents)\n        setAgents(loadedAgents)\n      } finally {\n        if (active && !silent) {\n          setLoading(false)\n        }\n      }\n    }\n\n    const handleRealtimeUpdate = () => {\n      if (!active) {\n        return\n      }\n\n      void loadData({ silent: true })\n    }\n\n    const startRealtime = async () => {\n      const backendBaseUrl = getRealtimeBackendBaseUrl()\n      const userId = getUserId()\n      const hubUrl = `${backendBaseUrl}/hubs/agents?userId=${encodeURIComponent(userId)}`\n\n      connection = new HubConnectionBuilder()\n        .withUrl(hubUrl)\n        .withAutomaticReconnect()\n        .configureLogging(LogLevel.Error)\n        .build()\n\n      for (const eventName of REALTIME_EVENT_NAMES) {\n        connection.on(eventName, handleRealtimeUpdate)\n      }\n\n      connection.onreconnected(() => {\n        if (!active) {\n          return\n        }\n\n        void connection?.invoke(\"SubscribeUser\").catch(() => undefined)\n        void loadData({ silent: true })\n      })\n\n      try {\n        await connection.start()\n        if (!active) {\n          return\n        }\n\n        await connection.invoke(\"SubscribeUser\")\n      } catch (error) {\n        console.warn(\"[events-panel] SignalR connection failed, fallback to polling\", error)\n      }\n    }\n\n    void loadData()\n    void startRealtime()\n\n    const pollingTimer = setInterval(() => {\n      void loadData({ silent: true })\n    }, 5000)\n\n    return () => {\n      active = false\n      clearInterval(pollingTimer)\n\n      if (!connection) {\n        return\n      }\n\n      for (const eventName of REALTIME_EVENT_NAMES) {\n        connection.off(eventName, handleRealtimeUpdate)\n      }\n\n      void connection.stop()\n    }\n  }, [refreshToken])\n\n  return (\n    <div className=\"flex h-full w-full\" style={{ backgroundColor: \"var(--cyber-surface)\" }}>\n      <aside\n        className=\"shrink-0 flex flex-col gap-3 overflow-y-auto border-r py-4 px-3\"\n        style={{ borderColor: \"rgba(229,195,75,0.15)\", width: \"clamp(160px, 15%, 220px)\" }}\n      >\n        <span\n          className=\"font-mono text-[10px] tracking-widest uppercase px-1\"\n          style={{ color: \"var(--muted-foreground)\" }}\n        >\n          {\"АГЕНТЫ ОНЛАЙН\"}\n        </span>\n        {agents.map((agent) => {\n          const mc = MOOD_CONFIG[agent.mood]\n          return (\n            <div\n              key={agent.id}\n              className=\"flex items-center gap-2 px-2 py-2 rounded-sm\"\n              style={{ backgroundColor: \"rgba(229,195,75,0.04)\" }}\n            >\n              <div\n                className=\"shrink-0 flex items-center justify-center font-mono text-xs font-bold rounded-sm\"\n                style={{\n                  width: 32,\n                  height: 32,\n                  backgroundColor: \"rgba(229,195,75,0.1)\",\n                  color: mc.color,\n                  border: `1px solid ${mc.color}`,\n                }}\n              >\n                {agent.avatar}\n              </div>\n              <div className=\"min-w-0\">\n                <div className=\"font-mono text-xs truncate\" style={{ color: \"var(--foreground)\" }}>\n                  {agent.name}\n                </div>\n                <div className=\"font-mono text-[10px]\" style={{ color: mc.color }}>\n                  {mc.label}\n                </div>\n              </div>\n            </div>\n          )\n        })}\n      </aside>\n\n      <div className=\"flex-1 flex flex-col min-w-0\">\n        <div\n          className=\"shrink-0 flex items-center justify-between px-4 py-2 border-b\"\n          style={{ borderColor: \"rgba(229,195,75,0.15)\" }}\n        >\n          <span className=\"font-mono text-sm tracking-widest uppercase\" style={{ color: \"var(--cyber-glow)\" }}>\n            {\"ЛЕНТА СОБЫТИЙ\"}\n          </span>\n          <span className=\"font-mono text-[10px]\" style={{ color: \"var(--muted-foreground)\" }}>\n            {events.length} {\"событий\"}\n          </span>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto px-4 py-3 flex flex-col gap-1.5\">\n          {loading && (\n            <div className=\"font-mono text-xs\" style={{ color: \"var(--muted-foreground)\" }}>\n              Загрузка событий...\n            </div>\n          )}\n\n          {!loading && events.length === 0 && (\n            <div className=\"font-mono text-xs\" style={{ color: \"var(--muted-foreground)\" }}>\n              Событий пока нет\n            </div>\n          )}\n\n          {events.map((evt) => {\n            const typeConf = EVENT_TYPE_LABELS[evt.type]\n            return (\n              <div\n                key={evt.id}\n                className=\"group flex items-start gap-3 px-3 py-2.5 rounded-sm\"\n                style={{\n                  backgroundColor: \"rgba(229,195,75,0.02)\",\n                  borderLeft: `2px solid ${typeConf.color}`,\n                  transition: \"background-color 0.15s ease\",\n                }}\n                onMouseEnter={(e) => {\n                  e.currentTarget.style.backgroundColor = \"rgba(229,195,75,0.06)\"\n                }}\n                onMouseLeave={(e) => {\n                  e.currentTarget.style.backgroundColor = \"rgba(229,195,75,0.02)\"\n                }}\n              >\n                <span\n                  className=\"shrink-0 font-mono text-[11px] tabular-nums pt-0.5\"\n                  style={{ color: \"var(--muted-foreground)\", width: \"64px\" }}\n                >\n                  {formatTime(evt.timestamp)}\n                </span>\n\n                <span\n                  className=\"shrink-0 font-mono text-[9px] tracking-wider uppercase px-1.5 py-0.5 rounded-sm mt-0.5\"\n                  style={{\n                    color: typeConf.color,\n                    backgroundColor: `${typeConf.color}15`,\n                    border: `1px solid ${typeConf.color}30`,\n                  }}\n                >\n                  {typeConf.label}\n                </span>\n\n                <div className=\"flex-1 min-w-0\">\n                  <span className=\"font-mono text-xs font-bold mr-2\" style={{ color: \"var(--cyber-glow)\" }}>\n                    {evt.agentName}\n                  </span>\n                  <span className=\"font-mono text-xs\" style={{ color: \"var(--foreground)\", opacity: 0.85 }}>\n                    {evt.text}\n                  </span>\n                </div>\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    </div>\n  )\n}\r\n","\"use client\"\r\n\r\nimport { useEffect, useRef, useState } from \"react\"\r\nimport {\r\n  deleteAgent,\r\n  MOOD_CONFIG,\r\n  generateAgentWithAi,\r\n  getAgents,\r\n  getEvents,\r\n  getRelationships,\r\n  type Agent,\r\n  type AgentEvent,\r\n  type Relationship,\r\n} from \"@/lib/data\"\r\n\r\nfunction AgentDetail({\r\n  agent,\r\n  onBack,\r\n  fromGraph,\r\n  allAgents,\r\n  allEvents,\r\n  allRelationships,\r\n  onDelete,\r\n  deleting,\r\n  deleteError,\r\n}: {\r\n  agent: Agent\r\n  onBack: () => void\r\n  fromGraph?: boolean\r\n  allAgents: Agent[]\r\n  allEvents: AgentEvent[]\r\n  allRelationships: Relationship[]\r\n  onDelete: (agentId: string) => void\r\n  deleting: boolean\r\n  deleteError: string | null\r\n}) {\r\n  const mc = MOOD_CONFIG[agent.mood]\r\n  const events = allEvents.filter((e) => e.agentId === agent.id)\r\n  const relations = allRelationships.filter(\r\n    (r) => r.from === agent.id || r.to === agent.id\r\n  )\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full\" style={{ backgroundColor: \"var(--cyber-surface)\" }}>\r\n      {/* Header */}\r\n      <div\r\n        className=\"shrink-0 flex items-center gap-3 px-5 py-3 border-b\"\r\n        style={{ borderColor: \"rgba(229,195,75,0.15)\" }}\r\n      >\r\n        <button\r\n          onClick={onBack}\r\n          className=\"font-mono text-xs tracking-wider uppercase cursor-pointer\"\r\n          style={{\r\n            color: \"var(--cyber-glow)\",\r\n            padding: \"4px 10px\",\r\n            border: \"1px solid rgba(229,195,75,0.25)\",\r\n            backgroundColor: \"rgba(229,195,75,0.05)\",\r\n            transition: \"all 0.2s ease\",\r\n          }}\r\n          onMouseEnter={(e) => {\r\n            e.currentTarget.style.backgroundColor = \"rgba(229,195,75,0.15)\"\r\n            e.currentTarget.style.borderColor = \"rgba(229,195,75,0.5)\"\r\n          }}\r\n          onMouseLeave={(e) => {\r\n            e.currentTarget.style.backgroundColor = \"rgba(229,195,75,0.05)\"\r\n            e.currentTarget.style.borderColor = \"rgba(229,195,75,0.25)\"\r\n          }}\r\n        >\r\n          {fromGraph ? \"<- К ГРАФУ\" : \"<- НАЗАД\"}\n        </button>\n        <span className=\"font-mono text-sm tracking-widest uppercase\" style={{ color: \"var(--cyber-glow)\" }}>\n          {\"ДОСЬЕ АГЕНТА\"}\n        </span>\n        <button\r\n          onClick={() => onDelete(agent.id)}\r\n          disabled={deleting}\r\n          className=\"ml-auto font-mono text-xs tracking-wider uppercase cursor-pointer disabled:cursor-not-allowed\"\r\n          style={{\r\n            color: deleting ? \"var(--muted-foreground)\" : \"#f87171\",\r\n            padding: \"4px 10px\",\r\n            border: \"1px solid rgba(248,113,113,0.35)\",\r\n            backgroundColor: deleting ? \"rgba(248,113,113,0.05)\" : \"rgba(248,113,113,0.1)\",\r\n            transition: \"all 0.2s ease\",\r\n          }}\r\n        >\r\n          {deleting ? \"УДАЛЕНИЕ...\" : \"УДАЛИТЬ АГЕНТА\"}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"flex-1 overflow-y-auto px-5 py-4 flex flex-col gap-5\">\r\n        {/* Profile card */}\r\n        <div className=\"flex items-start gap-4\">\r\n          <div\r\n            className=\"shrink-0 flex items-center justify-center font-mono text-2xl font-bold rounded-sm\"\r\n            style={{\r\n              width: 64,\r\n              height: 64,\r\n              backgroundColor: \"rgba(229,195,75,0.1)\",\r\n              color: mc.color,\r\n              border: `2px solid ${mc.color}`,\r\n              boxShadow: `0 0 12px ${mc.color}30`,\r\n            }}\r\n          >\r\n            {agent.avatar}\r\n          </div>\r\n          <div className=\"flex flex-col gap-1 min-w-0\">\r\n            <h2 className=\"font-mono text-lg uppercase tracking-wider\" style={{ color: \"var(--foreground)\" }}>\r\n              {agent.name}\r\n            </h2>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"h-2 w-2 rounded-full\" style={{ backgroundColor: mc.color }} />\r\n              <span className=\"font-mono text-xs\" style={{ color: mc.color }}>{mc.label}</span>\r\n            </div>\r\n            <p className=\"font-mono text-xs mt-1\" style={{ color: \"var(--muted-foreground)\" }}>\r\n              {agent.description}\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Traits */}\r\n        <div>\r\n          <h3 className=\"font-mono text-[10px] tracking-widest uppercase mb-2\" style={{ color: \"var(--muted-foreground)\" }}>\n            {\"ЧЕРТЫ ХАРАКТЕРА\"}\n          </h3>\n          <div className=\"flex flex-wrap gap-1.5\">\r\n            {agent.traits.map((t) => (\r\n              <span\r\n                key={t}\r\n                className=\"font-mono text-[11px] px-2 py-0.5 rounded-sm\"\r\n                style={{\r\n                  color: \"var(--cyber-glow)\",\r\n                  backgroundColor: \"rgba(229,195,75,0.08)\",\r\n                  border: \"1px solid rgba(229,195,75,0.2)\",\r\n                }}\r\n              >\r\n                {t}\r\n              </span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Current plan */}\r\n        <div>\r\n          <h3 className=\"font-mono text-[10px] tracking-widest uppercase mb-2\" style={{ color: \"var(--muted-foreground)\" }}>\n            {\"ТЕКУЩИЙ ПЛАН\"}\n          </h3>\n          <p className=\"font-mono text-xs\" style={{ color: \"var(--foreground)\", opacity: 0.9 }}>\r\n            {agent.currentPlan}\r\n          </p>\r\n        </div>\r\n\r\n        {/* Relationships */}\r\n        <div>\r\n          <h3 className=\"font-mono text-[10px] tracking-widest uppercase mb-2\" style={{ color: \"var(--muted-foreground)\" }}>\n            {\"ОТНОШЕНИЯ\"}\n          </h3>\n          <div className=\"flex flex-col gap-1.5\">\r\n            {relations.map((rel, i) => {\r\n              const otherId = rel.from === agent.id ? rel.to : rel.from\r\n              const other = allAgents.find((a) => a.id === otherId)\r\n              const sentColor = rel.sentiment > 0 ? \"#4ade80\" : rel.sentiment < 0 ? \"#f87171\" : \"#a0a0b0\"\r\n              return (\r\n                <div\r\n                  key={i}\r\n                  className=\"flex items-center justify-between px-3 py-2 rounded-sm\"\r\n                  style={{ backgroundColor: \"rgba(229,195,75,0.03)\", borderLeft: `2px solid ${sentColor}` }}\r\n                >\r\n                  <span className=\"font-mono text-xs\" style={{ color: \"var(--foreground)\" }}>\r\n                    {other?.name || otherId}\r\n                  </span>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span className=\"font-mono text-[10px]\" style={{ color: \"var(--muted-foreground)\" }}>\r\n                      {rel.label}\r\n                    </span>\r\n                    <span className=\"font-mono text-xs font-bold\" style={{ color: sentColor }}>\r\n                      {rel.sentiment > 0 ? \"+\" : \"\"}{(rel.sentiment * 100).toFixed(0)}%\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              )\r\n            })}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Memories */}\r\n        <div>\r\n          <h3 className=\"font-mono text-[10px] tracking-widest uppercase mb-2\" style={{ color: \"var(--muted-foreground)\" }}>\n            {\"ВОСПОМИНАНИЯ\"}\n          </h3>\n          <div className=\"flex flex-col gap-1\">\r\n            {agent.memories.map((m, i) => (\r\n              <div key={i} className=\"flex items-start gap-2 py-1\">\r\n                <div className=\"shrink-0 mt-1.5 h-1 w-1 rounded-full\" style={{ backgroundColor: \"var(--cyber-glow)\", opacity: 0.5 }} />\r\n                <span className=\"font-mono text-xs\" style={{ color: \"var(--foreground)\", opacity: 0.8 }}>{m}</span>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Recent events */}\r\n        <div>\n          <h3 className=\"font-mono text-[10px] tracking-widest uppercase mb-2\" style={{ color: \"var(--muted-foreground)\" }}>\n            {\"ПОСЛЕДНИЕ СОБЫТИЯ\"}\n          </h3>\n          <div className=\"flex flex-col gap-1\">\r\n            {events.map((evt) => (\r\n              <div key={evt.id} className=\"flex items-start gap-2 py-1.5 px-2 rounded-sm\" style={{ backgroundColor: \"rgba(229,195,75,0.02)\" }}>\r\n                <span className=\"shrink-0 font-mono text-[10px] tabular-nums\" style={{ color: \"var(--muted-foreground)\", width: 56 }}>\r\n                  {new Date(evt.timestamp).toLocaleTimeString(\"ru-RU\", { hour: \"2-digit\", minute: \"2-digit\" })}\r\n                </span>\r\n                <span className=\"font-mono text-xs\" style={{ color: \"var(--foreground)\", opacity: 0.8 }}>{evt.text}</span>\r\n              </div>\r\n            ))}\n          </div>\n        </div>\n\n        {deleteError ? (\n          <div className=\"font-mono text-[11px]\" style={{ color: \"#f87171\" }}>\n            {deleteError}\n          </div>\n        ) : null}\n      </div>\n    </div>\n  )\n}\n\r\nexport function AgentsPanel({\r\n  preSelectedAgentId,\r\n  onClearSelection,\r\n  fromGraph,\r\n  refreshToken,\r\n}: {\r\n  preSelectedAgentId?: string | null\r\n  onClearSelection?: () => void\r\n  fromGraph?: boolean\r\n  refreshToken?: number\r\n}) {\r\n  const [selectedId, setSelectedId] = useState<string | null>(preSelectedAgentId ?? null)\r\n  const [agents, setAgents] = useState<Agent[]>([])\r\n  const [events, setEvents] = useState<AgentEvent[]>([])\r\n  const [relationships, setRelationships] = useState<Relationship[]>([])\r\n  const [loading, setLoading] = useState(true)\n  const [generationPrompt, setGenerationPrompt] = useState(\"\")\n  const [generationError, setGenerationError] = useState<string | null>(null)\n  const [generating, setGenerating] = useState(false)\n  const [deleting, setDeleting] = useState(false)\n  const [deleteError, setDeleteError] = useState<string | null>(null)\n\n  const reloadAll = async () => {\n    const [loadedAgents, loadedEvents, loadedRelationships] = await Promise.all([\n      getAgents(),\n      getEvents(),\n      getRelationships(),\n    ])\n    setAgents(loadedAgents)\n    setEvents(loadedEvents)\n    setRelationships(loadedRelationships)\n  }\n\r\n  useEffect(() => {\r\n    let active = true\r\n    setLoading(true)\r\n\r\n    Promise.all([getAgents(), getEvents(), getRelationships()])\r\n      .then(([loadedAgents, loadedEvents, loadedRelationships]) => {\r\n        if (!active) return\r\n        setAgents(loadedAgents)\r\n        setEvents(loadedEvents)\r\n        setRelationships(loadedRelationships)\r\n      })\r\n      .finally(() => {\r\n        if (active) {\r\n          setLoading(false)\r\n        }\r\n      })\r\n\r\n    return () => {\r\n      active = false\r\n    }\r\n  }, [refreshToken])\r\n\r\n  const handleGenerate = async () => {\r\n    const prompt = generationPrompt.trim()\r\n    if (!prompt || generating) {\r\n      return\r\n    }\r\n\r\n    setGenerating(true)\r\n    setGenerationError(null)\r\n\r\n    try {\r\n      const created = await generateAgentWithAi(prompt)\r\n      if (!created) {\r\n        setGenerationError(\"Не удалось сгенерировать агента. Проверь backend и OPENAI_API_KEY.\")\n        return\r\n      }\r\n\r\n      await reloadAll()\n      setGenerationPrompt(\"\")\n      setSelectedId(created.id)\n    } finally {\n      setGenerating(false)\n    }\n  }\n\n  const handleDelete = async (agentId: string) => {\n    if (deleting) {\n      return\n    }\n\n    const agentName = agents.find((agent) => agent.id === agentId)?.name ?? agentId\n    if (!window.confirm(`Удалить агента \"${agentName}\"?`)) {\n      return\n    }\n\n    setDeleting(true)\n    setDeleteError(null)\n    try {\n      const removed = await deleteAgent(agentId)\n      if (!removed) {\n        setDeleteError(\"Не удалось удалить агента. Проверь backend и попробуй снова.\")\n        return\n      }\n\n      await reloadAll()\n      setSelectedId(null)\n      onClearSelection?.()\n    } finally {\n      setDeleting(false)\n    }\n  }\n\r\n  // Синхронизация с внешним выбором (из клика по ноде)\n  const prevPreSelected = useRef(preSelectedAgentId)\r\n  if (preSelectedAgentId && preSelectedAgentId !== prevPreSelected.current) {\r\n    prevPreSelected.current = preSelectedAgentId\r\n    if (selectedId !== preSelectedAgentId) {\r\n      setSelectedId(preSelectedAgentId)\r\n    }\r\n  }\r\n\r\n  const selected = agents.find((a) => a.id === selectedId)\r\n\r\n  if (selected) {\r\n    return (\r\n      <AgentDetail\n        agent={selected}\n        allAgents={agents}\n        allEvents={events}\n        allRelationships={relationships}\n        onDelete={handleDelete}\n        deleting={deleting}\n        deleteError={deleteError}\n        onBack={() => {\n          setSelectedId(null)\n          onClearSelection?.()\n        }}\n        fromGraph={fromGraph}\r\n      />\r\n    )\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex h-full items-center justify-center font-mono text-xs\" style={{ backgroundColor: \"var(--cyber-surface)\", color: \"var(--muted-foreground)\" }}>\n        Загрузка агентов...\n      </div>\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full\" style={{ backgroundColor: \"var(--cyber-surface)\" }}>\r\n      <div\r\n        className=\"shrink-0 flex items-center justify-between px-5 py-3 border-b\"\r\n        style={{ borderColor: \"rgba(229,195,75,0.15)\" }}\r\n      >\r\n        <span className=\"font-mono text-sm tracking-widest uppercase\" style={{ color: \"var(--cyber-glow)\" }}>\n          {\"СПИСОК АГЕНТОВ\"}\n        </span>\n        <span className=\"font-mono text-[10px]\" style={{ color: \"var(--muted-foreground)\" }}>\n          {agents.length} {\"агентов\"}\n        </span>\n      </div>\r\n\r\n      <div className=\"px-5 py-3 border-b\" style={{ borderColor: \"rgba(229,195,75,0.12)\" }}>\r\n        <div className=\"flex gap-2\">\r\n          <input\r\n            type=\"text\"\r\n            value={generationPrompt}\n            onChange={(e) => setGenerationPrompt(e.target.value)}\n            placeholder=\"Опиши агента для ИИ...\"\n            className=\"flex-1 font-mono text-xs px-3 py-2 rounded-sm outline-none\"\r\n            style={{\r\n              backgroundColor: \"rgba(229,195,75,0.04)\",\r\n              border: \"1px solid rgba(229,195,75,0.2)\",\r\n              color: \"var(--foreground)\",\r\n            }}\r\n            disabled={generating}\r\n          />\r\n          <button\r\n            onClick={handleGenerate}\r\n            disabled={generating || generationPrompt.trim().length === 0}\r\n            className=\"font-mono text-xs tracking-wider uppercase px-3 py-2 rounded-sm cursor-pointer disabled:cursor-not-allowed\"\r\n            style={{\r\n              color: generating ? \"var(--muted-foreground)\" : \"var(--cyber-glow)\",\r\n              backgroundColor: generating ? \"rgba(229,195,75,0.02)\" : \"rgba(229,195,75,0.08)\",\r\n              border: \"1px solid rgba(229,195,75,0.25)\",\r\n            }}\r\n          >\n            {generating ? \"ГЕНЕРАЦИЯ...\" : \"СОЗДАТЬ ИИ\"}\n          </button>\n        </div>\r\n        {generationError ? (\r\n          <p className=\"mt-2 font-mono text-[10px]\" style={{ color: \"#f87171\" }}>\r\n            {generationError}\r\n          </p>\r\n        ) : null}\r\n      </div>\r\n\r\n      <div className=\"flex-1 overflow-y-auto px-5 py-4 grid grid-cols-1 md:grid-cols-2 gap-3 auto-rows-min\">\r\n        {agents.length === 0 ? (\r\n          <div\r\n            className=\"col-span-full flex items-center justify-center font-mono text-xs py-8\"\r\n            style={{ color: \"var(--muted-foreground)\" }}\r\n          >\n            Агентов пока нет. Опиши первого и нажми \"СОЗДАТЬ ИИ\".\n          </div>\n        ) : null}\r\n        {agents.map((agent) => {\r\n          const mc = MOOD_CONFIG[agent.mood]\r\n          return (\r\n            <button\r\n              key={agent.id}\r\n              onClick={() => setSelectedId(agent.id)}\r\n              className=\"text-left p-4 rounded-sm cursor-pointer flex items-start gap-3\"\r\n              style={{\r\n                backgroundColor: \"rgba(229,195,75,0.03)\",\r\n                border: \"1px solid rgba(229,195,75,0.1)\",\r\n                transition: \"all 0.2s ease\",\r\n              }}\r\n              onMouseEnter={(e) => {\r\n                e.currentTarget.style.backgroundColor = \"rgba(229,195,75,0.08)\"\r\n                e.currentTarget.style.borderColor = \"rgba(229,195,75,0.3)\"\r\n                e.currentTarget.style.boxShadow = \"0 0 12px rgba(229,195,75,0.06)\"\r\n              }}\r\n              onMouseLeave={(e) => {\r\n                e.currentTarget.style.backgroundColor = \"rgba(229,195,75,0.03)\"\r\n                e.currentTarget.style.borderColor = \"rgba(229,195,75,0.1)\"\r\n                e.currentTarget.style.boxShadow = \"none\"\r\n              }}\r\n            >\r\n              <div\r\n                className=\"shrink-0 flex items-center justify-center font-mono text-lg font-bold rounded-sm\"\r\n                style={{\r\n                  width: 48,\r\n                  height: 48,\r\n                  backgroundColor: \"rgba(229,195,75,0.08)\",\r\n                  color: mc.color,\r\n                  border: `1px solid ${mc.color}`,\r\n                }}\r\n              >\r\n                {agent.avatar}\r\n              </div>\r\n              <div className=\"flex-1 min-w-0\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className=\"font-mono text-sm uppercase\" style={{ color: \"var(--foreground)\" }}>\r\n                    {agent.name}\r\n                  </span>\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <div className=\"h-1.5 w-1.5 rounded-full\" style={{ backgroundColor: mc.color }} />\r\n                    <span className=\"font-mono text-[10px]\" style={{ color: mc.color }}>{mc.label}</span>\r\n                  </div>\r\n                </div>\r\n                <p className=\"font-mono text-[11px] mt-1 line-clamp-2\" style={{ color: \"var(--muted-foreground)\" }}>\r\n                  {agent.description}\r\n                </p>\r\n                <div className=\"flex flex-wrap gap-1 mt-2\">\r\n                  {agent.traits.map((t) => (\r\n                    <span\r\n                      key={t}\r\n                      className=\"font-mono text-[9px] px-1.5 py-0.5 rounded-sm\"\r\n                      style={{\r\n                        color: \"var(--cyber-glow)\",\r\n                        backgroundColor: \"rgba(229,195,75,0.06)\",\r\n                        border: \"1px solid rgba(229,195,75,0.15)\",\r\n                      }}\r\n                    >\r\n                      {t}\r\n                    </span>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            </button>\r\n          )\r\n        })}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","\"use client\"\n\nimport { useState, useEffect } from \"react\"\nimport { MOOD_CONFIG, getStats, type WorldStats } from \"@/lib/data\"\n\nfunction StatCard({ label, value, sub }: { label: string; value: string | number; sub?: string }) {\n  return (\n    <div\n      className=\"flex flex-col gap-1 p-4 rounded-sm\"\n      style={{\n        backgroundColor: \"rgba(229,195,75,0.03)\",\n        border: \"1px solid rgba(229,195,75,0.1)\",\n      }}\n    >\n      <span className=\"font-mono text-[10px] tracking-widest uppercase\" style={{ color: \"var(--muted-foreground)\" }}>\n        {label}\n      </span>\n      <span className=\"font-mono text-2xl tabular-nums\" style={{ color: \"var(--cyber-glow)\", textShadow: \"0 0 10px rgba(229,195,75,0.3)\" }}>\n        {value}\n      </span>\n      {sub && (\n        <span className=\"font-mono text-[10px]\" style={{ color: \"var(--muted-foreground)\" }}>{sub}</span>\n      )}\n    </div>\n  )\n}\n\nfunction BarChart({ items, maxVal }: { items: { label: string; value: number; color: string }[]; maxVal: number }) {\n  return (\n    <div className=\"flex flex-col gap-2\">\n      {items.map((item) => (\n        <div key={item.label} className=\"flex items-center gap-3\">\n          <span className=\"font-mono text-[10px] tracking-wider uppercase shrink-0\" style={{ color: \"var(--muted-foreground)\", width: 80 }}>\n            {item.label}\n          </span>\n          <div className=\"flex-1 h-5 rounded-sm\" style={{ backgroundColor: \"rgba(229,195,75,0.06)\" }}>\n            <div\n              className=\"h-full rounded-sm\"\n              style={{\n                width: `${Math.max((item.value / maxVal) * 100, 2)}%`,\n                backgroundColor: item.color,\n                opacity: 0.7,\n                boxShadow: `0 0 8px ${item.color}40`,\n                transition: \"width 0.5s ease\",\n              }}\n            />\n          </div>\n          <span className=\"font-mono text-xs tabular-nums shrink-0\" style={{ color: item.color, width: 36, textAlign: \"right\" }}>\n            {item.value}\n          </span>\n        </div>\n      ))}\n    </div>\n  )\n}\n\nexport function StatsPanel({ refreshToken }: { refreshToken?: number }) {\n  const [stats, setStats] = useState<WorldStats | null>(null)\n\n  useEffect(() => {\n    let active = true\n    setStats(null)\n    getStats().then((loadedStats) => {\n      if (active) {\n        setStats(loadedStats)\n      }\n    })\n\n    return () => {\n      active = false\n    }\n  }, [refreshToken])\n\n  if (!stats) {\n    return (\n      <div className=\"flex h-full items-center justify-center font-mono text-xs\" style={{ backgroundColor: \"var(--cyber-surface)\", color: \"var(--muted-foreground)\" }}>\n        Загрузка статистики...\n      </div>\n    )\n  }\n\n  const eventTypeColors: Record<string, string> = {\n    chat: \"#4ade80\",\n    action: \"#e5c34b\",\n    emotion: \"#c084fc\",\n    system: \"#60a5fa\",\n  }\n\n  const eventTypeLabels: Record<string, string> = {\n    chat: \"Чат\",\n    action: \"Действие\",\n    emotion: \"Эмоция\",\n    system: \"Система\",\n  }\n\n  const maxEventCount = Math.max(1, ...stats.eventsByType.map((e) => e.count))\n  const maxMoodCount = Math.max(1, ...stats.moodDistribution.map((m) => m.count))\n  const topRelationshipColor =\n    stats.topRelationship.sentiment > 0\n      ? \"#4ade80\"\n      : stats.topRelationship.sentiment < 0\n        ? \"#f87171\"\n        : \"var(--muted-foreground)\"\n\n  return (\n    <div className=\"flex flex-col h-full\" style={{ backgroundColor: \"var(--cyber-surface)\" }}>\n      <div\n        className=\"shrink-0 flex items-center px-5 py-3 border-b\"\n        style={{ borderColor: \"rgba(229,195,75,0.15)\" }}\n      >\n        <span className=\"font-mono text-sm tracking-widest uppercase\" style={{ color: \"var(--cyber-glow)\" }}>\n          {\"СТАТИСТИКА МИРА\"}\n        </span>\n      </div>\n\n      <div className=\"flex-1 overflow-y-auto px-5 py-4 flex flex-col gap-5\">\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n          <StatCard label=\"Всего событий\" value={stats.totalEvents} />\n          <StatCard label=\"Диалогов\" value={stats.totalConversations} />\n          <StatCard label=\"Среднее настроение\" value={`${(stats.avgMood * 100).toFixed(0)}%`} sub=\"0% = плохо, 100% = отлично\" />\n          <StatCard label=\"Самый активный\" value={stats.mostActiveAgent} />\n        </div>\n\n        <div>\n          <h3 className=\"font-mono text-[10px] tracking-widest uppercase mb-3\" style={{ color: \"var(--muted-foreground)\" }}>\n            {\"СОБЫТИЯ ПО ТИПАМ\"}\n          </h3>\n          <BarChart\n            items={stats.eventsByType.map((e) => ({\n              label: eventTypeLabels[e.type] || e.type,\n              value: e.count,\n              color: eventTypeColors[e.type] || \"var(--cyber-glow)\",\n            }))}\n            maxVal={maxEventCount}\n          />\n        </div>\n\n        <div>\n          <h3 className=\"font-mono text-[10px] tracking-widest uppercase mb-3\" style={{ color: \"var(--muted-foreground)\" }}>\n            {\"РАСПРЕДЕЛЕНИЕ НАСТРОЕНИЙ\"}\n          </h3>\n          <BarChart\n            items={stats.moodDistribution.map((m) => ({\n              label: MOOD_CONFIG[m.mood].label,\n              value: m.count,\n              color: MOOD_CONFIG[m.mood].color,\n            }))}\n            maxVal={maxMoodCount}\n          />\n        </div>\n\n        <div>\n          <h3 className=\"font-mono text-[10px] tracking-widest uppercase mb-2\" style={{ color: \"var(--muted-foreground)\" }}>\n            {\"САМАЯ СИЛЬНАЯ СВЯЗЬ\"}\n          </h3>\n          <div\n            className=\"flex items-center justify-between px-4 py-3 rounded-sm\"\n            style={{\n              backgroundColor: \"rgba(229,195,75,0.04)\",\n              border: \"1px solid rgba(229,195,75,0.15)\",\n            }}\n          >\n            <div className=\"flex items-center gap-3\">\n              <span className=\"font-mono text-sm\" style={{ color: \"var(--foreground)\" }}>\n                {stats.topRelationship.from}\n              </span>\n              <span className=\"font-mono text-xs\" style={{ color: \"var(--muted-foreground)\" }}>{\"<->\"}</span>\n              <span className=\"font-mono text-sm\" style={{ color: \"var(--foreground)\" }}>\n                {stats.topRelationship.to}\n              </span>\n            </div>\n            <span className=\"font-mono text-sm font-bold\" style={{ color: topRelationshipColor }}>\n              {stats.topRelationship.sentiment > 0 ? \"+\" : \"\"}{(stats.topRelationship.sentiment * 100).toFixed(0)}%\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\r\n","\"use client\"\n\nimport { useEffect, useMemo, useState } from \"react\"\nimport {\n  HubConnectionBuilder,\n  LogLevel,\n  type HubConnection,\n} from \"@microsoft/signalr\"\nimport {\n  MOOD_CONFIG,\n  broadcastAgentCommand,\n  commandAgent,\n  getAgentMessages,\n  getAgents,\n  getAllAgentMessages,\n  type Agent,\n  type AgentConversationMessage,\n} from \"@/lib/data\"\n\nconst DEFAULT_USER_ID = \"demo-user\"\nconst ALL_AGENTS_TARGET = \"__all_agents__\"\nconst REALTIME_EVENT_NAMES = [\n  \"agents.list.updated\",\n  \"agent.status.changed\",\n  \"agent.message\",\n  \"agent.progress\",\n  \"agent.error\",\n]\n\ntype MessageMode = \"ask\" | \"nudge\"\n\nfunction getRealtimeBackendBaseUrl(): string {\n  const raw = process.env.NEXT_PUBLIC_BACKEND_URL?.trim()\n  if (raw && raw.length > 0) {\n    return raw.replace(/\\/+$/, \"\")\n  }\n\n  return \"http://localhost:5133\"\n}\n\nfunction getUserId(): string {\n  const fromEnv = process.env.NEXT_PUBLIC_USER_ID?.trim()\n  return fromEnv && fromEnv.length > 0 ? fromEnv : DEFAULT_USER_ID\n}\n\nfunction formatMessageTime(iso: string): string {\n  const date = new Date(iso)\n  return date.toLocaleTimeString(\"ru-RU\", {\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n  })\n}\n\nfunction renderMessagePreview(text: string): string {\n  const compact = text.replace(/\\s+/g, \" \").trim()\n  if (compact.length <= 42) {\n    return compact\n  }\n\n  return `${compact.slice(0, 39)}...`\n}\n\nexport function MessagesPanel({ refreshToken }: { refreshToken?: number }) {\n  const [agents, setAgents] = useState<Agent[]>([])\n  const [selectedTarget, setSelectedTarget] = useState<string>(ALL_AGENTS_TARGET)\n  const [messages, setMessages] = useState<AgentConversationMessage[]>([])\n  const [messageMode, setMessageMode] = useState<MessageMode>(\"ask\")\n  const [draft, setDraft] = useState(\"\")\n  const [loading, setLoading] = useState(true)\n  const [sending, setSending] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [lastAck, setLastAck] = useState<string | null>(null)\n\n  const selectedAgent = useMemo(\n    () => agents.find((agent) => agent.id === selectedTarget),\n    [agents, selectedTarget]\n  )\n\n  useEffect(() => {\n    let active = true\n    let connection: HubConnection | null = null\n\n    const loadData = async ({ silent = false }: { silent?: boolean } = {}) => {\n      if (!silent) {\n        setLoading(true)\n      }\n\n      try {\n        const loadedAgents = await getAgents()\n        if (!active) {\n          return\n        }\n\n        setAgents(loadedAgents)\n\n        const nextTarget =\n          selectedTarget === ALL_AGENTS_TARGET || loadedAgents.some((agent) => agent.id === selectedTarget)\n            ? selectedTarget\n            : (loadedAgents[0]?.id ?? ALL_AGENTS_TARGET)\n\n        if (nextTarget !== selectedTarget) {\n          setSelectedTarget(nextTarget)\n        }\n\n        const loadedMessages =\n          nextTarget === ALL_AGENTS_TARGET\n            ? await getAllAgentMessages(20)\n            : await getAgentMessages(nextTarget, 120)\n\n        if (!active) {\n          return\n        }\n\n        setMessages(\n          loadedMessages\n            .slice()\n            .sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime())\n        )\n      } finally {\n        if (active && !silent) {\n          setLoading(false)\n        }\n      }\n    }\n\n    const handleRealtimeUpdate = () => {\n      if (!active) {\n        return\n      }\n\n      void loadData({ silent: true })\n    }\n\n    const startRealtime = async () => {\n      const backendBaseUrl = getRealtimeBackendBaseUrl()\n      const userId = getUserId()\n      const hubUrl = `${backendBaseUrl}/hubs/agents?userId=${encodeURIComponent(userId)}`\n\n      connection = new HubConnectionBuilder()\n        .withUrl(hubUrl)\n        .withAutomaticReconnect()\n        .configureLogging(LogLevel.Error)\n        .build()\n\n      for (const eventName of REALTIME_EVENT_NAMES) {\n        connection.on(eventName, handleRealtimeUpdate)\n      }\n\n      connection.onreconnected(() => {\n        if (!active) {\n          return\n        }\n\n        void connection?.invoke(\"SubscribeUser\").catch(() => undefined)\n        void loadData({ silent: true })\n      })\n\n      try {\n        await connection.start()\n        if (!active) {\n          return\n        }\n\n        await connection.invoke(\"SubscribeUser\")\n      } catch (realtimeError) {\n        console.warn(\"[messages-panel] SignalR connection failed, fallback to polling\", realtimeError)\n      }\n    }\n\n    void loadData()\n    void startRealtime()\n\n    const pollingTimer = setInterval(() => {\n      void loadData({ silent: true })\n    }, 5000)\n\n    return () => {\n      active = false\n      clearInterval(pollingTimer)\n\n      if (!connection) {\n        return\n      }\n\n      for (const eventName of REALTIME_EVENT_NAMES) {\n        connection.off(eventName, handleRealtimeUpdate)\n      }\n\n      void connection.stop()\n    }\n  }, [refreshToken, selectedTarget])\n\n  const handleSend = async () => {\n    const text = draft.trim()\n    if (!text || sending) {\n      return\n    }\n\n    setSending(true)\n    setError(null)\n    setLastAck(null)\n\n    const command = messageMode === \"ask\" ? \"chat.ask\" : \"action.nudge\"\n\n    try {\n      if (selectedTarget === ALL_AGENTS_TARGET) {\n        const ack = await broadcastAgentCommand(text, { command })\n        if (!ack) {\n          setError(\"Не удалось отправить сообщение всем агентам.\")\n          return\n        }\n\n        const rejectedItems = ack.items.filter((item) => item.status.toLowerCase() !== \"accepted\")\n        if (rejectedItems.length > 0) {\n          setLastAck(`Отправлено: ${ack.acceptedCount}, отклонено: ${ack.rejectedCount}.`)\n        } else {\n          setLastAck(`Отправлено всем агентам: ${ack.acceptedCount}.`)\n        }\n      } else {\n        const ack = await commandAgent(selectedTarget, text, command)\n        if (!ack) {\n          setError(\"Не удалось отправить сообщение выбранному агенту.\")\n          return\n        }\n\n        setLastAck(\"Сообщение отправлено, агент обрабатывает команду.\")\n      }\n\n      setDraft(\"\")\n\n      const [freshAgents, freshMessages] = await Promise.all([\n        getAgents(),\n        selectedTarget === ALL_AGENTS_TARGET\n          ? getAllAgentMessages(20)\n          : getAgentMessages(selectedTarget, 120),\n      ])\n\n      setAgents(freshAgents)\n      setMessages(\n        freshMessages\n          .slice()\n          .sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime())\n      )\n    } finally {\n      setSending(false)\n    }\n  }\n\n  return (\n    <div className=\"flex h-full w-full\" style={{ backgroundColor: \"var(--cyber-surface)\" }}>\n      <aside\n        className=\"shrink-0 border-r px-3 py-4 overflow-y-auto\"\n        style={{ borderColor: \"rgba(229,195,75,0.15)\", width: \"clamp(220px, 21%, 300px)\" }}\n      >\n        <div className=\"font-mono text-[10px] tracking-widest uppercase mb-3\" style={{ color: \"var(--muted-foreground)\" }}>\n          Диалоги\n        </div>\n\n        <button\n          onClick={() => setSelectedTarget(ALL_AGENTS_TARGET)}\n          className=\"w-full text-left rounded-sm px-3 py-2 mb-2\"\n          style={{\n            backgroundColor:\n              selectedTarget === ALL_AGENTS_TARGET ? \"rgba(229,195,75,0.12)\" : \"rgba(229,195,75,0.05)\",\n            border:\n              selectedTarget === ALL_AGENTS_TARGET\n                ? \"1px solid rgba(229,195,75,0.4)\"\n                : \"1px solid rgba(229,195,75,0.16)\",\n          }}\n        >\n          <div className=\"font-mono text-xs uppercase\" style={{ color: \"var(--cyber-glow)\" }}>\n            Все агенты\n          </div>\n          <div className=\"font-mono text-[10px]\" style={{ color: \"var(--muted-foreground)\" }}>\n            Общий сигнал и ответы\n          </div>\n        </button>\n\n        <div className=\"flex flex-col gap-2\">\n          {agents.map((agent) => {\n            const mood = MOOD_CONFIG[agent.mood]\n            const isActive = selectedTarget === agent.id\n            return (\n              <button\n                key={agent.id}\n                onClick={() => setSelectedTarget(agent.id)}\n                className=\"w-full text-left rounded-sm px-3 py-2\"\n                style={{\n                  backgroundColor: isActive ? \"rgba(229,195,75,0.12)\" : \"rgba(229,195,75,0.04)\",\n                  border: isActive\n                    ? \"1px solid rgba(229,195,75,0.4)\"\n                    : \"1px solid rgba(229,195,75,0.12)\",\n                }}\n              >\n                <div className=\"flex items-center justify-between gap-2\">\n                  <span className=\"font-mono text-xs uppercase\" style={{ color: \"var(--foreground)\" }}>\n                    {agent.name}\n                  </span>\n                  <span className=\"font-mono text-[10px]\" style={{ color: mood.color }}>\n                    {mood.label}\n                  </span>\n                </div>\n                <div className=\"font-mono text-[10px] mt-1\" style={{ color: \"var(--muted-foreground)\" }}>\n                  {renderMessagePreview(agent.currentPlan)}\n                </div>\n              </button>\n            )\n          })}\n        </div>\n      </aside>\n\n      <div className=\"flex-1 flex flex-col min-w-0\">\n        <div\n          className=\"shrink-0 border-b px-4 py-3 flex items-center justify-between\"\n          style={{ borderColor: \"rgba(229,195,75,0.15)\" }}\n        >\n          <div className=\"font-mono text-sm tracking-widest uppercase\" style={{ color: \"var(--cyber-glow)\" }}>\n            {selectedTarget === ALL_AGENTS_TARGET\n              ? \"Сообщения / Все агенты\"\n              : `Сообщения / ${selectedAgent?.name ?? \"Агент\"}`}\n          </div>\n          <div className=\"font-mono text-[10px]\" style={{ color: \"var(--muted-foreground)\" }}>\n            {messages.length} сообщений\n          </div>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto px-4 py-3 flex flex-col gap-2\">\n          {loading ? (\n            <div className=\"font-mono text-xs\" style={{ color: \"var(--muted-foreground)\" }}>\n              Загрузка переписки...\n            </div>\n          ) : null}\n\n          {!loading && messages.length === 0 ? (\n            <div className=\"font-mono text-xs\" style={{ color: \"var(--muted-foreground)\" }}>\n              Пока нет сообщений.\n            </div>\n          ) : null}\n\n          {messages.map((message) => {\n            const isUser = message.role === \"user\"\n            const accent = isUser ? \"#e5c34b\" : \"#4ade80\"\n\n            return (\n              <div\n                key={message.id}\n                className={`flex ${isUser ? \"justify-end\" : \"justify-start\"}`}\n              >\n                <div\n                  className=\"max-w-[82%] rounded-sm px-3 py-2\"\n                  style={{\n                    backgroundColor: isUser ? \"rgba(229,195,75,0.08)\" : \"rgba(74,222,128,0.08)\",\n                    border: `1px solid ${accent}40`,\n                  }}\n                >\n                  {selectedTarget === ALL_AGENTS_TARGET ? (\n                    <div className=\"font-mono text-[10px] mb-1 uppercase\" style={{ color: \"var(--cyber-glow)\" }}>\n                      {message.agentName}\n                    </div>\n                  ) : null}\n                  <div className=\"font-mono text-xs whitespace-pre-wrap\" style={{ color: \"var(--foreground)\" }}>\n                    {message.content}\n                  </div>\n                  <div className=\"font-mono text-[10px] mt-1\" style={{ color: \"var(--muted-foreground)\" }}>\n                    {message.role} • {formatMessageTime(message.timestamp)}\n                  </div>\n                </div>\n              </div>\n            )\n          })}\n        </div>\n\n        <div\n          className=\"shrink-0 border-t px-4 py-3\"\n          style={{ borderColor: \"rgba(229,195,75,0.15)\" }}\n        >\n          <div className=\"flex items-center gap-2 mb-2\">\n            <button\n              onClick={() => setMessageMode(\"ask\")}\n              className=\"font-mono text-[10px] tracking-widest uppercase px-2 py-1 rounded-sm\"\n              style={{\n                color: messageMode === \"ask\" ? \"var(--cyber-glow)\" : \"var(--muted-foreground)\",\n                border:\n                  messageMode === \"ask\"\n                    ? \"1px solid rgba(229,195,75,0.4)\"\n                    : \"1px solid rgba(229,195,75,0.15)\",\n                backgroundColor:\n                  messageMode === \"ask\" ? \"rgba(229,195,75,0.1)\" : \"rgba(229,195,75,0.03)\",\n              }}\n            >\n              Вопрос\n            </button>\n            <button\n              onClick={() => setMessageMode(\"nudge\")}\n              className=\"font-mono text-[10px] tracking-widest uppercase px-2 py-1 rounded-sm\"\n              style={{\n                color: messageMode === \"nudge\" ? \"var(--cyber-glow)\" : \"var(--muted-foreground)\",\n                border:\n                  messageMode === \"nudge\"\n                    ? \"1px solid rgba(229,195,75,0.4)\"\n                    : \"1px solid rgba(229,195,75,0.15)\",\n                backgroundColor:\n                  messageMode === \"nudge\" ? \"rgba(229,195,75,0.1)\" : \"rgba(229,195,75,0.03)\",\n              }}\n            >\n              Подстрекать к действию\n            </button>\n          </div>\n\n          <div className=\"flex gap-2\">\n            <textarea\n              value={draft}\n              onChange={(event) => setDraft(event.target.value)}\n              placeholder={\n                selectedTarget === ALL_AGENTS_TARGET\n                  ? \"Введите общий сигнал для всех агентов...\"\n                  : \"Введите сообщение агенту...\"\n              }\n              className=\"flex-1 min-h-[72px] max-h-[180px] rounded-sm p-2 font-mono text-xs outline-none resize-y\"\n              style={{\n                backgroundColor: \"rgba(229,195,75,0.04)\",\n                border: \"1px solid rgba(229,195,75,0.2)\",\n                color: \"var(--foreground)\",\n              }}\n              disabled={sending}\n            />\n            <button\n              onClick={handleSend}\n              disabled={sending || draft.trim().length === 0}\n              className=\"shrink-0 h-fit font-mono text-xs tracking-widest uppercase px-3 py-2 rounded-sm disabled:cursor-not-allowed\"\n              style={{\n                color: sending ? \"var(--muted-foreground)\" : \"var(--cyber-glow)\",\n                border: \"1px solid rgba(229,195,75,0.35)\",\n                backgroundColor: sending ? \"rgba(229,195,75,0.03)\" : \"rgba(229,195,75,0.09)\",\n              }}\n            >\n              {sending ? \"ОТПРАВКА...\" : \"ОТПРАВИТЬ\"}\n            </button>\n          </div>\n\n          {error ? (\n            <div className=\"font-mono text-[11px] mt-2\" style={{ color: \"#f87171\" }}>\n              {error}\n            </div>\n          ) : null}\n          {lastAck ? (\n            <div className=\"font-mono text-[11px] mt-2\" style={{ color: \"#4ade80\" }}>\n              {lastAck}\n            </div>\n          ) : null}\n        </div>\n      </div>\n    </div>\n  )\n}\n","\"use client\"\n\nimport { useEffect, useState } from \"react\"\nimport { CyberFrame, type TabId } from \"@/components/cyber-frame\"\nimport { GraphPanel } from \"@/components/panels/graph-panel\"\nimport { EventsPanel } from \"@/components/panels/events-panel\"\nimport { AgentsPanel } from \"@/components/panels/agents-panel\"\nimport { StatsPanel } from \"@/components/panels/stats-panel\"\nimport { MessagesPanel } from \"@/components/panels/messages-panel\"\nimport { addEvent, getWorldTime, resetWorldSimulation, setWorldTimeSpeed } from \"@/lib/data\"\nexport default function Home() {\n  const [activeTab, setActiveTab] = useState<TabId>(\"graph\")\n  const [timeSpeed, setTimeSpeed] = useState(1)\n  const [worldTime, setWorldTime] = useState<string | null>(null)\n  const [selectedAgentId, setSelectedAgentId] = useState<string | null>(null)\n  const [sourceTab, setSourceTab] = useState<TabId | null>(null)\n  const [refreshToken, setRefreshToken] = useState(0)\n\n  useEffect(() => {\n    let active = true\n\n    const syncWorldTime = async () => {\n      const current = await getWorldTime()\n      if (!current || !active) {\n        return\n      }\n\n      setTimeSpeed((prev) => (Math.abs(prev - current.speed) > 0.001 ? current.speed : prev))\n      setWorldTime((prev) => {\n        if (!prev) {\n          return current.gameTime\n        }\n\n        const prevMs = new Date(prev).getTime()\n        const nextMs = new Date(current.gameTime).getTime()\n        if (!Number.isFinite(prevMs) || !Number.isFinite(nextMs)) {\n          return current.gameTime\n        }\n\n        // Keep UI smooth: resync only if drift exceeds one in-game minute.\n        return Math.abs(nextMs - prevMs) >= 60_000 ? current.gameTime : prev\n      })\n    }\n\n    void syncWorldTime()\n    const timer = setInterval(syncWorldTime, 5000)\n    return () => {\n      active = false\n      clearInterval(timer)\n    }\n  }, [])\n\r\n  const handleAddEvent = async (text: string) => {\n    const saved = await addEvent(text)\n    if (!saved) {\n      console.warn(\"[ui] Event was not sent to backend, fallback mode is active\")\n      return\n    }\n\n    setRefreshToken((prev) => prev + 1)\n  }\n\n  const handleTimeSpeedChange = async (speed: number) => {\n    setTimeSpeed(speed)\n    const updated = await setWorldTimeSpeed(speed)\n    if (!updated) {\n      return\n    }\n\n    setTimeSpeed(updated.speed)\n    setWorldTime(updated.gameTime)\n    setRefreshToken((prev) => prev + 1)\n  }\n\n  const handleRestartSimulation = async () => {\n    const confirmed = window.confirm(\n      \"Начать симуляцию заново? Текущие агенты, связи и события будут сброшены.\"\n    )\n    if (!confirmed) {\n      return\n    }\n\n    const restarted = await resetWorldSimulation()\n    if (!restarted) {\n      return\n    }\n\n    setTimeSpeed(restarted.speed)\n    setWorldTime(restarted.gameTime)\n    setSelectedAgentId(null)\n    setSourceTab(null)\n    setRefreshToken((prev) => prev + 1)\n  }\n\r\n  const handleSelectAgentFromGraph = (agentId: string) => {\n    setSelectedAgentId(agentId)\n    setSourceTab(\"graph\")\n    setActiveTab(\"agents\")\n  }\n\n  const handleTabChange = (tab: TabId) => {\n    setActiveTab(tab)\n    if (tab !== \"agents\") {\n      setSelectedAgentId(null)\n      setSourceTab(null)\r\n    }\r\n  }\r\n\r\n  function renderContent() {\r\n    switch (activeTab) {\r\n      case \"graph\":\n        return <GraphPanel onSelectAgent={handleSelectAgentFromGraph} refreshToken={refreshToken} />\n      case \"events\":\n        return <EventsPanel refreshToken={refreshToken} />\n      case \"stats\":\n        return <StatsPanel refreshToken={refreshToken} />\n      case \"agents\":\n        return (\n          <AgentsPanel\n            refreshToken={refreshToken}\n            preSelectedAgentId={selectedAgentId}\n            onClearSelection={() => {\n              setSelectedAgentId(null)\n              if (sourceTab === \"graph\") {\n                setActiveTab(\"graph\")\n                setSourceTab(null)\n              }\r\n            }}\r\n            fromGraph={sourceTab === \"graph\"}\r\n          />\r\n        )\r\n      case \"messages\":\n        return <MessagesPanel refreshToken={refreshToken} />\n      default:\n        return null\n    }\n  }\n\r\n  return (\r\n    <CyberFrame\r\n      activeTab={activeTab}\r\n      onTabChange={handleTabChange}\r\n      onAddEvent={handleAddEvent}\n      timeSpeed={timeSpeed}\n      onTimeSpeedChange={handleTimeSpeedChange}\n      onRestartSimulation={handleRestartSimulation}\n      worldTime={worldTime}\n    >\n      {renderContent()}\n    </CyberFrame>\n  )\n}\n\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nexport abstract class HeaderNames {\r\n    static readonly Authorization = \"Authorization\";\r\n    static readonly Cookie = \"Cookie\";\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { HttpClient } from \"./HttpClient\";\r\nimport { ILogger, LogLevel } from \"./ILogger\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { IStreamSubscriber, ISubscription } from \"./Stream\";\r\nimport { Subject } from \"./Subject\";\r\nimport { IHttpConnectionOptions } from \"./IHttpConnectionOptions\";\r\n\r\n// Version token that will be replaced by the prepack command\r\n/** The version of the SignalR client. */\r\n\r\nexport const VERSION: string = \"0.0.0-DEV_BUILD\";\r\n/** @private */\r\nexport class Arg {\r\n    public static isRequired(val: any, name: string): void {\r\n        if (val === null || val === undefined) {\r\n            throw new Error(`The '${name}' argument is required.`);\r\n        }\r\n    }\r\n    public static isNotEmpty(val: string, name: string): void {\r\n        if (!val || val.match(/^\\s*$/)) {\r\n            throw new Error(`The '${name}' argument should not be empty.`);\r\n        }\r\n    }\r\n\r\n    public static isIn(val: any, values: any, name: string): void {\r\n        // TypeScript enums have keys for **both** the name and the value of each enum member on the type itself.\r\n        if (!(val in values)) {\r\n            throw new Error(`Unknown ${name} value: ${val}.`);\r\n        }\r\n    }\r\n}\r\n\r\n/** @private */\r\nexport class Platform {\r\n    // react-native has a window but no document so we should check both\r\n    public static get isBrowser(): boolean {\r\n        return !Platform.isNode && typeof window === \"object\" && typeof window.document === \"object\";\r\n    }\r\n\r\n    // WebWorkers don't have a window object so the isBrowser check would fail\r\n    public static get isWebWorker(): boolean {\r\n        return !Platform.isNode && typeof self === \"object\" && \"importScripts\" in self;\r\n    }\r\n\r\n    // react-native has a window but no document\r\n    static get isReactNative(): boolean {\r\n        return !Platform.isNode && typeof window === \"object\" && typeof window.document === \"undefined\";\r\n    }\r\n\r\n    // Node apps shouldn't have a window object, but WebWorkers don't either\r\n    // so we need to check for both WebWorker and window\r\n    public static get isNode(): boolean {\r\n        return typeof process !== \"undefined\" && process.release && process.release.name === \"node\";\r\n    }\r\n}\r\n\r\n/** @private */\r\nexport function getDataDetail(data: any, includeContent: boolean): string {\r\n    let detail = \"\";\r\n    if (isArrayBuffer(data)) {\r\n        detail = `Binary data of length ${data.byteLength}`;\r\n        if (includeContent) {\r\n            detail += `. Content: '${formatArrayBuffer(data)}'`;\r\n        }\r\n    } else if (typeof data === \"string\") {\r\n        detail = `String data of length ${data.length}`;\r\n        if (includeContent) {\r\n            detail += `. Content: '${data}'`;\r\n        }\r\n    }\r\n    return detail;\r\n}\r\n\r\n/** @private */\r\nexport function formatArrayBuffer(data: ArrayBuffer): string {\r\n    const view = new Uint8Array(data);\r\n\r\n    // Uint8Array.map only supports returning another Uint8Array?\r\n    let str = \"\";\r\n    view.forEach((num) => {\r\n        const pad = num < 16 ? \"0\" : \"\";\r\n        str += `0x${pad}${num.toString(16)} `;\r\n    });\r\n\r\n    // Trim of trailing space.\r\n    return str.substr(0, str.length - 1);\r\n}\r\n\r\n// Also in signalr-protocol-msgpack/Utils.ts\r\n/** @private */\r\nexport function isArrayBuffer(val: any): val is ArrayBuffer {\r\n    return val && typeof ArrayBuffer !== \"undefined\" &&\r\n        (val instanceof ArrayBuffer ||\r\n            // Sometimes we get an ArrayBuffer that doesn't satisfy instanceof\r\n            (val.constructor && val.constructor.name === \"ArrayBuffer\"));\r\n}\r\n\r\n/** @private */\r\nexport async function sendMessage(logger: ILogger, transportName: string, httpClient: HttpClient, url: string,\r\n                                  content: string | ArrayBuffer, options: IHttpConnectionOptions): Promise<void> {\r\n    const headers: {[k: string]: string} = {};\r\n\r\n    const [name, value] = getUserAgentHeader();\r\n    headers[name] = value;\r\n\r\n    logger.log(LogLevel.Trace, `(${transportName} transport) sending data. ${getDataDetail(content, options.logMessageContent!)}.`);\r\n\r\n    const responseType = isArrayBuffer(content) ? \"arraybuffer\" : \"text\";\r\n    const response = await httpClient.post(url, {\r\n        content,\r\n        headers: { ...headers, ...options.headers},\r\n        responseType,\r\n        timeout: options.timeout,\r\n        withCredentials: options.withCredentials,\r\n    });\r\n\r\n    logger.log(LogLevel.Trace, `(${transportName} transport) request complete. Response status: ${response.statusCode}.`);\r\n}\r\n\r\n/** @private */\r\nexport function createLogger(logger?: ILogger | LogLevel): ILogger {\r\n    if (logger === undefined) {\r\n        return new ConsoleLogger(LogLevel.Information);\r\n    }\r\n\r\n    if (logger === null) {\r\n        return NullLogger.instance;\r\n    }\r\n\r\n    if ((logger as ILogger).log !== undefined) {\r\n        return logger as ILogger;\r\n    }\r\n\r\n    return new ConsoleLogger(logger as LogLevel);\r\n}\r\n\r\n/** @private */\r\nexport class SubjectSubscription<T> implements ISubscription<T> {\r\n    private _subject: Subject<T>;\r\n    private _observer: IStreamSubscriber<T>;\r\n\r\n    constructor(subject: Subject<T>, observer: IStreamSubscriber<T>) {\r\n        this._subject = subject;\r\n        this._observer = observer;\r\n    }\r\n\r\n    public dispose(): void {\r\n        const index: number = this._subject.observers.indexOf(this._observer);\r\n        if (index > -1) {\r\n            this._subject.observers.splice(index, 1);\r\n        }\r\n\r\n        if (this._subject.observers.length === 0 && this._subject.cancelCallback) {\r\n            this._subject.cancelCallback().catch((_) => { });\r\n        }\r\n    }\r\n}\r\n\r\n/** @private */\r\nexport class ConsoleLogger implements ILogger {\r\n    private readonly _minLevel: LogLevel;\r\n\r\n    // Public for testing purposes.\r\n    public out: {\r\n        error(message: any): void,\r\n        warn(message: any): void,\r\n        info(message: any): void,\r\n        log(message: any): void,\r\n    };\r\n\r\n    constructor(minimumLogLevel: LogLevel) {\r\n        this._minLevel = minimumLogLevel;\r\n        this.out = console;\r\n    }\r\n\r\n    public log(logLevel: LogLevel, message: string): void {\r\n        if (logLevel >= this._minLevel) {\r\n            const msg = `[${new Date().toISOString()}] ${LogLevel[logLevel]}: ${message}`;\r\n            switch (logLevel) {\r\n                case LogLevel.Critical:\r\n                case LogLevel.Error:\r\n                    this.out.error(msg);\r\n                    break;\r\n                case LogLevel.Warning:\r\n                    this.out.warn(msg);\r\n                    break;\r\n                case LogLevel.Information:\r\n                    this.out.info(msg);\r\n                    break;\r\n                default:\r\n                    // console.debug only goes to attached debuggers in Node, so we use console.log for Trace and Debug\r\n                    this.out.log(msg);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/** @private */\r\nexport function getUserAgentHeader(): [string, string] {\r\n    let userAgentHeaderName = \"X-SignalR-User-Agent\";\r\n    if (Platform.isNode) {\r\n        userAgentHeaderName = \"User-Agent\";\r\n    }\r\n    return [ userAgentHeaderName, constructUserAgent(VERSION, getOsName(), getRuntime(), getRuntimeVersion()) ];\r\n}\r\n\r\n/** @private */\r\nexport function constructUserAgent(version: string, os: string, runtime: string, runtimeVersion: string | undefined): string {\r\n    // Microsoft SignalR/[Version] ([Detailed Version]; [Operating System]; [Runtime]; [Runtime Version])\r\n    let userAgent: string = \"Microsoft SignalR/\";\r\n\r\n    const majorAndMinor = version.split(\".\");\r\n    userAgent += `${majorAndMinor[0]}.${majorAndMinor[1]}`;\r\n    userAgent += ` (${version}; `;\r\n\r\n    if (os && os !== \"\") {\r\n        userAgent += `${os}; `;\r\n    } else {\r\n        userAgent += \"Unknown OS; \";\r\n    }\r\n\r\n    userAgent += `${runtime}`;\r\n\r\n    if (runtimeVersion) {\r\n        userAgent += `; ${runtimeVersion}`;\r\n    } else {\r\n        userAgent += \"; Unknown Runtime Version\";\r\n    }\r\n\r\n    userAgent += \")\";\r\n    return userAgent;\r\n}\r\n\r\n// eslint-disable-next-line spaced-comment\r\n/*#__PURE__*/ function getOsName(): string {\r\n    if (Platform.isNode) {\r\n        switch (process.platform) {\r\n            case \"win32\":\r\n                return \"Windows NT\";\r\n            case \"darwin\":\r\n                return \"macOS\";\r\n            case \"linux\":\r\n                return \"Linux\";\r\n            default:\r\n                return process.platform;\r\n        }\r\n    } else {\r\n        return \"\";\r\n    }\r\n}\r\n\r\n// eslint-disable-next-line spaced-comment\r\n/*#__PURE__*/ function getRuntimeVersion(): string | undefined {\r\n    if (Platform.isNode) {\r\n        return process.versions.node;\r\n    }\r\n    return undefined;\r\n}\r\n\r\nfunction getRuntime(): string {\r\n    if (Platform.isNode) {\r\n        return \"NodeJS\";\r\n    } else {\r\n        return \"Browser\";\r\n    }\r\n}\r\n\r\n/** @private */\r\nexport function getErrorString(e: any): string {\r\n    if (e.stack) {\r\n        return e.stack;\r\n    } else if (e.message) {\r\n        return e.message;\r\n    }\r\n    return `${e}`;\r\n}\r\n\r\n/** @private */\r\nexport function getGlobalThis(): unknown {\r\n    // globalThis is semi-new and not available in Node until v12\r\n    if (typeof globalThis !== \"undefined\") {\r\n        return globalThis;\r\n    }\r\n    if (typeof self !== \"undefined\") {\r\n        return self;\r\n    }\r\n    if (typeof window !== \"undefined\") {\r\n        return window;\r\n    }\r\n    if (typeof global !== \"undefined\") {\r\n        return global;\r\n    }\r\n    throw new Error(\"could not find global\");\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { HttpClient } from \"./HttpClient\";\r\nimport { MessageHeaders } from \"./IHubProtocol\";\r\nimport { ILogger, LogLevel } from \"./ILogger\";\r\nimport { ITransport, TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, Platform, sendMessage } from \"./Utils\";\r\nimport { IHttpConnectionOptions } from \"./IHttpConnectionOptions\";\r\n\r\n/** @private */\r\nexport class ServerSentEventsTransport implements ITransport {\r\n    private readonly _httpClient: HttpClient;\r\n    private readonly _accessToken: string | undefined;\r\n    private readonly _logger: ILogger;\r\n    private readonly _options: IHttpConnectionOptions;\r\n    private _eventSource?: EventSource;\r\n    private _url?: string;\r\n\r\n    public onreceive: ((data: string | ArrayBuffer) => void) | null;\r\n    public onclose: ((error?: Error | unknown) => void) | null;\r\n\r\n    constructor(httpClient: HttpClient, accessToken: string | undefined, logger: ILogger,\r\n                options: IHttpConnectionOptions) {\r\n        this._httpClient = httpClient;\r\n        this._accessToken = accessToken;\r\n        this._logger = logger;\r\n        this._options = options;\r\n\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n\r\n    public async connect(url: string, transferFormat: TransferFormat): Promise<void> {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isRequired(transferFormat, \"transferFormat\");\r\n        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n\r\n        this._logger.log(LogLevel.Trace, \"(SSE transport) Connecting.\");\r\n\r\n        // set url before accessTokenFactory because this._url is only for send and we set the auth header instead of the query string for send\r\n        this._url = url;\r\n\r\n        if (this._accessToken) {\r\n            url += (url.indexOf(\"?\") < 0 ? \"?\" : \"&\") + `access_token=${encodeURIComponent(this._accessToken)}`;\r\n        }\r\n\r\n        return new Promise<void>((resolve, reject) => {\r\n            let opened = false;\r\n            if (transferFormat !== TransferFormat.Text) {\r\n                reject(new Error(\"The Server-Sent Events transport only supports the 'Text' transfer format\"));\r\n                return;\r\n            }\r\n\r\n            let eventSource: EventSource;\r\n            if (Platform.isBrowser || Platform.isWebWorker) {\r\n                eventSource = new this._options.EventSource!(url, { withCredentials: this._options.withCredentials });\r\n            } else {\r\n                // Non-browser passes cookies via the dictionary\r\n                const cookies = this._httpClient.getCookieString(url);\r\n                const headers: MessageHeaders = {};\r\n                headers.Cookie = cookies;\r\n                const [name, value] = getUserAgentHeader();\r\n                headers[name] = value;\r\n\r\n                eventSource = new this._options.EventSource!(url, { withCredentials: this._options.withCredentials, headers: { ...headers, ...this._options.headers} } as EventSourceInit);\r\n            }\r\n\r\n            try {\r\n                eventSource.onmessage = (e: MessageEvent) => {\r\n                    if (this.onreceive) {\r\n                        try {\r\n                            this._logger.log(LogLevel.Trace, `(SSE transport) data received. ${getDataDetail(e.data, this._options.logMessageContent!)}.`);\r\n                            this.onreceive(e.data);\r\n                        } catch (error) {\r\n                            this._close(error);\r\n                            return;\r\n                        }\r\n                    }\r\n                };\r\n\r\n                // @ts-ignore: not using event on purpose\r\n                eventSource.onerror = (e: Event) => {\r\n                    // EventSource doesn't give any useful information about server side closes.\r\n                    if (opened) {\r\n                        this._close();\r\n                    } else {\r\n                        reject(new Error(\"EventSource failed to connect. The connection could not be found on the server,\"\r\n                        + \" either the connection ID is not present on the server, or a proxy is refusing/buffering the connection.\"\r\n                        + \" If you have multiple servers check that sticky sessions are enabled.\"));\r\n                    }\r\n                };\r\n\r\n                eventSource.onopen = () => {\r\n                    this._logger.log(LogLevel.Information, `SSE connected to ${this._url}`);\r\n                    this._eventSource = eventSource;\r\n                    opened = true;\r\n                    resolve();\r\n                };\r\n            } catch (e) {\r\n                reject(e);\r\n                return;\r\n            }\r\n        });\r\n    }\r\n\r\n    public async send(data: any): Promise<void> {\r\n        if (!this._eventSource) {\r\n            return Promise.reject(new Error(\"Cannot send until the transport is connected\"));\r\n        }\r\n        return sendMessage(this._logger, \"SSE\", this._httpClient, this._url!, data, this._options);\r\n    }\r\n\r\n    public stop(): Promise<void> {\r\n        this._close();\r\n        return Promise.resolve();\r\n    }\r\n\r\n    private _close(e?: Error | unknown) {\r\n        if (this._eventSource) {\r\n            this._eventSource.close();\r\n            this._eventSource = undefined;\r\n\r\n            if (this.onclose) {\r\n                this.onclose(e);\r\n            }\r\n        }\r\n    }\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { AbortError } from \"./Errors\";\r\nimport { FetchHttpClient } from \"./FetchHttpClient\";\r\nimport { HttpClient, HttpRequest, HttpResponse } from \"./HttpClient\";\r\nimport { ILogger } from \"./ILogger\";\r\nimport { Platform } from \"./Utils\";\r\nimport { XhrHttpClient } from \"./XhrHttpClient\";\r\n\r\n/** Default implementation of {@link @microsoft/signalr.HttpClient}. */\r\nexport class DefaultHttpClient extends HttpClient {\r\n    private readonly _httpClient: HttpClient;\r\n\r\n    /** Creates a new instance of the {@link @microsoft/signalr.DefaultHttpClient}, using the provided {@link @microsoft/signalr.ILogger} to log messages. */\r\n    public constructor(logger: ILogger) {\r\n        super();\r\n\r\n        if (typeof fetch !== \"undefined\" || Platform.isNode) {\r\n            this._httpClient = new FetchHttpClient(logger);\r\n        } else if (typeof XMLHttpRequest !== \"undefined\") {\r\n            this._httpClient = new XhrHttpClient(logger);\r\n        } else {\r\n            throw new Error(\"No usable HttpClient found.\");\r\n        }\r\n    }\r\n\r\n    /** @inheritDoc */\r\n    public send(request: HttpRequest): Promise<HttpResponse> {\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            return Promise.reject(new AbortError());\r\n        }\r\n\r\n        if (!request.method) {\r\n            return Promise.reject(new Error(\"No method defined.\"));\r\n        }\r\n        if (!request.url) {\r\n            return Promise.reject(new Error(\"No url defined.\"));\r\n        }\r\n\r\n        return this._httpClient.send(request);\r\n    }\r\n\r\n    public getCookieString(url: string): string {\r\n        return this._httpClient.getCookieString(url);\r\n    }\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { AbortError, HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpRequest, HttpResponse } from \"./HttpClient\";\r\nimport { ILogger, LogLevel } from \"./ILogger\";\r\nimport { isArrayBuffer } from \"./Utils\";\r\n\r\nexport class XhrHttpClient extends HttpClient {\r\n    private readonly _logger: ILogger;\r\n\r\n    public constructor(logger: ILogger) {\r\n        super();\r\n        this._logger = logger;\r\n    }\r\n\r\n    /** @inheritDoc */\r\n    public send(request: HttpRequest): Promise<HttpResponse> {\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            return Promise.reject(new AbortError());\r\n        }\r\n\r\n        if (!request.method) {\r\n            return Promise.reject(new Error(\"No method defined.\"));\r\n        }\r\n        if (!request.url) {\r\n            return Promise.reject(new Error(\"No url defined.\"));\r\n        }\r\n\r\n        return new Promise<HttpResponse>((resolve, reject) => {\r\n            const xhr = new XMLHttpRequest();\r\n\r\n            xhr.open(request.method!, request.url!, true);\r\n            xhr.withCredentials = request.withCredentials === undefined ? true : request.withCredentials;\r\n            xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n            if (request.content === \"\") {\r\n                request.content = undefined;\r\n            }\r\n            if (request.content) {\r\n                // Explicitly setting the Content-Type header for React Native on Android platform.\r\n                if (isArrayBuffer(request.content)) {\r\n                    xhr.setRequestHeader(\"Content-Type\", \"application/octet-stream\");\r\n                } else {\r\n                    xhr.setRequestHeader(\"Content-Type\", \"text/plain;charset=UTF-8\");\r\n                }\r\n            }\r\n\r\n            const headers = request.headers;\r\n            if (headers) {\r\n                Object.keys(headers)\r\n                    .forEach((header) => {\r\n                        xhr.setRequestHeader(header, headers[header]);\r\n                    });\r\n            }\r\n\r\n            if (request.responseType) {\r\n                xhr.responseType = request.responseType;\r\n            }\r\n\r\n            if (request.abortSignal) {\r\n                request.abortSignal.onabort = () => {\r\n                    xhr.abort();\r\n                    reject(new AbortError());\r\n                };\r\n            }\r\n\r\n            if (request.timeout) {\r\n                xhr.timeout = request.timeout;\r\n            }\r\n\r\n            xhr.onload = () => {\r\n                if (request.abortSignal) {\r\n                    request.abortSignal.onabort = null;\r\n                }\r\n\r\n                if (xhr.status >= 200 && xhr.status < 300) {\r\n                    resolve(new HttpResponse(xhr.status, xhr.statusText, xhr.response || xhr.responseText));\r\n                } else {\r\n                    reject(new HttpError(xhr.response || xhr.responseText || xhr.statusText, xhr.status));\r\n                }\r\n            };\r\n\r\n            xhr.onerror = () => {\r\n                this._logger.log(LogLevel.Warning, `Error from HTTP request. ${xhr.status}: ${xhr.statusText}.`);\r\n                reject(new HttpError(xhr.statusText, xhr.status));\r\n            };\r\n\r\n            xhr.ontimeout = () => {\r\n                this._logger.log(LogLevel.Warning, `Timeout from HTTP request.`);\r\n                reject(new TimeoutError());\r\n            };\r\n\r\n            xhr.send(request.content);\r\n        });\r\n    }\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\n// @ts-ignore: This will be removed from built files and is here to make the types available during dev work\r\nimport { CookieJar } from \"@types/tough-cookie\";\r\n\r\nimport { AbortError, HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpRequest, HttpResponse } from \"./HttpClient\";\r\nimport { ILogger, LogLevel } from \"./ILogger\";\r\nimport { Platform, getGlobalThis, isArrayBuffer } from \"./Utils\";\r\n\r\nexport class FetchHttpClient extends HttpClient {\r\n    private readonly _abortControllerType: { prototype: AbortController, new(): AbortController };\r\n    private readonly _fetchType: (input: RequestInfo, init?: RequestInit) => Promise<Response>;\r\n    private readonly _jar?: CookieJar;\r\n\r\n    private readonly _logger: ILogger;\r\n\r\n    public constructor(logger: ILogger) {\r\n        super();\r\n        this._logger = logger;\r\n\r\n        // Node added a fetch implementation to the global scope starting in v18.\r\n        // We need to add a cookie jar in node to be able to share cookies with WebSocket\r\n        if (typeof fetch === \"undefined\" || Platform.isNode) {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            const requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n\r\n            // Cookies aren't automatically handled in Node so we need to add a CookieJar to preserve cookies across requests\r\n            this._jar = new (requireFunc(\"tough-cookie\")).CookieJar();\r\n\r\n            if (typeof fetch === \"undefined\") {\r\n                this._fetchType = requireFunc(\"node-fetch\");\r\n            } else {\r\n                // Use fetch from Node if available\r\n                this._fetchType = fetch;\r\n            }\r\n\r\n            // node-fetch doesn't have a nice API for getting and setting cookies\r\n            // fetch-cookie will wrap a fetch implementation with a default CookieJar or a provided one\r\n            this._fetchType = requireFunc(\"fetch-cookie\")(this._fetchType, this._jar);\r\n        } else {\r\n            this._fetchType = fetch.bind(getGlobalThis());\r\n        }\r\n        if (typeof AbortController === \"undefined\") {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            const requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n\r\n            // Node needs EventListener methods on AbortController which our custom polyfill doesn't provide\r\n            this._abortControllerType = requireFunc(\"abort-controller\");\r\n        } else {\r\n            this._abortControllerType = AbortController;\r\n        }\r\n    }\r\n\r\n    /** @inheritDoc */\r\n    public async send(request: HttpRequest): Promise<HttpResponse> {\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            throw new AbortError();\r\n        }\r\n\r\n        if (!request.method) {\r\n            throw new Error(\"No method defined.\");\r\n        }\r\n        if (!request.url) {\r\n            throw new Error(\"No url defined.\");\r\n        }\r\n\r\n        const abortController = new this._abortControllerType();\r\n\r\n        let error: any;\r\n        // Hook our abortSignal into the abort controller\r\n        if (request.abortSignal) {\r\n            request.abortSignal.onabort = () => {\r\n                abortController.abort();\r\n                error = new AbortError();\r\n            };\r\n        }\r\n\r\n        // If a timeout has been passed in, setup a timeout to call abort\r\n        // Type needs to be any to fit window.setTimeout and NodeJS.setTimeout\r\n        let timeoutId: any = null;\r\n        if (request.timeout) {\r\n            const msTimeout = request.timeout!;\r\n            timeoutId = setTimeout(() => {\r\n                abortController.abort();\r\n                this._logger.log(LogLevel.Warning, `Timeout from HTTP request.`);\r\n                error = new TimeoutError();\r\n            }, msTimeout);\r\n        }\r\n\r\n        if (request.content === \"\") {\r\n            request.content = undefined;\r\n        }\r\n        if (request.content) {\r\n            // Explicitly setting the Content-Type header for React Native on Android platform.\r\n            request.headers = request.headers || {};\r\n            if (isArrayBuffer(request.content)) {\r\n                request.headers[\"Content-Type\"] = \"application/octet-stream\";\r\n            } else {\r\n                request.headers[\"Content-Type\"] = \"text/plain;charset=UTF-8\";\r\n            }\r\n        }\r\n\r\n        let response: Response;\r\n        try {\r\n            response = await this._fetchType(request.url!, {\r\n                body: request.content,\r\n                cache: \"no-cache\",\r\n                credentials: request.withCredentials === true ? \"include\" : \"same-origin\",\r\n                headers: {\r\n                    \"X-Requested-With\": \"XMLHttpRequest\",\r\n                    ...request.headers,\r\n                },\r\n                method: request.method!,\r\n                mode: \"cors\",\r\n                redirect: \"follow\",\r\n                signal: abortController.signal,\r\n            });\r\n        } catch (e) {\r\n            if (error) {\r\n                throw error;\r\n            }\r\n            this._logger.log(\r\n                LogLevel.Warning,\r\n                `Error from HTTP request. ${e}.`,\r\n            );\r\n            throw e;\r\n        } finally {\r\n            if (timeoutId) {\r\n                clearTimeout(timeoutId);\r\n            }\r\n            if (request.abortSignal) {\r\n                request.abortSignal.onabort = null;\r\n            }\r\n        }\r\n\r\n        if (!response.ok) {\r\n            const errorMessage = await deserializeContent(response, \"text\") as string;\r\n            throw new HttpError(errorMessage || response.statusText, response.status);\r\n        }\r\n\r\n        const content = deserializeContent(response, request.responseType);\r\n        const payload = await content;\r\n\r\n        return new HttpResponse(\r\n            response.status,\r\n            response.statusText,\r\n            payload,\r\n        );\r\n    }\r\n\r\n    public getCookieString(url: string): string {\r\n        let cookies: string = \"\";\r\n        if (Platform.isNode && this._jar) {\r\n            // @ts-ignore: unused variable\r\n            this._jar.getCookies(url, (e, c) => cookies = c.join(\"; \"));\r\n        }\r\n        return cookies;\r\n    }\r\n}\r\n\r\nfunction deserializeContent(response: Response, responseType?: XMLHttpRequestResponseType): Promise<string | ArrayBuffer> {\r\n    let content;\r\n    switch (responseType) {\r\n        case \"arraybuffer\":\r\n            content = response.arrayBuffer();\r\n            break;\r\n        case \"text\":\r\n            content = response.text();\r\n            break;\r\n        case \"blob\":\r\n        case \"document\":\r\n        case \"json\":\r\n            throw new Error(`${responseType} is not supported.`);\r\n        default:\r\n            content = response.text();\r\n            break;\r\n    }\r\n\r\n    return content;\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { HeaderNames } from \"./HeaderNames\";\r\nimport { HttpClient, HttpRequest, HttpResponse } from \"./HttpClient\";\r\n\r\n/** @private */\r\nexport class AccessTokenHttpClient extends HttpClient {\r\n    private _innerClient: HttpClient;\r\n    _accessToken: string | undefined;\r\n    _accessTokenFactory: (() => string | Promise<string>) | undefined;\r\n\r\n    constructor(innerClient: HttpClient, accessTokenFactory: (() => string | Promise<string>) | undefined) {\r\n        super();\r\n\r\n        this._innerClient = innerClient;\r\n        this._accessTokenFactory = accessTokenFactory;\r\n    }\r\n\r\n    public async send(request: HttpRequest): Promise<HttpResponse> {\r\n        let allowRetry = true;\r\n        if (this._accessTokenFactory && (!this._accessToken || (request.url && request.url.indexOf(\"/negotiate?\") > 0))) {\r\n            // don't retry if the request is a negotiate or if we just got a potentially new token from the access token factory\r\n            allowRetry = false;\r\n            this._accessToken = await this._accessTokenFactory();\r\n        }\r\n        this._setAuthorizationHeader(request);\r\n        const response = await this._innerClient.send(request);\r\n\r\n        if (allowRetry && response.statusCode === 401 && this._accessTokenFactory) {\r\n            this._accessToken = await this._accessTokenFactory();\r\n            this._setAuthorizationHeader(request);\r\n            return await this._innerClient.send(request);\r\n        }\r\n        return response;\r\n    }\r\n\r\n    private _setAuthorizationHeader(request: HttpRequest) {\r\n        if (!request.headers) {\r\n            request.headers = {};\r\n        }\r\n        if (this._accessToken) {\r\n            request.headers[HeaderNames.Authorization] = `Bearer ${this._accessToken}`\r\n        }\r\n        // don't remove the header if there isn't an access token factory, the user manually added the header in this case\r\n        else if (this._accessTokenFactory) {\r\n            if (request.headers[HeaderNames.Authorization]) {\r\n                delete request.headers[HeaderNames.Authorization];\r\n            }\r\n        }\r\n    }\r\n\r\n    public getCookieString(url: string): string {\r\n        return this._innerClient.getCookieString(url);\r\n    }\r\n}","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { IConnection } from \"./IConnection\";\r\nimport { AckMessage, HubMessage, IHubProtocol, MessageType, SequenceMessage } from \"./IHubProtocol\";\r\nimport { isArrayBuffer } from \"./Utils\";\r\n\r\n/** @private */\r\nexport class MessageBuffer {\r\n    private readonly _protocol: IHubProtocol;\r\n    private readonly _connection: IConnection;\r\n\r\n    private readonly _bufferSize: number = 100_000;\r\n\r\n    private _messages: BufferedItem[] = [];\r\n    private _totalMessageCount: number = 0;\r\n    private _waitForSequenceMessage: boolean = false;\r\n\r\n    // Message IDs start at 1 and always increment by 1\r\n    private _nextReceivingSequenceId = 1;\r\n    private _latestReceivedSequenceId = 0;\r\n    private _bufferedByteCount: number = 0;\r\n    private _reconnectInProgress: boolean = false;\r\n\r\n    private _ackTimerHandle?: any;\r\n\r\n    constructor(protocol: IHubProtocol, connection: IConnection, bufferSize: number) {\r\n        this._protocol = protocol;\r\n        this._connection = connection;\r\n        this._bufferSize = bufferSize;\r\n    }\r\n\r\n    public async _send(message: HubMessage): Promise<void> {\r\n        const serializedMessage = this._protocol.writeMessage(message);\r\n\r\n        let backpressurePromise: Promise<void> = Promise.resolve();\r\n\r\n        // Only count invocation messages. Acks, pings, etc. don't need to be resent on reconnect\r\n        if (this._isInvocationMessage(message)) {\r\n            this._totalMessageCount++;\r\n            let backpressurePromiseResolver: (value: void) => void = () => {};\r\n            let backpressurePromiseRejector: (value?: void) => void = () => {};\r\n\r\n            if (isArrayBuffer(serializedMessage)) {\r\n                this._bufferedByteCount += serializedMessage.byteLength;\r\n            } else {\r\n                this._bufferedByteCount += serializedMessage.length;\r\n            }\r\n\r\n            if (this._bufferedByteCount >= this._bufferSize) {\r\n                backpressurePromise = new Promise((resolve, reject) => {\r\n                    backpressurePromiseResolver = resolve;\r\n                    backpressurePromiseRejector = reject;\r\n                });\r\n            }\r\n\r\n            this._messages.push(new BufferedItem(serializedMessage, this._totalMessageCount,\r\n                backpressurePromiseResolver, backpressurePromiseRejector));\r\n        }\r\n\r\n        try {\r\n            // If this is set it means we are reconnecting or resending\r\n            // We don't want to send on a disconnected connection\r\n            // And we don't want to send if resend is running since that would mean sending\r\n            // this message twice\r\n            if (!this._reconnectInProgress) {\r\n                await this._connection.send(serializedMessage);\r\n            }\r\n        } catch {\r\n            this._disconnected();\r\n        }\r\n        await backpressurePromise;\r\n    }\r\n\r\n    public _ack(ackMessage: AckMessage): void {\r\n        let newestAckedMessage = -1;\r\n\r\n        // Find index of newest message being acked\r\n        for (let index = 0; index < this._messages.length; index++) {\r\n            const element = this._messages[index];\r\n            if (element._id <= ackMessage.sequenceId) {\r\n                newestAckedMessage = index;\r\n                if (isArrayBuffer(element._message)) {\r\n                    this._bufferedByteCount -= element._message.byteLength;\r\n                } else {\r\n                    this._bufferedByteCount -= element._message.length;\r\n                }\r\n                // resolve items that have already been sent and acked\r\n                element._resolver();\r\n            } else if (this._bufferedByteCount < this._bufferSize) {\r\n                // resolve items that now fall under the buffer limit but haven't been acked\r\n                element._resolver();\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (newestAckedMessage !== -1) {\r\n            // We're removing everything including the message pointed to, so add 1\r\n            this._messages = this._messages.slice(newestAckedMessage + 1);\r\n        }\r\n    }\r\n\r\n    public _shouldProcessMessage(message: HubMessage): boolean {\r\n        if (this._waitForSequenceMessage) {\r\n            if (message.type !== MessageType.Sequence) {\r\n                return false;\r\n            } else {\r\n                this._waitForSequenceMessage = false;\r\n                return true;\r\n            }\r\n        }\r\n\r\n        // No special processing for acks, pings, etc.\r\n        if (!this._isInvocationMessage(message)) {\r\n            return true;\r\n        }\r\n\r\n        const currentId = this._nextReceivingSequenceId;\r\n        this._nextReceivingSequenceId++;\r\n        if (currentId <= this._latestReceivedSequenceId) {\r\n            if (currentId === this._latestReceivedSequenceId) {\r\n                // Should only hit this if we just reconnected and the server is sending\r\n                // Messages it has buffered, which would mean it hasn't seen an Ack for these messages\r\n                this._ackTimer();\r\n            }\r\n            // Ignore, this is a duplicate message\r\n            return false;\r\n        }\r\n\r\n        this._latestReceivedSequenceId = currentId;\r\n\r\n        // Only start the timer for sending an Ack message when we have a message to ack. This also conveniently solves\r\n        // timer throttling by not having a recursive timer, and by starting the timer via a network call (recv)\r\n        this._ackTimer();\r\n        return true;\r\n    }\r\n\r\n    public _resetSequence(message: SequenceMessage): void {\r\n        if (message.sequenceId > this._nextReceivingSequenceId) {\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            this._connection.stop(new Error(\"Sequence ID greater than amount of messages we've received.\"));\r\n            return;\r\n        }\r\n\r\n        this._nextReceivingSequenceId = message.sequenceId;\r\n    }\r\n\r\n    public _disconnected(): void {\r\n        this._reconnectInProgress = true;\r\n        this._waitForSequenceMessage = true;\r\n    }\r\n\r\n    public async _resend(): Promise<void> {\r\n        const sequenceId = this._messages.length !== 0\r\n            ? this._messages[0]._id\r\n            :  this._totalMessageCount + 1;\r\n        await this._connection.send(this._protocol.writeMessage({ type: MessageType.Sequence, sequenceId }));\r\n\r\n        // Get a local variable to the _messages, just in case messages are acked while resending\r\n        // Which would slice the _messages array (which creates a new copy)\r\n        const messages = this._messages;\r\n        for (const element of messages) {\r\n            await this._connection.send(element._message);\r\n        }\r\n\r\n        this._reconnectInProgress = false;\r\n    }\r\n\r\n    public _dispose(error?: Error): void {\r\n        error ??= new Error(\"Unable to reconnect to server.\")\r\n\r\n        // Unblock backpressure if any\r\n        for (const element of this._messages) {\r\n            element._rejector(error);\r\n        }\r\n    }\r\n\r\n    private _isInvocationMessage(message: HubMessage): boolean {\r\n        // There is no way to check if something implements an interface.\r\n        // So we individually check the messages in a switch statement.\r\n        // To make sure we don't miss any message types we rely on the compiler\r\n        // seeing the function returns a value and it will do the\r\n        // exhaustive check for us on the switch statement, since we don't use 'case default'\r\n        switch (message.type) {\r\n            case MessageType.Invocation:\r\n            case MessageType.StreamItem:\r\n            case MessageType.Completion:\r\n            case MessageType.StreamInvocation:\r\n            case MessageType.CancelInvocation:\r\n                return true;\r\n            case MessageType.Close:\r\n            case MessageType.Sequence:\r\n            case MessageType.Ping:\r\n            case MessageType.Ack:\r\n                return false;\r\n        }\r\n    }\r\n\r\n    private _ackTimer(): void {\r\n        if (this._ackTimerHandle === undefined) {\r\n            this._ackTimerHandle = setTimeout(async () => {\r\n                try {\r\n                    if (!this._reconnectInProgress) {\r\n                        await this._connection.send(this._protocol.writeMessage({ type: MessageType.Ack, sequenceId: this._latestReceivedSequenceId }))\r\n                    }\r\n                // Ignore errors, that means the connection is closed and we don't care about the Ack message anymore.\r\n                } catch { }\r\n\r\n                clearTimeout(this._ackTimerHandle);\r\n                this._ackTimerHandle = undefined;\r\n            // 1 second delay so we don't spam Ack messages if there are many messages being received at once.\r\n            }, 1000);\r\n        }\r\n    }\r\n}\r\n\r\nclass BufferedItem {\r\n    constructor(message: string | ArrayBuffer, id: number, resolver: (value: void) => void, rejector: (value?: any) => void) {\r\n        this._message = message;\r\n        this._id = id;\r\n        this._resolver = resolver;\r\n        this._rejector = rejector;\r\n    }\r\n\r\n    _message: string | ArrayBuffer;\r\n    _id: number;\r\n    _resolver: (value: void) => void;\r\n    _rejector: (value?: any) => void;\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { AckMessage, CompletionMessage, HubMessage, IHubProtocol, InvocationMessage, MessageType, SequenceMessage, StreamItemMessage } from \"./IHubProtocol\";\r\nimport { ILogger, LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { TextMessageFormat } from \"./TextMessageFormat\";\r\n\r\nconst JSON_HUB_PROTOCOL_NAME: string = \"json\";\r\n\r\n/** Implements the JSON Hub Protocol. */\r\nexport class JsonHubProtocol implements IHubProtocol {\r\n\r\n    /** @inheritDoc */\r\n    public readonly name: string = JSON_HUB_PROTOCOL_NAME;\r\n    /** @inheritDoc */\r\n    public readonly version: number = 2;\r\n\r\n    /** @inheritDoc */\r\n    public readonly transferFormat: TransferFormat = TransferFormat.Text;\r\n\r\n    /** Creates an array of {@link @microsoft/signalr.HubMessage} objects from the specified serialized representation.\r\n     *\r\n     * @param {string} input A string containing the serialized representation.\r\n     * @param {ILogger} logger A logger that will be used to log messages that occur during parsing.\r\n     */\r\n    public parseMessages(input: string, logger: ILogger): HubMessage[] {\r\n        // The interface does allow \"ArrayBuffer\" to be passed in, but this implementation does not. So let's throw a useful error.\r\n        if (typeof input !== \"string\") {\r\n            throw new Error(\"Invalid input for JSON hub protocol. Expected a string.\");\r\n        }\r\n\r\n        if (!input) {\r\n            return [];\r\n        }\r\n\r\n        if (logger === null) {\r\n            logger = NullLogger.instance;\r\n        }\r\n\r\n        // Parse the messages\r\n        const messages = TextMessageFormat.parse(input);\r\n\r\n        const hubMessages = [];\r\n        for (const message of messages) {\r\n            const parsedMessage = JSON.parse(message) as HubMessage;\r\n            if (typeof parsedMessage.type !== \"number\") {\r\n                throw new Error(\"Invalid payload.\");\r\n            }\r\n            switch (parsedMessage.type) {\r\n                case MessageType.Invocation:\r\n                    this._isInvocationMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.StreamItem:\r\n                    this._isStreamItemMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Completion:\r\n                    this._isCompletionMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Ping:\r\n                    // Single value, no need to validate\r\n                    break;\r\n                case MessageType.Close:\r\n                    // All optional values, no need to validate\r\n                    break;\r\n                case MessageType.Ack:\r\n                    this._isAckMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Sequence:\r\n                    this._isSequenceMessage(parsedMessage);\r\n                    break;\r\n                default:\r\n                    // Future protocol changes can add message types, old clients can ignore them\r\n                    logger.log(LogLevel.Information, \"Unknown message type '\" + parsedMessage.type + \"' ignored.\");\r\n                    continue;\r\n            }\r\n            hubMessages.push(parsedMessage);\r\n        }\r\n\r\n        return hubMessages;\r\n    }\r\n\r\n    /** Writes the specified {@link @microsoft/signalr.HubMessage} to a string and returns it.\r\n     *\r\n     * @param {HubMessage} message The message to write.\r\n     * @returns {string} A string containing the serialized representation of the message.\r\n     */\r\n    public writeMessage(message: HubMessage): string {\r\n        return TextMessageFormat.write(JSON.stringify(message));\r\n    }\r\n\r\n    private _isInvocationMessage(message: InvocationMessage): void {\r\n        this._assertNotEmptyString(message.target, \"Invalid payload for Invocation message.\");\r\n\r\n        if (message.invocationId !== undefined) {\r\n            this._assertNotEmptyString(message.invocationId, \"Invalid payload for Invocation message.\");\r\n        }\r\n    }\r\n\r\n    private _isStreamItemMessage(message: StreamItemMessage): void {\r\n        this._assertNotEmptyString(message.invocationId, \"Invalid payload for StreamItem message.\");\r\n\r\n        if (message.item === undefined) {\r\n            throw new Error(\"Invalid payload for StreamItem message.\");\r\n        }\r\n    }\r\n\r\n    private _isCompletionMessage(message: CompletionMessage): void {\r\n        if (message.result && message.error) {\r\n            throw new Error(\"Invalid payload for Completion message.\");\r\n        }\r\n\r\n        if (!message.result && message.error) {\r\n            this._assertNotEmptyString(message.error, \"Invalid payload for Completion message.\");\r\n        }\r\n\r\n        this._assertNotEmptyString(message.invocationId, \"Invalid payload for Completion message.\");\r\n    }\r\n\r\n    private _isAckMessage(message: AckMessage): void {\r\n        if (typeof message.sequenceId !== 'number') {\r\n            throw new Error(\"Invalid SequenceId for Ack message.\");\r\n        }\r\n    }\r\n\r\n    private _isSequenceMessage(message: SequenceMessage): void {\r\n        if (typeof message.sequenceId !== 'number') {\r\n            throw new Error(\"Invalid SequenceId for Sequence message.\");\r\n        }\r\n    }\r\n\r\n    private _assertNotEmptyString(value: any, errorMessage: string): void {\r\n        if (typeof value !== \"string\" || value === \"\") {\r\n            throw new Error(errorMessage);\r\n        }\r\n    }\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { HeaderNames } from \"./HeaderNames\";\r\nimport { HttpClient } from \"./HttpClient\";\r\nimport { MessageHeaders } from \"./IHubProtocol\";\r\nimport { ILogger, LogLevel } from \"./ILogger\";\r\nimport { ITransport, TransferFormat } from \"./ITransport\";\r\nimport { WebSocketConstructor } from \"./Polyfills\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, Platform } from \"./Utils\";\r\n\r\n/** @private */\r\nexport class WebSocketTransport implements ITransport {\r\n    private readonly _logger: ILogger;\r\n    private readonly _accessTokenFactory: (() => string | Promise<string>) | undefined;\r\n    private readonly _logMessageContent: boolean;\r\n    private readonly _webSocketConstructor: WebSocketConstructor;\r\n    private readonly _httpClient: HttpClient;\r\n    private _webSocket?: WebSocket;\r\n    private _headers: MessageHeaders;\r\n\r\n    public onreceive: ((data: string | ArrayBuffer) => void) | null;\r\n    public onclose: ((error?: Error) => void) | null;\r\n\r\n    constructor(httpClient: HttpClient, accessTokenFactory: (() => string | Promise<string>) | undefined, logger: ILogger,\r\n                logMessageContent: boolean, webSocketConstructor: WebSocketConstructor, headers: MessageHeaders) {\r\n        this._logger = logger;\r\n        this._accessTokenFactory = accessTokenFactory;\r\n        this._logMessageContent = logMessageContent;\r\n        this._webSocketConstructor = webSocketConstructor;\r\n        this._httpClient = httpClient;\r\n\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n        this._headers = headers;\r\n    }\r\n\r\n    public async connect(url: string, transferFormat: TransferFormat): Promise<void> {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isRequired(transferFormat, \"transferFormat\");\r\n        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n        this._logger.log(LogLevel.Trace, \"(WebSockets transport) Connecting.\");\r\n\r\n        let token: string;\r\n        if (this._accessTokenFactory) {\r\n            token = await this._accessTokenFactory();\r\n        }\r\n\r\n        return new Promise<void>((resolve, reject) => {\r\n            url = url.replace(/^http/, \"ws\");\r\n            let webSocket: WebSocket | undefined;\r\n            const cookies = this._httpClient.getCookieString(url);\r\n            let opened = false;\r\n\r\n            if (Platform.isNode || Platform.isReactNative) {\r\n                const headers: {[k: string]: string} = {};\r\n                const [name, value] = getUserAgentHeader();\r\n                headers[name] = value;\r\n                if (token) {\r\n                    headers[HeaderNames.Authorization] = `Bearer ${token}`;\r\n                }\r\n\r\n                if (cookies) {\r\n                    headers[HeaderNames.Cookie] = cookies;\r\n                }\r\n\r\n                // Only pass headers when in non-browser environments\r\n                webSocket = new this._webSocketConstructor(url, undefined, {\r\n                    headers: { ...headers, ...this._headers },\r\n                });\r\n            }\r\n            else\r\n            {\r\n                if (token) {\r\n                    url += (url.indexOf(\"?\") < 0 ? \"?\" : \"&\") + `access_token=${encodeURIComponent(token)}`;\r\n                }\r\n            }\r\n\r\n            if (!webSocket) {\r\n                // Chrome is not happy with passing 'undefined' as protocol\r\n                webSocket = new this._webSocketConstructor(url);\r\n            }\r\n\r\n            if (transferFormat === TransferFormat.Binary) {\r\n                webSocket.binaryType = \"arraybuffer\";\r\n            }\r\n\r\n            webSocket.onopen = (_event: Event) => {\r\n                this._logger.log(LogLevel.Information, `WebSocket connected to ${url}.`);\r\n                this._webSocket = webSocket;\r\n                opened = true;\r\n                resolve();\r\n            };\r\n\r\n            webSocket.onerror = (event: Event) => {\r\n                let error: any = null;\r\n                // ErrorEvent is a browser only type we need to check if the type exists before using it\r\n                if (typeof ErrorEvent !== \"undefined\" && event instanceof ErrorEvent) {\r\n                    error = event.error;\r\n                } else {\r\n                    error = \"There was an error with the transport\";\r\n                }\r\n\r\n                this._logger.log(LogLevel.Information, `(WebSockets transport) ${error}.`);\r\n            };\r\n\r\n            webSocket.onmessage = (message: MessageEvent) => {\r\n                this._logger.log(LogLevel.Trace, `(WebSockets transport) data received. ${getDataDetail(message.data, this._logMessageContent)}.`);\r\n                if (this.onreceive) {\r\n                    try {\r\n                        this.onreceive(message.data);\r\n                    } catch (error) {\r\n                        this._close(error);\r\n                        return;\r\n                    }\r\n                }\r\n            };\r\n\r\n            webSocket.onclose = (event: CloseEvent) => {\r\n                // Don't call close handler if connection was never established\r\n                // We'll reject the connect call instead\r\n                if (opened) {\r\n                    this._close(event);\r\n                } else {\r\n                    let error: any = null;\r\n                    // ErrorEvent is a browser only type we need to check if the type exists before using it\r\n                    if (typeof ErrorEvent !== \"undefined\" && event instanceof ErrorEvent) {\r\n                        error = event.error;\r\n                    } else {\r\n                        error = \"WebSocket failed to connect. The connection could not be found on the server,\"\r\n                        + \" either the endpoint may not be a SignalR endpoint,\"\r\n                        + \" the connection ID is not present on the server, or there is a proxy blocking WebSockets.\"\r\n                        + \" If you have multiple servers check that sticky sessions are enabled.\";\r\n                    }\r\n\r\n                    reject(new Error(error));\r\n                }\r\n            };\r\n        });\r\n    }\r\n\r\n    public send(data: any): Promise<void> {\r\n        if (this._webSocket && this._webSocket.readyState === this._webSocketConstructor.OPEN) {\r\n            this._logger.log(LogLevel.Trace, `(WebSockets transport) sending data. ${getDataDetail(data, this._logMessageContent)}.`);\r\n            this._webSocket.send(data);\r\n            return Promise.resolve();\r\n        }\r\n\r\n        return Promise.reject(\"WebSocket is not in the OPEN state\");\r\n    }\r\n\r\n    public stop(): Promise<void> {\r\n        if (this._webSocket) {\r\n            // Manually invoke onclose callback inline so we know the HttpConnection was closed properly before returning\r\n            // This also solves an issue where websocket.onclose could take 18+ seconds to trigger during network disconnects\r\n            this._close(undefined);\r\n        }\r\n\r\n        return Promise.resolve();\r\n    }\r\n\r\n    private _close(event: CloseEvent | Error | unknown): void {\r\n        // webSocket will be null if the transport did not start successfully\r\n        if (this._webSocket) {\r\n            // Clear websocket handlers because we are considering the socket closed now\r\n            this._webSocket.onclose = () => {};\r\n            this._webSocket.onmessage = () => {};\r\n            this._webSocket.onerror = () => {};\r\n            this._webSocket.close();\r\n            this._webSocket = undefined;\r\n        }\r\n\r\n        this._logger.log(LogLevel.Trace, \"(WebSockets transport) socket closed.\");\r\n\r\n        if (this.onclose) {\r\n            if (this._isCloseEvent(event) && (event.wasClean === false || event.code !== 1000)) {\r\n                this.onclose(new Error(`WebSocket closed with status code: ${event.code} (${event.reason || \"no reason given\"}).`));\r\n            } else if (event instanceof Error) {\r\n                this.onclose(event);\r\n            } else {\r\n                this.onclose();\r\n            }\r\n        }\r\n    }\r\n\r\n    private _isCloseEvent(event?: any): event is CloseEvent {\r\n        return event && typeof event.wasClean === \"boolean\" && typeof event.code === \"number\";\r\n    }\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { AbortController } from \"./AbortController\";\r\nimport { HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpRequest } from \"./HttpClient\";\r\nimport { ILogger, LogLevel } from \"./ILogger\";\r\nimport { ITransport, TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, sendMessage } from \"./Utils\";\r\nimport { IHttpConnectionOptions } from \"./IHttpConnectionOptions\";\r\n\r\n// Not exported from 'index', this type is internal.\r\n/** @private */\r\nexport class LongPollingTransport implements ITransport {\r\n    private readonly _httpClient: HttpClient;\r\n    private readonly _logger: ILogger;\r\n    private readonly _options: IHttpConnectionOptions;\r\n    private readonly _pollAbort: AbortController;\r\n\r\n    private _url?: string;\r\n    private _running: boolean;\r\n    private _receiving?: Promise<void>;\r\n    private _closeError?: Error | unknown;\r\n\r\n    public onreceive: ((data: string | ArrayBuffer) => void) | null;\r\n    public onclose: ((error?: Error | unknown) => void) | null;\r\n\r\n    // This is an internal type, not exported from 'index' so this is really just internal.\r\n    public get pollAborted(): boolean {\r\n        return this._pollAbort.aborted;\r\n    }\r\n\r\n    constructor(httpClient: HttpClient, logger: ILogger, options: IHttpConnectionOptions) {\r\n        this._httpClient = httpClient;\r\n        this._logger = logger;\r\n        this._pollAbort = new AbortController();\r\n        this._options = options;\r\n\r\n        this._running = false;\r\n\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n\r\n    public async connect(url: string, transferFormat: TransferFormat): Promise<void> {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isRequired(transferFormat, \"transferFormat\");\r\n        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n\r\n        this._url = url;\r\n\r\n        this._logger.log(LogLevel.Trace, \"(LongPolling transport) Connecting.\");\r\n\r\n        // Allow binary format on Node and Browsers that support binary content (indicated by the presence of responseType property)\r\n        if (transferFormat === TransferFormat.Binary &&\r\n            (typeof XMLHttpRequest !== \"undefined\" && typeof new XMLHttpRequest().responseType !== \"string\")) {\r\n            throw new Error(\"Binary protocols over XmlHttpRequest not implementing advanced features are not supported.\");\r\n        }\r\n\r\n        const [name, value] = getUserAgentHeader();\r\n        const headers = { [name]: value, ...this._options.headers };\r\n\r\n        const pollOptions: HttpRequest = {\r\n            abortSignal: this._pollAbort.signal,\r\n            headers,\r\n            timeout: 100000,\r\n            withCredentials: this._options.withCredentials,\r\n        };\r\n\r\n        if (transferFormat === TransferFormat.Binary) {\r\n            pollOptions.responseType = \"arraybuffer\";\r\n        }\r\n\r\n        // Make initial long polling request\r\n        // Server uses first long polling request to finish initializing connection and it returns without data\r\n        const pollUrl = `${url}&_=${Date.now()}`;\r\n        this._logger.log(LogLevel.Trace, `(LongPolling transport) polling: ${pollUrl}.`);\r\n        const response = await this._httpClient.get(pollUrl, pollOptions);\r\n        if (response.statusCode !== 200) {\r\n            this._logger.log(LogLevel.Error, `(LongPolling transport) Unexpected response code: ${response.statusCode}.`);\r\n\r\n            // Mark running as false so that the poll immediately ends and runs the close logic\r\n            this._closeError = new HttpError(response.statusText || \"\", response.statusCode);\r\n            this._running = false;\r\n        } else {\r\n            this._running = true;\r\n        }\r\n\r\n        this._receiving = this._poll(this._url, pollOptions);\r\n    }\r\n\r\n    private async _poll(url: string, pollOptions: HttpRequest): Promise<void> {\r\n        try {\r\n            while (this._running) {\r\n                try {\r\n                    const pollUrl = `${url}&_=${Date.now()}`;\r\n                    this._logger.log(LogLevel.Trace, `(LongPolling transport) polling: ${pollUrl}.`);\r\n                    const response = await this._httpClient.get(pollUrl, pollOptions);\r\n\r\n                    if (response.statusCode === 204) {\r\n                        this._logger.log(LogLevel.Information, \"(LongPolling transport) Poll terminated by server.\");\r\n\r\n                        this._running = false;\r\n                    } else if (response.statusCode !== 200) {\r\n                        this._logger.log(LogLevel.Error, `(LongPolling transport) Unexpected response code: ${response.statusCode}.`);\r\n\r\n                        // Unexpected status code\r\n                        this._closeError = new HttpError(response.statusText || \"\", response.statusCode);\r\n                        this._running = false;\r\n                    } else {\r\n                        // Process the response\r\n                        if (response.content) {\r\n                            this._logger.log(LogLevel.Trace, `(LongPolling transport) data received. ${getDataDetail(response.content, this._options.logMessageContent!)}.`);\r\n                            if (this.onreceive) {\r\n                                this.onreceive(response.content);\r\n                            }\r\n                        } else {\r\n                            // This is another way timeout manifest.\r\n                            this._logger.log(LogLevel.Trace, \"(LongPolling transport) Poll timed out, reissuing.\");\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    if (!this._running) {\r\n                        // Log but disregard errors that occur after stopping\r\n                        this._logger.log(LogLevel.Trace, `(LongPolling transport) Poll errored after shutdown: ${(e as any).message}`);\r\n                    } else {\r\n                        if (e instanceof TimeoutError) {\r\n                            // Ignore timeouts and reissue the poll.\r\n                            this._logger.log(LogLevel.Trace, \"(LongPolling transport) Poll timed out, reissuing.\");\r\n                        } else {\r\n                            // Close the connection with the error as the result.\r\n                            this._closeError = e;\r\n                            this._running = false;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        } finally {\r\n            this._logger.log(LogLevel.Trace, \"(LongPolling transport) Polling complete.\");\r\n\r\n            // We will reach here with pollAborted==false when the server returned a response causing the transport to stop.\r\n            // If pollAborted==true then client initiated the stop and the stop method will raise the close event after DELETE is sent.\r\n            if (!this.pollAborted) {\r\n                this._raiseOnClose();\r\n            }\r\n        }\r\n    }\r\n\r\n    public async send(data: any): Promise<void> {\r\n        if (!this._running) {\r\n            return Promise.reject(new Error(\"Cannot send until the transport is connected\"));\r\n        }\r\n        return sendMessage(this._logger, \"LongPolling\", this._httpClient, this._url!, data, this._options);\r\n    }\r\n\r\n    public async stop(): Promise<void> {\r\n        this._logger.log(LogLevel.Trace, \"(LongPolling transport) Stopping polling.\");\r\n\r\n        // Tell receiving loop to stop, abort any current request, and then wait for it to finish\r\n        this._running = false;\r\n        this._pollAbort.abort();\r\n\r\n        try {\r\n            await this._receiving;\r\n\r\n            // Send DELETE to clean up long polling on the server\r\n            this._logger.log(LogLevel.Trace, `(LongPolling transport) sending DELETE request to ${this._url}.`);\r\n\r\n            const headers: {[k: string]: string} = {};\r\n            const [name, value] = getUserAgentHeader();\r\n            headers[name] = value;\r\n\r\n            const deleteOptions: HttpRequest = {\r\n                headers: { ...headers, ...this._options.headers },\r\n                timeout: this._options.timeout,\r\n                withCredentials: this._options.withCredentials,\r\n            };\r\n\r\n            let error;\r\n            try {\r\n                await this._httpClient.delete(this._url!, deleteOptions);\r\n            } catch (err) {\r\n                error = err;\r\n            }\r\n\r\n            if (error) {\r\n                if (error instanceof HttpError) {\r\n                    if (error.statusCode === 404) {\r\n                        this._logger.log(LogLevel.Trace, \"(LongPolling transport) A 404 response was returned from sending a DELETE request.\");\r\n                    } else {\r\n                        this._logger.log(LogLevel.Trace, `(LongPolling transport) Error sending a DELETE request: ${error}`);\r\n                    }\r\n                }\r\n            } else {\r\n                this._logger.log(LogLevel.Trace, \"(LongPolling transport) DELETE request accepted.\");\r\n            }\r\n\r\n        } finally {\r\n            this._logger.log(LogLevel.Trace, \"(LongPolling transport) Stop finished.\");\r\n\r\n            // Raise close event here instead of in polling\r\n            // It needs to happen after the DELETE request is sent\r\n            this._raiseOnClose();\r\n        }\r\n    }\r\n\r\n    private _raiseOnClose() {\r\n        if (this.onclose) {\r\n            let logMessage = \"(LongPolling transport) Firing onclose event.\";\r\n            if (this._closeError) {\r\n                logMessage += \" Error: \" + this._closeError;\r\n            }\r\n            this._logger.log(LogLevel.Trace, logMessage);\r\n            this.onclose(this._closeError);\r\n        }\r\n    }\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\n// Not exported from index\r\n/** @private */\r\nexport class TextMessageFormat {\r\n    public static RecordSeparatorCode = 0x1e;\r\n    public static RecordSeparator = String.fromCharCode(TextMessageFormat.RecordSeparatorCode);\r\n\r\n    public static write(output: string): string {\r\n        return `${output}${TextMessageFormat.RecordSeparator}`;\r\n    }\r\n\r\n    public static parse(input: string): string[] {\r\n        if (input[input.length - 1] !== TextMessageFormat.RecordSeparator) {\r\n            throw new Error(\"Message is incomplete.\");\r\n        }\r\n\r\n        const messages = input.split(TextMessageFormat.RecordSeparator);\r\n        messages.pop();\r\n        return messages;\r\n    }\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { HandshakeProtocol, HandshakeRequestMessage, HandshakeResponseMessage } from \"./HandshakeProtocol\";\r\nimport { IConnection } from \"./IConnection\";\r\nimport { AbortError } from \"./Errors\";\r\nimport { CancelInvocationMessage, CloseMessage, CompletionMessage, IHubProtocol, InvocationMessage, MessageType, StreamInvocationMessage, StreamItemMessage } from \"./IHubProtocol\";\r\nimport { ILogger, LogLevel } from \"./ILogger\";\r\nimport { IRetryPolicy } from \"./IRetryPolicy\";\r\nimport { IStreamResult } from \"./Stream\";\r\nimport { Subject } from \"./Subject\";\r\nimport { Arg, getErrorString, Platform } from \"./Utils\";\r\nimport { MessageBuffer } from \"./MessageBuffer\";\r\n\r\nconst DEFAULT_TIMEOUT_IN_MS: number = 30 * 1000;\r\nconst DEFAULT_PING_INTERVAL_IN_MS: number = 15 * 1000;\r\nconst DEFAULT_STATEFUL_RECONNECT_BUFFER_SIZE = 100_000;\r\n\r\n/** Describes the current state of the {@link HubConnection} to the server. */\r\nexport enum HubConnectionState {\r\n    /** The hub connection is disconnected. */\r\n    Disconnected = \"Disconnected\",\r\n    /** The hub connection is connecting. */\r\n    Connecting = \"Connecting\",\r\n    /** The hub connection is connected. */\r\n    Connected = \"Connected\",\r\n    /** The hub connection is disconnecting. */\r\n    Disconnecting = \"Disconnecting\",\r\n    /** The hub connection is reconnecting. */\r\n    Reconnecting = \"Reconnecting\",\r\n}\r\n\r\n/** Represents a connection to a SignalR Hub. */\r\nexport class HubConnection {\r\n    private readonly _cachedPingMessage: string | ArrayBuffer;\r\n    // Needs to not start with _ for tests\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    private readonly connection: IConnection;\r\n    private readonly _logger: ILogger;\r\n    private readonly _reconnectPolicy?: IRetryPolicy;\r\n    private readonly _statefulReconnectBufferSize: number;\r\n    private _protocol: IHubProtocol;\r\n    private _handshakeProtocol: HandshakeProtocol;\r\n    private _callbacks: { [invocationId: string]: (invocationEvent: StreamItemMessage | CompletionMessage | null, error?: Error) => void };\r\n    private _methods: { [name: string]: (((...args: any[]) => void) | ((...args: any[]) => any))[] };\r\n    private _invocationId: number;\r\n    private _messageBuffer?: MessageBuffer;\r\n\r\n    private _closedCallbacks: ((error?: Error) => void)[];\r\n    private _reconnectingCallbacks: ((error?: Error) => void)[];\r\n    private _reconnectedCallbacks: ((connectionId?: string) => void)[];\r\n\r\n    private _receivedHandshakeResponse: boolean;\r\n    private _handshakeResolver!: (value?: PromiseLike<{}>) => void;\r\n    private _handshakeRejecter!: (reason?: any) => void;\r\n    private _stopDuringStartError?: Error;\r\n\r\n    private _connectionState: HubConnectionState;\r\n    // connectionStarted is tracked independently from connectionState, so we can check if the\r\n    // connection ever did successfully transition from connecting to connected before disconnecting.\r\n    private _connectionStarted: boolean;\r\n    private _startPromise?: Promise<void>;\r\n    private _stopPromise?: Promise<void>;\r\n    private _nextKeepAlive: number = 0;\r\n\r\n    // The type of these a) doesn't matter and b) varies when building in browser and node contexts\r\n    // Since we're building the WebPack bundle directly from the TypeScript, this matters (previously\r\n    // we built the bundle from the compiled JavaScript).\r\n    private _reconnectDelayHandle?: any;\r\n    private _timeoutHandle?: any;\r\n    private _pingServerHandle?: any;\r\n\r\n    private _freezeEventListener = () =>\r\n    {\r\n        this._logger.log(LogLevel.Warning, \"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep\");\r\n    };\r\n\r\n    /** The server timeout in milliseconds.\r\n     *\r\n     * If this timeout elapses without receiving any messages from the server, the connection will be terminated with an error.\r\n     * The default timeout value is 30,000 milliseconds (30 seconds).\r\n     */\r\n    public serverTimeoutInMilliseconds: number;\r\n\r\n    /** Default interval at which to ping the server.\r\n     *\r\n     * The default value is 15,000 milliseconds (15 seconds).\r\n     * Allows the server to detect hard disconnects (like when a client unplugs their computer).\r\n     * The ping will happen at most as often as the server pings.\r\n     * If the server pings every 5 seconds, a value lower than 5 will ping every 5 seconds.\r\n     */\r\n    public keepAliveIntervalInMilliseconds: number;\r\n\r\n    /** @internal */\r\n    // Using a public static factory method means we can have a private constructor and an _internal_\r\n    // create method that can be used by HubConnectionBuilder. An \"internal\" constructor would just\r\n    // be stripped away and the '.d.ts' file would have no constructor, which is interpreted as a\r\n    // public parameter-less constructor.\r\n    public static create(\r\n        connection: IConnection,\r\n        logger: ILogger,\r\n        protocol: IHubProtocol,\r\n        reconnectPolicy?: IRetryPolicy,\r\n        serverTimeoutInMilliseconds?: number,\r\n        keepAliveIntervalInMilliseconds?: number,\r\n        statefulReconnectBufferSize?: number): HubConnection {\r\n        return new HubConnection(connection, logger, protocol, reconnectPolicy,\r\n            serverTimeoutInMilliseconds, keepAliveIntervalInMilliseconds, statefulReconnectBufferSize);\r\n    }\r\n\r\n    private constructor(\r\n        connection: IConnection,\r\n        logger: ILogger,\r\n        protocol: IHubProtocol,\r\n        reconnectPolicy?: IRetryPolicy,\r\n        serverTimeoutInMilliseconds?: number,\r\n        keepAliveIntervalInMilliseconds?: number,\r\n        statefulReconnectBufferSize?: number) {\r\n        Arg.isRequired(connection, \"connection\");\r\n        Arg.isRequired(logger, \"logger\");\r\n        Arg.isRequired(protocol, \"protocol\");\r\n\r\n        this.serverTimeoutInMilliseconds = serverTimeoutInMilliseconds ?? DEFAULT_TIMEOUT_IN_MS;\r\n        this.keepAliveIntervalInMilliseconds = keepAliveIntervalInMilliseconds ?? DEFAULT_PING_INTERVAL_IN_MS;\r\n\r\n        this._statefulReconnectBufferSize = statefulReconnectBufferSize ?? DEFAULT_STATEFUL_RECONNECT_BUFFER_SIZE;\r\n\r\n        this._logger = logger;\r\n        this._protocol = protocol;\r\n        this.connection = connection;\r\n        this._reconnectPolicy = reconnectPolicy;\r\n        this._handshakeProtocol = new HandshakeProtocol();\r\n\r\n        this.connection.onreceive = (data: any) => this._processIncomingData(data);\r\n        this.connection.onclose = (error?: Error) => this._connectionClosed(error);\r\n\r\n        this._callbacks = {};\r\n        this._methods = {};\r\n        this._closedCallbacks = [];\r\n        this._reconnectingCallbacks = [];\r\n        this._reconnectedCallbacks = [];\r\n        this._invocationId = 0;\r\n        this._receivedHandshakeResponse = false;\r\n        this._connectionState = HubConnectionState.Disconnected;\r\n        this._connectionStarted = false;\r\n\r\n        this._cachedPingMessage = this._protocol.writeMessage({ type: MessageType.Ping });\r\n    }\r\n\r\n    /** Indicates the state of the {@link HubConnection} to the server. */\r\n    get state(): HubConnectionState {\r\n        return this._connectionState;\r\n    }\r\n\r\n    /** Represents the connection id of the {@link HubConnection} on the server. The connection id will be null when the connection is either\r\n     *  in the disconnected state or if the negotiation step was skipped.\r\n     */\r\n    get connectionId(): string | null {\r\n        return this.connection ? (this.connection.connectionId || null) : null;\r\n    }\r\n\r\n    /** Indicates the url of the {@link HubConnection} to the server. */\r\n    get baseUrl(): string {\r\n        return this.connection.baseUrl || \"\";\r\n    }\r\n\r\n    /**\r\n     * Sets a new url for the HubConnection. Note that the url can only be changed when the connection is in either the Disconnected or\r\n     * Reconnecting states.\r\n     * @param {string} url The url to connect to.\r\n     */\r\n    set baseUrl(url: string) {\r\n        if (this._connectionState !== HubConnectionState.Disconnected && this._connectionState !== HubConnectionState.Reconnecting) {\r\n            throw new Error(\"The HubConnection must be in the Disconnected or Reconnecting state to change the url.\");\r\n        }\r\n\r\n        if (!url) {\r\n            throw new Error(\"The HubConnection url must be a valid url.\");\r\n        }\r\n\r\n        this.connection.baseUrl = url;\r\n    }\r\n\r\n    /** Starts the connection.\r\n     *\r\n     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully established, or rejects with an error.\r\n     */\r\n    public start(): Promise<void> {\r\n        this._startPromise = this._startWithStateTransitions();\r\n        return this._startPromise;\r\n    }\r\n\r\n    private async _startWithStateTransitions(): Promise<void> {\r\n        if (this._connectionState !== HubConnectionState.Disconnected) {\r\n            return Promise.reject(new Error(\"Cannot start a HubConnection that is not in the 'Disconnected' state.\"));\r\n        }\r\n\r\n        this._connectionState = HubConnectionState.Connecting;\r\n        this._logger.log(LogLevel.Debug, \"Starting HubConnection.\");\r\n\r\n        try {\r\n            await this._startInternal();\r\n\r\n            if (Platform.isBrowser) {\r\n                // Log when the browser freezes the tab so users know why their connection unexpectedly stopped working\r\n                window.document.addEventListener(\"freeze\", this._freezeEventListener);\r\n            }\r\n\r\n            this._connectionState = HubConnectionState.Connected;\r\n            this._connectionStarted = true;\r\n            this._logger.log(LogLevel.Debug, \"HubConnection connected successfully.\");\r\n        } catch (e) {\r\n            this._connectionState = HubConnectionState.Disconnected;\r\n            this._logger.log(LogLevel.Debug, `HubConnection failed to start successfully because of error '${e}'.`);\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n\r\n    private async _startInternal() {\r\n        this._stopDuringStartError = undefined;\r\n        this._receivedHandshakeResponse = false;\r\n        // Set up the promise before any connection is (re)started otherwise it could race with received messages\r\n        const handshakePromise = new Promise((resolve, reject) => {\r\n            this._handshakeResolver = resolve;\r\n            this._handshakeRejecter = reject;\r\n        });\r\n\r\n        await this.connection.start(this._protocol.transferFormat);\r\n\r\n        try {\r\n            let version = this._protocol.version;\r\n            if (!this.connection.features.reconnect) {\r\n                // Stateful Reconnect starts with HubProtocol version 2, newer clients connecting to older servers will fail to connect due to\r\n                // the handshake only supporting version 1, so we will try to send version 1 during the handshake to keep old servers working.\r\n                version = 1;\r\n            }\r\n\r\n            const handshakeRequest: HandshakeRequestMessage = {\r\n                protocol: this._protocol.name,\r\n                version,\r\n            };\r\n\r\n            this._logger.log(LogLevel.Debug, \"Sending handshake request.\");\r\n\r\n            await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(handshakeRequest));\r\n\r\n            this._logger.log(LogLevel.Information, `Using HubProtocol '${this._protocol.name}'.`);\r\n\r\n            // defensively cleanup timeout in case we receive a message from the server before we finish start\r\n            this._cleanupTimeout();\r\n            this._resetTimeoutPeriod();\r\n            this._resetKeepAliveInterval();\r\n\r\n            await handshakePromise;\r\n\r\n            // It's important to check the stopDuringStartError instead of just relying on the handshakePromise\r\n            // being rejected on close, because this continuation can run after both the handshake completed successfully\r\n            // and the connection was closed.\r\n            if (this._stopDuringStartError) {\r\n                // It's important to throw instead of returning a rejected promise, because we don't want to allow any state\r\n                // transitions to occur between now and the calling code observing the exceptions. Returning a rejected promise\r\n                // will cause the calling continuation to get scheduled to run later.\r\n                // eslint-disable-next-line @typescript-eslint/no-throw-literal\r\n                throw this._stopDuringStartError;\r\n            }\r\n\r\n            const useStatefulReconnect = this.connection.features.reconnect || false;\r\n            if (useStatefulReconnect) {\r\n                this._messageBuffer = new MessageBuffer(this._protocol, this.connection, this._statefulReconnectBufferSize);\r\n                this.connection.features.disconnected = this._messageBuffer._disconnected.bind(this._messageBuffer);\r\n                this.connection.features.resend = () => {\r\n                    if (this._messageBuffer) {\r\n                        return this._messageBuffer._resend();\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (!this.connection.features.inherentKeepAlive) {\r\n                await this._sendMessage(this._cachedPingMessage);\r\n            }\r\n        } catch (e) {\r\n            this._logger.log(LogLevel.Debug, `Hub handshake failed with error '${e}' during start(). Stopping HubConnection.`);\r\n\r\n            this._cleanupTimeout();\r\n            this._cleanupPingTimer();\r\n\r\n            // HttpConnection.stop() should not complete until after the onclose callback is invoked.\r\n            // This will transition the HubConnection to the disconnected state before HttpConnection.stop() completes.\r\n            await this.connection.stop(e);\r\n            throw e;\r\n        }\r\n    }\r\n\r\n    /** Stops the connection.\r\n     *\r\n     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully terminated, or rejects with an error.\r\n     */\r\n    public async stop(): Promise<void> {\r\n        // Capture the start promise before the connection might be restarted in an onclose callback.\r\n        const startPromise = this._startPromise;\r\n        this.connection.features.reconnect = false;\r\n\r\n        this._stopPromise = this._stopInternal();\r\n        await this._stopPromise;\r\n\r\n        try {\r\n            // Awaiting undefined continues immediately\r\n            await startPromise;\r\n        } catch (e) {\r\n            // This exception is returned to the user as a rejected Promise from the start method.\r\n        }\r\n    }\r\n\r\n    private _stopInternal(error?: Error): Promise<void> {\r\n        if (this._connectionState === HubConnectionState.Disconnected) {\r\n            this._logger.log(LogLevel.Debug, `Call to HubConnection.stop(${error}) ignored because it is already in the disconnected state.`);\r\n            return Promise.resolve();\r\n        }\r\n\r\n        if (this._connectionState === HubConnectionState.Disconnecting) {\r\n            this._logger.log(LogLevel.Debug, `Call to HttpConnection.stop(${error}) ignored because the connection is already in the disconnecting state.`);\r\n            return this._stopPromise!;\r\n        }\r\n\r\n        const state = this._connectionState;\r\n        this._connectionState = HubConnectionState.Disconnecting;\r\n\r\n        this._logger.log(LogLevel.Debug, \"Stopping HubConnection.\");\r\n\r\n        if (this._reconnectDelayHandle) {\r\n            // We're in a reconnect delay which means the underlying connection is currently already stopped.\r\n            // Just clear the handle to stop the reconnect loop (which no one is waiting on thankfully) and\r\n            // fire the onclose callbacks.\r\n            this._logger.log(LogLevel.Debug, \"Connection stopped during reconnect delay. Done reconnecting.\");\r\n\r\n            clearTimeout(this._reconnectDelayHandle);\r\n            this._reconnectDelayHandle = undefined;\r\n\r\n            this._completeClose();\r\n            return Promise.resolve();\r\n        }\r\n\r\n        if (state === HubConnectionState.Connected) {\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            this._sendCloseMessage();\r\n        }\r\n\r\n        this._cleanupTimeout();\r\n        this._cleanupPingTimer();\r\n        this._stopDuringStartError = error || new AbortError(\"The connection was stopped before the hub handshake could complete.\");\r\n\r\n        // HttpConnection.stop() should not complete until after either HttpConnection.start() fails\r\n        // or the onclose callback is invoked. The onclose callback will transition the HubConnection\r\n        // to the disconnected state if need be before HttpConnection.stop() completes.\r\n        return this.connection.stop(error);\r\n    }\r\n\r\n    private async _sendCloseMessage() {\r\n        try {\r\n            await this._sendWithProtocol(this._createCloseMessage());\r\n        } catch {\r\n            // Ignore, this is a best effort attempt to let the server know the client closed gracefully.\r\n        }\r\n    }\r\n\r\n    /** Invokes a streaming hub method on the server using the specified name and arguments.\r\n     *\r\n     * @typeparam T The type of the items returned by the server.\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {IStreamResult<T>} An object that yields results from the server as they are received.\r\n     */\r\n    public stream<T = any>(methodName: string, ...args: any[]): IStreamResult<T> {\r\n        const [streams, streamIds] = this._replaceStreamingParams(args);\r\n        const invocationDescriptor = this._createStreamInvocation(methodName, args, streamIds);\r\n\r\n        // eslint-disable-next-line prefer-const\r\n        let promiseQueue: Promise<void>;\r\n\r\n        const subject = new Subject<T>();\r\n        subject.cancelCallback = () => {\r\n            const cancelInvocation: CancelInvocationMessage = this._createCancelInvocation(invocationDescriptor.invocationId);\r\n\r\n            delete this._callbacks[invocationDescriptor.invocationId];\r\n\r\n            return promiseQueue.then(() => {\r\n                return this._sendWithProtocol(cancelInvocation);\r\n            });\r\n        };\r\n\r\n        this._callbacks[invocationDescriptor.invocationId] = (invocationEvent: CompletionMessage | StreamItemMessage | null, error?: Error) => {\r\n            if (error) {\r\n                subject.error(error);\r\n                return;\r\n            } else if (invocationEvent) {\r\n                // invocationEvent will not be null when an error is not passed to the callback\r\n                if (invocationEvent.type === MessageType.Completion) {\r\n                    if (invocationEvent.error) {\r\n                        subject.error(new Error(invocationEvent.error));\r\n                    } else {\r\n                        subject.complete();\r\n                    }\r\n                } else {\r\n                    subject.next((invocationEvent.item) as T);\r\n                }\r\n            }\r\n        };\r\n\r\n        promiseQueue = this._sendWithProtocol(invocationDescriptor)\r\n            .catch((e) => {\r\n                subject.error(e);\r\n                delete this._callbacks[invocationDescriptor.invocationId];\r\n            });\r\n\r\n        this._launchStreams(streams, promiseQueue);\r\n\r\n        return subject;\r\n    }\r\n\r\n    private _sendMessage(message: any) {\r\n        this._resetKeepAliveInterval();\r\n        return this.connection.send(message);\r\n    }\r\n\r\n    /**\r\n     * Sends a js object to the server.\r\n     * @param message The js object to serialize and send.\r\n     */\r\n    private _sendWithProtocol(message: any) {\r\n        if (this._messageBuffer) {\r\n            return this._messageBuffer._send(message);\r\n        } else {\r\n            return this._sendMessage(this._protocol.writeMessage(message));\r\n        }\r\n    }\r\n\r\n    /** Invokes a hub method on the server using the specified name and arguments. Does not wait for a response from the receiver.\r\n     *\r\n     * The Promise returned by this method resolves when the client has sent the invocation to the server. The server may still\r\n     * be processing the invocation.\r\n     *\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {Promise<void>} A Promise that resolves when the invocation has been successfully sent, or rejects with an error.\r\n     */\r\n    public send(methodName: string, ...args: any[]): Promise<void> {\r\n        const [streams, streamIds] = this._replaceStreamingParams(args);\r\n        const sendPromise = this._sendWithProtocol(this._createInvocation(methodName, args, true, streamIds));\r\n\r\n        this._launchStreams(streams, sendPromise);\r\n\r\n        return sendPromise;\r\n    }\r\n\r\n    /** Invokes a hub method on the server using the specified name and arguments.\r\n     *\r\n     * The Promise returned by this method resolves when the server indicates it has finished invoking the method. When the promise\r\n     * resolves, the server has finished invoking the method. If the server method returns a result, it is produced as the result of\r\n     * resolving the Promise.\r\n     *\r\n     * @typeparam T The expected return type.\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {Promise<T>} A Promise that resolves with the result of the server method (if any), or rejects with an error.\r\n     */\r\n    public invoke<T = any>(methodName: string, ...args: any[]): Promise<T> {\r\n        const [streams, streamIds] = this._replaceStreamingParams(args);\r\n        const invocationDescriptor = this._createInvocation(methodName, args, false, streamIds);\r\n\r\n        const p = new Promise<any>((resolve, reject) => {\r\n            // invocationId will always have a value for a non-blocking invocation\r\n            this._callbacks[invocationDescriptor.invocationId!] = (invocationEvent: StreamItemMessage | CompletionMessage | null, error?: Error) => {\r\n                if (error) {\r\n                    reject(error);\r\n                    return;\r\n                } else if (invocationEvent) {\r\n                    // invocationEvent will not be null when an error is not passed to the callback\r\n                    if (invocationEvent.type === MessageType.Completion) {\r\n                        if (invocationEvent.error) {\r\n                            reject(new Error(invocationEvent.error));\r\n                        } else {\r\n                            resolve(invocationEvent.result);\r\n                        }\r\n                    } else {\r\n                        reject(new Error(`Unexpected message type: ${invocationEvent.type}`));\r\n                    }\r\n                }\r\n            };\r\n\r\n            const promiseQueue = this._sendWithProtocol(invocationDescriptor)\r\n                .catch((e) => {\r\n                    reject(e);\r\n                    // invocationId will always have a value for a non-blocking invocation\r\n                    delete this._callbacks[invocationDescriptor.invocationId!];\r\n                });\r\n\r\n            this._launchStreams(streams, promiseQueue);\r\n        });\r\n\r\n        return p;\r\n    }\r\n\r\n    /** Registers a handler that will be invoked when the hub method with the specified method name is invoked.\r\n     *\r\n     * @param {string} methodName The name of the hub method to define.\r\n     * @param {Function} newMethod The handler that will be raised when the hub method is invoked.\r\n     */\r\n    public on(methodName: string, newMethod: (...args: any[]) => any): void\r\n    public on(methodName: string, newMethod: (...args: any[]) => void): void {\r\n        if (!methodName || !newMethod) {\r\n            return;\r\n        }\r\n\r\n        methodName = methodName.toLowerCase();\r\n        if (!this._methods[methodName]) {\r\n            this._methods[methodName] = [];\r\n        }\r\n\r\n        // Preventing adding the same handler multiple times.\r\n        if (this._methods[methodName].indexOf(newMethod) !== -1) {\r\n            return;\r\n        }\r\n\r\n        this._methods[methodName].push(newMethod);\r\n    }\r\n\r\n    /** Removes all handlers for the specified hub method.\r\n     *\r\n     * @param {string} methodName The name of the method to remove handlers for.\r\n     */\r\n    public off(methodName: string): void;\r\n\r\n    /** Removes the specified handler for the specified hub method.\r\n     *\r\n     * You must pass the exact same Function instance as was previously passed to {@link @microsoft/signalr.HubConnection.on}. Passing a different instance (even if the function\r\n     * body is the same) will not remove the handler.\r\n     *\r\n     * @param {string} methodName The name of the method to remove handlers for.\r\n     * @param {Function} method The handler to remove. This must be the same Function instance as the one passed to {@link @microsoft/signalr.HubConnection.on}.\r\n     */\r\n    public off(methodName: string, method: (...args: any[]) => void): void;\r\n    public off(methodName: string, method?: (...args: any[]) => void): void {\r\n        if (!methodName) {\r\n            return;\r\n        }\r\n\r\n        methodName = methodName.toLowerCase();\r\n        const handlers = this._methods[methodName];\r\n        if (!handlers) {\r\n            return;\r\n        }\r\n        if (method) {\r\n            const removeIdx = handlers.indexOf(method);\r\n            if (removeIdx !== -1) {\r\n                handlers.splice(removeIdx, 1);\r\n                if (handlers.length === 0) {\r\n                    delete this._methods[methodName];\r\n                }\r\n            }\r\n        } else {\r\n            delete this._methods[methodName];\r\n        }\r\n\r\n    }\r\n\r\n    /** Registers a handler that will be invoked when the connection is closed.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection is closed. Optionally receives a single argument containing the error that caused the connection to close (if any).\r\n     */\r\n    public onclose(callback: (error?: Error) => void): void {\r\n        if (callback) {\r\n            this._closedCallbacks.push(callback);\r\n        }\r\n    }\r\n\r\n    /** Registers a handler that will be invoked when the connection starts reconnecting.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection starts reconnecting. Optionally receives a single argument containing the error that caused the connection to start reconnecting (if any).\r\n     */\r\n    public onreconnecting(callback: (error?: Error) => void): void {\r\n        if (callback) {\r\n            this._reconnectingCallbacks.push(callback);\r\n        }\r\n    }\r\n\r\n    /** Registers a handler that will be invoked when the connection successfully reconnects.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection successfully reconnects.\r\n     */\r\n    public onreconnected(callback: (connectionId?: string) => void): void {\r\n        if (callback) {\r\n            this._reconnectedCallbacks.push(callback);\r\n        }\r\n    }\r\n\r\n    private _processIncomingData(data: any) {\r\n        this._cleanupTimeout();\r\n\r\n        if (!this._receivedHandshakeResponse) {\r\n            data = this._processHandshakeResponse(data);\r\n            this._receivedHandshakeResponse = true;\r\n        }\r\n\r\n        // Data may have all been read when processing handshake response\r\n        if (data) {\r\n            // Parse the messages\r\n            const messages = this._protocol.parseMessages(data, this._logger);\r\n\r\n            for (const message of messages) {\r\n                if (this._messageBuffer && !this._messageBuffer._shouldProcessMessage(message)) {\r\n                    // Don't process the message, we are either waiting for a SequenceMessage or received a duplicate message\r\n                    continue;\r\n                }\r\n\r\n                switch (message.type) {\r\n                    case MessageType.Invocation:\r\n                        this._invokeClientMethod(message)\r\n                            .catch((e) => {\r\n                                this._logger.log(LogLevel.Error, `Invoke client method threw error: ${getErrorString(e)}`)\r\n                            });\r\n                        break;\r\n                    case MessageType.StreamItem:\r\n                    case MessageType.Completion: {\r\n                        const callback = this._callbacks[message.invocationId];\r\n                        if (callback) {\r\n                            if (message.type === MessageType.Completion) {\r\n                                delete this._callbacks[message.invocationId];\r\n                            }\r\n                            try {\r\n                                callback(message);\r\n                            } catch (e) {\r\n                                this._logger.log(LogLevel.Error, `Stream callback threw error: ${getErrorString(e)}`);\r\n                            }\r\n                        }\r\n                        break;\r\n                    }\r\n                    case MessageType.Ping:\r\n                        // Don't care about pings\r\n                        break;\r\n                    case MessageType.Close: {\r\n                        this._logger.log(LogLevel.Information, \"Close message received from server.\");\r\n\r\n                        const error = message.error ? new Error(\"Server returned an error on close: \" + message.error) : undefined;\r\n\r\n                        if (message.allowReconnect === true) {\r\n                            // It feels wrong not to await connection.stop() here, but processIncomingData is called as part of an onreceive callback which is not async,\r\n                            // this is already the behavior for serverTimeout(), and HttpConnection.Stop() should catch and log all possible exceptions.\r\n\r\n                            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n                            this.connection.stop(error);\r\n                        } else {\r\n                            // We cannot await stopInternal() here, but subsequent calls to stop() will await this if stopInternal() is still ongoing.\r\n                            this._stopPromise = this._stopInternal(error);\r\n                        }\r\n\r\n                        break;\r\n                    }\r\n                    case MessageType.Ack:\r\n                        if (this._messageBuffer) {\r\n                            this._messageBuffer._ack(message);\r\n                        }\r\n                        break;\r\n                    case MessageType.Sequence:\r\n                        if (this._messageBuffer) {\r\n                            this._messageBuffer._resetSequence(message);\r\n                        }\r\n                        break;\r\n                    default:\r\n                        this._logger.log(LogLevel.Warning, `Invalid message type: ${message.type}.`);\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n\r\n        this._resetTimeoutPeriod();\r\n    }\r\n\r\n    private _processHandshakeResponse(data: any): any {\r\n        let responseMessage: HandshakeResponseMessage;\r\n        let remainingData: any;\r\n\r\n        try {\r\n            [remainingData, responseMessage] = this._handshakeProtocol.parseHandshakeResponse(data);\r\n        } catch (e) {\r\n            const message = \"Error parsing handshake response: \" + e;\r\n            this._logger.log(LogLevel.Error, message);\r\n\r\n            const error = new Error(message);\r\n            this._handshakeRejecter(error);\r\n            throw error;\r\n        }\r\n        if (responseMessage.error) {\r\n            const message = \"Server returned handshake error: \" + responseMessage.error;\r\n            this._logger.log(LogLevel.Error, message);\r\n\r\n            const error = new Error(message);\r\n            this._handshakeRejecter(error);\r\n            throw error;\r\n        } else {\r\n            this._logger.log(LogLevel.Debug, \"Server handshake complete.\");\r\n        }\r\n\r\n        this._handshakeResolver();\r\n        return remainingData;\r\n    }\r\n\r\n    private _resetKeepAliveInterval() {\r\n        if (this.connection.features.inherentKeepAlive) {\r\n            return;\r\n        }\r\n\r\n        // Set the time we want the next keep alive to be sent\r\n        // Timer will be setup on next message receive\r\n        this._nextKeepAlive = new Date().getTime() + this.keepAliveIntervalInMilliseconds;\r\n\r\n        this._cleanupPingTimer();\r\n    }\r\n\r\n    private _resetTimeoutPeriod() {\r\n        if (!this.connection.features || !this.connection.features.inherentKeepAlive) {\r\n            // Set the timeout timer\r\n            this._timeoutHandle = setTimeout(() => this.serverTimeout(), this.serverTimeoutInMilliseconds);\r\n\r\n            // Set keepAlive timer if there isn't one\r\n            if (this._pingServerHandle === undefined)\r\n            {\r\n                let nextPing = this._nextKeepAlive - new Date().getTime();\r\n                if (nextPing < 0) {\r\n                    nextPing = 0;\r\n                }\r\n\r\n                // The timer needs to be set from a networking callback to avoid Chrome timer throttling from causing timers to run once a minute\r\n                this._pingServerHandle = setTimeout(async () => {\r\n                    if (this._connectionState === HubConnectionState.Connected) {\r\n                        try {\r\n                            await this._sendMessage(this._cachedPingMessage);\r\n                        } catch {\r\n                            // We don't care about the error. It should be seen elsewhere in the client.\r\n                            // The connection is probably in a bad or closed state now, cleanup the timer so it stops triggering\r\n                            this._cleanupPingTimer();\r\n                        }\r\n                    }\r\n                }, nextPing);\r\n            }\r\n        }\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    private serverTimeout() {\r\n        // The server hasn't talked to us in a while. It doesn't like us anymore ... :(\r\n        // Terminate the connection, but we don't need to wait on the promise. This could trigger reconnecting.\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this.connection.stop(new Error(\"Server timeout elapsed without receiving a message from the server.\"));\r\n    }\r\n\r\n    private async _invokeClientMethod(invocationMessage: InvocationMessage) {\r\n        const methodName = invocationMessage.target.toLowerCase();\r\n        const methods = this._methods[methodName];\r\n        if (!methods) {\r\n            this._logger.log(LogLevel.Warning, `No client method with the name '${methodName}' found.`);\r\n\r\n            // No handlers provided by client but the server is expecting a response still, so we send an error\r\n            if (invocationMessage.invocationId) {\r\n                this._logger.log(LogLevel.Warning, `No result given for '${methodName}' method and invocation ID '${invocationMessage.invocationId}'.`);\r\n                await this._sendWithProtocol(this._createCompletionMessage(invocationMessage.invocationId, \"Client didn't provide a result.\", null));\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Avoid issues with handlers removing themselves thus modifying the list while iterating through it\r\n        const methodsCopy = methods.slice();\r\n\r\n        // Server expects a response\r\n        const expectsResponse = invocationMessage.invocationId ? true : false;\r\n        // We preserve the last result or exception but still call all handlers\r\n        let res;\r\n        let exception;\r\n        let completionMessage;\r\n        for (const m of methodsCopy) {\r\n            try {\r\n                const prevRes = res;\r\n                res = await m.apply(this, invocationMessage.arguments);\r\n                if (expectsResponse && res && prevRes) {\r\n                    this._logger.log(LogLevel.Error, `Multiple results provided for '${methodName}'. Sending error to server.`);\r\n                    completionMessage = this._createCompletionMessage(invocationMessage.invocationId!, `Client provided multiple results.`, null);\r\n                }\r\n                // Ignore exception if we got a result after, the exception will be logged\r\n                exception = undefined;\r\n            } catch (e) {\r\n                exception = e;\r\n                this._logger.log(LogLevel.Error, `A callback for the method '${methodName}' threw error '${e}'.`);\r\n            }\r\n        }\r\n        if (completionMessage) {\r\n            await this._sendWithProtocol(completionMessage);\r\n        } else if (expectsResponse) {\r\n            // If there is an exception that means either no result was given or a handler after a result threw\r\n            if (exception) {\r\n                completionMessage = this._createCompletionMessage(invocationMessage.invocationId!, `${exception}`, null);\r\n            } else if (res !== undefined) {\r\n                completionMessage = this._createCompletionMessage(invocationMessage.invocationId!, null, res);\r\n            } else {\r\n                this._logger.log(LogLevel.Warning, `No result given for '${methodName}' method and invocation ID '${invocationMessage.invocationId}'.`);\r\n                // Client didn't provide a result or throw from a handler, server expects a response so we send an error\r\n                completionMessage = this._createCompletionMessage(invocationMessage.invocationId!, \"Client didn't provide a result.\", null);\r\n            }\r\n            await this._sendWithProtocol(completionMessage);\r\n        } else {\r\n            if (res) {\r\n                this._logger.log(LogLevel.Error, `Result given for '${methodName}' method but server is not expecting a result.`);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _connectionClosed(error?: Error) {\r\n        this._logger.log(LogLevel.Debug, `HubConnection.connectionClosed(${error}) called while in state ${this._connectionState}.`);\r\n\r\n        // Triggering this.handshakeRejecter is insufficient because it could already be resolved without the continuation having run yet.\r\n        this._stopDuringStartError = this._stopDuringStartError || error || new AbortError(\"The underlying connection was closed before the hub handshake could complete.\");\r\n\r\n        // If the handshake is in progress, start will be waiting for the handshake promise, so we complete it.\r\n        // If it has already completed, this should just noop.\r\n        if (this._handshakeResolver) {\r\n            this._handshakeResolver();\r\n        }\r\n\r\n        this._cancelCallbacksWithError(error || new Error(\"Invocation canceled due to the underlying connection being closed.\"));\r\n\r\n        this._cleanupTimeout();\r\n        this._cleanupPingTimer();\r\n\r\n        if (this._connectionState === HubConnectionState.Disconnecting) {\r\n            this._completeClose(error);\r\n        } else if (this._connectionState === HubConnectionState.Connected && this._reconnectPolicy) {\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            this._reconnect(error);\r\n        } else if (this._connectionState === HubConnectionState.Connected) {\r\n            this._completeClose(error);\r\n        }\r\n\r\n        // If none of the above if conditions were true were called the HubConnection must be in either:\r\n        // 1. The Connecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail it.\r\n        // 2. The Reconnecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail the current reconnect attempt\r\n        //    and potentially continue the reconnect() loop.\r\n        // 3. The Disconnected state in which case we're already done.\r\n    }\r\n\r\n    private _completeClose(error?: Error) {\r\n        if (this._connectionStarted) {\r\n            this._connectionState = HubConnectionState.Disconnected;\r\n            this._connectionStarted = false;\r\n            if (this._messageBuffer) {\r\n                this._messageBuffer._dispose(error ?? new Error(\"Connection closed.\"));\r\n                this._messageBuffer = undefined;\r\n            }\r\n\r\n            if (Platform.isBrowser) {\r\n                window.document.removeEventListener(\"freeze\", this._freezeEventListener);\r\n            }\r\n\r\n            try {\r\n                this._closedCallbacks.forEach((c) => c.apply(this, [error]));\r\n            } catch (e) {\r\n                this._logger.log(LogLevel.Error, `An onclose callback called with error '${error}' threw error '${e}'.`);\r\n            }\r\n        }\r\n    }\r\n\r\n    private async _reconnect(error?: Error) {\r\n        const reconnectStartTime = Date.now();\r\n        let previousReconnectAttempts = 0;\r\n        let retryError = error !== undefined ? error : new Error(\"Attempting to reconnect due to a unknown error.\");\r\n\r\n        let nextRetryDelay = this._getNextRetryDelay(previousReconnectAttempts++, 0, retryError);\r\n\r\n        if (nextRetryDelay === null) {\r\n            this._logger.log(LogLevel.Debug, \"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt.\");\r\n            this._completeClose(error);\r\n            return;\r\n        }\r\n\r\n        this._connectionState = HubConnectionState.Reconnecting;\r\n\r\n        if (error) {\r\n            this._logger.log(LogLevel.Information, `Connection reconnecting because of error '${error}'.`);\r\n        } else {\r\n            this._logger.log(LogLevel.Information, \"Connection reconnecting.\");\r\n        }\r\n\r\n        if (this._reconnectingCallbacks.length !== 0) {\r\n            try {\r\n                this._reconnectingCallbacks.forEach((c) => c.apply(this, [error]));\r\n            } catch (e) {\r\n                this._logger.log(LogLevel.Error, `An onreconnecting callback called with error '${error}' threw error '${e}'.`);\r\n            }\r\n\r\n            // Exit early if an onreconnecting callback called connection.stop().\r\n            if (this._connectionState !== HubConnectionState.Reconnecting) {\r\n                this._logger.log(LogLevel.Debug, \"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.\");\r\n                return;\r\n            }\r\n        }\r\n\r\n        while (nextRetryDelay !== null) {\r\n            this._logger.log(LogLevel.Information, `Reconnect attempt number ${previousReconnectAttempts} will start in ${nextRetryDelay} ms.`);\r\n\r\n            await new Promise((resolve) => {\r\n                this._reconnectDelayHandle = setTimeout(resolve, nextRetryDelay!);\r\n            });\r\n            this._reconnectDelayHandle = undefined;\r\n\r\n            if (this._connectionState !== HubConnectionState.Reconnecting) {\r\n                this._logger.log(LogLevel.Debug, \"Connection left the reconnecting state during reconnect delay. Done reconnecting.\");\r\n                return;\r\n            }\r\n\r\n            try {\r\n                await this._startInternal();\r\n\r\n                this._connectionState = HubConnectionState.Connected;\r\n                this._logger.log(LogLevel.Information, \"HubConnection reconnected successfully.\");\r\n\r\n                if (this._reconnectedCallbacks.length !== 0) {\r\n                    try {\r\n                        this._reconnectedCallbacks.forEach((c) => c.apply(this, [this.connection.connectionId]));\r\n                    } catch (e) {\r\n                        this._logger.log(LogLevel.Error, `An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${e}'.`);\r\n                    }\r\n                }\r\n\r\n                return;\r\n            } catch (e) {\r\n                this._logger.log(LogLevel.Information, `Reconnect attempt failed because of error '${e}'.`);\r\n\r\n                if (this._connectionState !== HubConnectionState.Reconnecting) {\r\n                    this._logger.log(LogLevel.Debug, `Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`);\r\n                    // The TypeScript compiler thinks that connectionState must be Connected here. The TypeScript compiler is wrong.\r\n                    if (this._connectionState as any === HubConnectionState.Disconnecting) {\r\n                        this._completeClose();\r\n                    }\r\n                    return;\r\n                }\r\n\r\n                retryError = e instanceof Error ? e : new Error((e as any).toString());\r\n                nextRetryDelay = this._getNextRetryDelay(previousReconnectAttempts++, Date.now() - reconnectStartTime, retryError);\r\n            }\r\n        }\r\n\r\n        this._logger.log(LogLevel.Information, `Reconnect retries have been exhausted after ${Date.now() - reconnectStartTime} ms and ${previousReconnectAttempts} failed attempts. Connection disconnecting.`);\r\n\r\n        this._completeClose();\r\n    }\r\n\r\n    private _getNextRetryDelay(previousRetryCount: number, elapsedMilliseconds: number, retryReason: Error) {\r\n        try {\r\n            return this._reconnectPolicy!.nextRetryDelayInMilliseconds({\r\n                elapsedMilliseconds,\r\n                previousRetryCount,\r\n                retryReason,\r\n            });\r\n        } catch (e) {\r\n            this._logger.log(LogLevel.Error, `IRetryPolicy.nextRetryDelayInMilliseconds(${previousRetryCount}, ${elapsedMilliseconds}) threw error '${e}'.`);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    private _cancelCallbacksWithError(error: Error) {\r\n        const callbacks = this._callbacks;\r\n        this._callbacks = {};\r\n\r\n        Object.keys(callbacks)\r\n            .forEach((key) => {\r\n                const callback = callbacks[key];\r\n                try {\r\n                    callback(null, error);\r\n                } catch (e) {\r\n                    this._logger.log(LogLevel.Error, `Stream 'error' callback called with '${error}' threw error: ${getErrorString(e)}`);\r\n                }\r\n            });\r\n    }\r\n\r\n    private _cleanupPingTimer(): void {\r\n        if (this._pingServerHandle) {\r\n            clearTimeout(this._pingServerHandle);\r\n            this._pingServerHandle = undefined;\r\n        }\r\n    }\r\n\r\n    private _cleanupTimeout(): void {\r\n        if (this._timeoutHandle) {\r\n            clearTimeout(this._timeoutHandle);\r\n        }\r\n    }\r\n\r\n    private _createInvocation(methodName: string, args: any[], nonblocking: boolean, streamIds: string[]): InvocationMessage {\r\n        if (nonblocking) {\r\n            if (streamIds.length !== 0) {\r\n                return {\r\n                    arguments: args,\r\n                    streamIds,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            } else {\r\n                return {\r\n                    arguments: args,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n        } else {\r\n            const invocationId = this._invocationId;\r\n            this._invocationId++;\r\n\r\n            if (streamIds.length !== 0) {\r\n                return {\r\n                    arguments: args,\r\n                    invocationId: invocationId.toString(),\r\n                    streamIds,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            } else {\r\n                return {\r\n                    arguments: args,\r\n                    invocationId: invocationId.toString(),\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n        }\r\n    }\r\n\r\n    private _launchStreams(streams: IStreamResult<any>[], promiseQueue: Promise<void>): void {\r\n        if (streams.length === 0) {\r\n            return;\r\n        }\r\n\r\n        // Synchronize stream data so they arrive in-order on the server\r\n        if (!promiseQueue) {\r\n            promiseQueue = Promise.resolve();\r\n        }\r\n\r\n        // We want to iterate over the keys, since the keys are the stream ids\r\n        // eslint-disable-next-line guard-for-in\r\n        for (const streamId in streams) {\r\n            streams[streamId].subscribe({\r\n                complete: () => {\r\n                    promiseQueue = promiseQueue.then(() => this._sendWithProtocol(this._createCompletionMessage(streamId)));\r\n                },\r\n                error: (err) => {\r\n                    let message: string;\r\n                    if (err instanceof Error) {\r\n                        message = err.message;\r\n                    } else if (err && err.toString) {\r\n                        message = err.toString();\r\n                    } else {\r\n                        message = \"Unknown error\";\r\n                    }\r\n\r\n                    promiseQueue = promiseQueue.then(() => this._sendWithProtocol(this._createCompletionMessage(streamId, message)));\r\n                },\r\n                next: (item) => {\r\n                    promiseQueue = promiseQueue.then(() => this._sendWithProtocol(this._createStreamItemMessage(streamId, item)));\r\n                },\r\n            });\r\n        }\r\n    }\r\n\r\n    private _replaceStreamingParams(args: any[]): [IStreamResult<any>[], string[]] {\r\n        const streams: IStreamResult<any>[] = [];\r\n        const streamIds: string[] = [];\r\n        for (let i = 0; i < args.length; i++) {\r\n            const argument = args[i];\r\n            if (this._isObservable(argument)) {\r\n                const streamId = this._invocationId;\r\n                this._invocationId++;\r\n                // Store the stream for later use\r\n                streams[streamId] = argument;\r\n                streamIds.push(streamId.toString());\r\n\r\n                // remove stream from args\r\n                args.splice(i, 1);\r\n            }\r\n        }\r\n\r\n        return [streams, streamIds];\r\n    }\r\n\r\n    private _isObservable(arg: any): arg is IStreamResult<any> {\r\n        // This allows other stream implementations to just work (like rxjs)\r\n        return arg && arg.subscribe && typeof arg.subscribe === \"function\";\r\n    }\r\n\r\n    private _createStreamInvocation(methodName: string, args: any[], streamIds: string[]): StreamInvocationMessage {\r\n        const invocationId = this._invocationId;\r\n        this._invocationId++;\r\n\r\n        if (streamIds.length !== 0) {\r\n            return {\r\n                arguments: args,\r\n                invocationId: invocationId.toString(),\r\n                streamIds,\r\n                target: methodName,\r\n                type: MessageType.StreamInvocation,\r\n            };\r\n        } else {\r\n            return {\r\n                arguments: args,\r\n                invocationId: invocationId.toString(),\r\n                target: methodName,\r\n                type: MessageType.StreamInvocation,\r\n            };\r\n        }\r\n    }\r\n\r\n    private _createCancelInvocation(id: string): CancelInvocationMessage {\r\n        return {\r\n            invocationId: id,\r\n            type: MessageType.CancelInvocation,\r\n        };\r\n    }\r\n\r\n    private _createStreamItemMessage(id: string, item: any): StreamItemMessage {\r\n        return {\r\n            invocationId: id,\r\n            item,\r\n            type: MessageType.StreamItem,\r\n        };\r\n    }\r\n\r\n    private _createCompletionMessage(id: string, error?: any, result?: any): CompletionMessage {\r\n        if (error) {\r\n            return {\r\n                error,\r\n                invocationId: id,\r\n                type: MessageType.Completion,\r\n            };\r\n        }\r\n\r\n        return {\r\n            invocationId: id,\r\n            result,\r\n            type: MessageType.Completion,\r\n        };\r\n    }\r\n\r\n    private _createCloseMessage(): CloseMessage {\r\n        return { type: MessageType.Close };\r\n    }\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { TextMessageFormat } from \"./TextMessageFormat\";\r\nimport { isArrayBuffer } from \"./Utils\";\r\n\r\n/** @private */\r\nexport interface HandshakeRequestMessage {\r\n    readonly protocol: string;\r\n    readonly version: number;\r\n}\r\n\r\n/** @private */\r\nexport interface HandshakeResponseMessage {\r\n    readonly error: string;\r\n    readonly minorVersion: number;\r\n}\r\n\r\n/** @private */\r\nexport class HandshakeProtocol {\r\n    // Handshake request is always JSON\r\n    public writeHandshakeRequest(handshakeRequest: HandshakeRequestMessage): string {\r\n        return TextMessageFormat.write(JSON.stringify(handshakeRequest));\r\n    }\r\n\r\n    public parseHandshakeResponse(data: any): [any, HandshakeResponseMessage] {\r\n        let messageData: string;\r\n        let remainingData: any;\r\n\r\n        if (isArrayBuffer(data)) {\r\n            // Format is binary but still need to read JSON text from handshake response\r\n            const binaryData = new Uint8Array(data);\r\n            const separatorIndex = binaryData.indexOf(TextMessageFormat.RecordSeparatorCode);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            const responseLength = separatorIndex + 1;\r\n            messageData = String.fromCharCode.apply(null, Array.prototype.slice.call(binaryData.slice(0, responseLength)));\r\n            remainingData = (binaryData.byteLength > responseLength) ? binaryData.slice(responseLength).buffer : null;\r\n        } else {\r\n            const textData: string = data;\r\n            const separatorIndex = textData.indexOf(TextMessageFormat.RecordSeparator);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            const responseLength = separatorIndex + 1;\r\n            messageData = textData.substring(0, responseLength);\r\n            remainingData = (textData.length > responseLength) ? textData.substring(responseLength) : null;\r\n        }\r\n\r\n        // At this point we should have just the single handshake message\r\n        const messages = TextMessageFormat.parse(messageData);\r\n        const response = JSON.parse(messages[0]);\r\n        if (response.type) {\r\n            throw new Error(\"Expected a handshake response from the server.\");\r\n        }\r\n        const responseMessage: HandshakeResponseMessage = response;\r\n\r\n        // multiple messages could have arrived with handshake\r\n        // return additional data to be parsed as usual, or null if all parsed\r\n        return [remainingData, responseMessage];\r\n    }\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { IStreamResult, IStreamSubscriber, ISubscription } from \"./Stream\";\r\nimport { SubjectSubscription } from \"./Utils\";\r\n\r\n/** Stream implementation to stream items to the server. */\r\nexport class Subject<T> implements IStreamResult<T> {\r\n    /** @internal */\r\n    public observers: IStreamSubscriber<T>[];\r\n\r\n    /** @internal */\r\n    public cancelCallback?: () => Promise<void>;\r\n\r\n    constructor() {\r\n        this.observers = [];\r\n    }\r\n\r\n    public next(item: T): void {\r\n        for (const observer of this.observers) {\r\n            observer.next(item);\r\n        }\r\n    }\r\n\r\n    public error(err: any): void {\r\n        for (const observer of this.observers) {\r\n            if (observer.error) {\r\n                observer.error(err);\r\n            }\r\n        }\r\n    }\r\n\r\n    public complete(): void {\r\n        for (const observer of this.observers) {\r\n            if (observer.complete) {\r\n                observer.complete();\r\n            }\r\n        }\r\n    }\r\n\r\n    public subscribe(observer: IStreamSubscriber<T>): ISubscription<T> {\r\n        this.observers.push(observer);\r\n        return new SubjectSubscription(this, observer);\r\n    }\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { AccessTokenHttpClient } from \"./AccessTokenHttpClient\";\r\nimport { DefaultHttpClient } from \"./DefaultHttpClient\";\r\nimport { AggregateErrors, DisabledTransportError, FailedToNegotiateWithServerError, FailedToStartTransportError, HttpError, UnsupportedTransportError, AbortError } from \"./Errors\";\r\nimport { IConnection } from \"./IConnection\";\r\nimport { IHttpConnectionOptions } from \"./IHttpConnectionOptions\";\r\nimport { ILogger, LogLevel } from \"./ILogger\";\r\nimport { HttpTransportType, ITransport, TransferFormat } from \"./ITransport\";\r\nimport { LongPollingTransport } from \"./LongPollingTransport\";\r\nimport { ServerSentEventsTransport } from \"./ServerSentEventsTransport\";\r\nimport { Arg, createLogger, getUserAgentHeader, Platform } from \"./Utils\";\r\nimport { WebSocketTransport } from \"./WebSocketTransport\";\r\n\r\n/** @private */\r\nconst enum ConnectionState {\r\n    Connecting = \"Connecting\",\r\n    Connected = \"Connected\",\r\n    Disconnected = \"Disconnected\",\r\n    Disconnecting = \"Disconnecting\",\r\n}\r\n\r\n/** @private */\r\nexport interface INegotiateResponse {\r\n    connectionId?: string;\r\n    connectionToken?: string;\r\n    negotiateVersion?: number;\r\n    availableTransports?: IAvailableTransport[];\r\n    url?: string;\r\n    accessToken?: string;\r\n    error?: string;\r\n    useStatefulReconnect?: boolean;\r\n}\r\n\r\n/** @private */\r\nexport interface IAvailableTransport {\r\n    transport: keyof typeof HttpTransportType;\r\n    transferFormats: (keyof typeof TransferFormat)[];\r\n}\r\n\r\nconst MAX_REDIRECTS = 100;\r\n\r\n/** @private */\r\nexport class HttpConnection implements IConnection {\r\n    private _connectionState: ConnectionState;\r\n    // connectionStarted is tracked independently from connectionState, so we can check if the\r\n    // connection ever did successfully transition from connecting to connected before disconnecting.\r\n    private _connectionStarted: boolean;\r\n    private readonly _httpClient: AccessTokenHttpClient;\r\n    private readonly _logger: ILogger;\r\n    private readonly _options: IHttpConnectionOptions;\r\n    // Needs to not start with _ to be available for tests\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    private transport?: ITransport;\r\n    private _startInternalPromise?: Promise<void>;\r\n    private _stopPromise?: Promise<void>;\r\n    private _stopPromiseResolver: (value?: PromiseLike<void>) => void = () => {};\r\n    private _stopError?: Error;\r\n    private _accessTokenFactory?: () => string | Promise<string>;\r\n    private _sendQueue?: TransportSendQueue;\r\n\r\n    public readonly features: any = {};\r\n    public baseUrl: string;\r\n    public connectionId?: string;\r\n    public onreceive: ((data: string | ArrayBuffer) => void) | null;\r\n    public onclose: ((e?: Error) => void) | null;\r\n\r\n    private readonly _negotiateVersion: number = 1;\r\n\r\n    constructor(url: string, options: IHttpConnectionOptions = {}) {\r\n        Arg.isRequired(url, \"url\");\r\n\r\n        this._logger = createLogger(options.logger);\r\n        this.baseUrl = this._resolveUrl(url);\r\n\r\n        options = options || {};\r\n        options.logMessageContent = options.logMessageContent === undefined ? false : options.logMessageContent;\r\n        if (typeof options.withCredentials === \"boolean\" || options.withCredentials === undefined) {\r\n            options.withCredentials = options.withCredentials === undefined ? true : options.withCredentials;\r\n        } else {\r\n            throw new Error(\"withCredentials option was not a 'boolean' or 'undefined' value\");\r\n        }\r\n        options.timeout = options.timeout === undefined ? 100 * 1000 : options.timeout;\r\n\r\n        let webSocketModule: any = null;\r\n        let eventSourceModule: any = null;\r\n\r\n        if (Platform.isNode && typeof require !== \"undefined\") {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            const requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n            webSocketModule = requireFunc(\"ws\");\r\n            eventSourceModule = requireFunc(\"eventsource\");\r\n        }\r\n\r\n        if (!Platform.isNode && typeof WebSocket !== \"undefined\" && !options.WebSocket) {\r\n            options.WebSocket = WebSocket;\r\n        } else if (Platform.isNode && !options.WebSocket) {\r\n            if (webSocketModule) {\r\n                options.WebSocket = webSocketModule;\r\n            }\r\n        }\r\n\r\n        if (!Platform.isNode && typeof EventSource !== \"undefined\" && !options.EventSource) {\r\n            options.EventSource = EventSource;\r\n        } else if (Platform.isNode && !options.EventSource) {\r\n            if (typeof eventSourceModule !== \"undefined\") {\r\n                options.EventSource = eventSourceModule;\r\n            }\r\n        }\r\n\r\n        this._httpClient = new AccessTokenHttpClient(options.httpClient || new DefaultHttpClient(this._logger), options.accessTokenFactory);\r\n        this._connectionState = ConnectionState.Disconnected;\r\n        this._connectionStarted = false;\r\n        this._options = options;\r\n\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n\r\n    public start(): Promise<void>;\r\n    public start(transferFormat: TransferFormat): Promise<void>;\r\n    public async start(transferFormat?: TransferFormat): Promise<void> {\r\n        transferFormat = transferFormat || TransferFormat.Binary;\r\n\r\n        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n\r\n        this._logger.log(LogLevel.Debug, `Starting connection with transfer format '${TransferFormat[transferFormat]}'.`);\r\n\r\n        if (this._connectionState !== ConnectionState.Disconnected) {\r\n            return Promise.reject(new Error(\"Cannot start an HttpConnection that is not in the 'Disconnected' state.\"));\r\n        }\r\n\r\n        this._connectionState = ConnectionState.Connecting;\r\n\r\n        this._startInternalPromise = this._startInternal(transferFormat);\r\n        await this._startInternalPromise;\r\n\r\n        // The TypeScript compiler thinks that connectionState must be Connecting here. The TypeScript compiler is wrong.\r\n        if (this._connectionState as any === ConnectionState.Disconnecting) {\r\n            // stop() was called and transitioned the client into the Disconnecting state.\r\n            const message = \"Failed to start the HttpConnection before stop() was called.\";\r\n            this._logger.log(LogLevel.Error, message);\r\n\r\n            // We cannot await stopPromise inside startInternal since stopInternal awaits the startInternalPromise.\r\n            await this._stopPromise;\r\n\r\n            return Promise.reject(new AbortError(message));\r\n        } else if (this._connectionState as any !== ConnectionState.Connected) {\r\n            // stop() was called and transitioned the client into the Disconnecting state.\r\n            const message = \"HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!\";\r\n            this._logger.log(LogLevel.Error, message);\r\n            return Promise.reject(new AbortError(message));\r\n        }\r\n\r\n        this._connectionStarted = true;\r\n    }\r\n\r\n    public send(data: string | ArrayBuffer): Promise<void> {\r\n        if (this._connectionState !== ConnectionState.Connected) {\r\n            return Promise.reject(new Error(\"Cannot send data if the connection is not in the 'Connected' State.\"));\r\n        }\r\n\r\n        if (!this._sendQueue) {\r\n            this._sendQueue = new TransportSendQueue(this.transport!);\r\n        }\r\n\r\n        // Transport will not be null if state is connected\r\n        return this._sendQueue.send(data);\r\n    }\r\n\r\n    public async stop(error?: Error): Promise<void> {\r\n        if (this._connectionState === ConnectionState.Disconnected) {\r\n            this._logger.log(LogLevel.Debug, `Call to HttpConnection.stop(${error}) ignored because the connection is already in the disconnected state.`);\r\n            return Promise.resolve();\r\n        }\r\n\r\n        if (this._connectionState === ConnectionState.Disconnecting) {\r\n            this._logger.log(LogLevel.Debug, `Call to HttpConnection.stop(${error}) ignored because the connection is already in the disconnecting state.`);\r\n            return this._stopPromise;\r\n        }\r\n\r\n        this._connectionState = ConnectionState.Disconnecting;\r\n\r\n        this._stopPromise = new Promise((resolve) => {\r\n            // Don't complete stop() until stopConnection() completes.\r\n            this._stopPromiseResolver = resolve;\r\n        });\r\n\r\n        // stopInternal should never throw so just observe it.\r\n        await this._stopInternal(error);\r\n        await this._stopPromise;\r\n    }\r\n\r\n    private async _stopInternal(error?: Error): Promise<void> {\r\n        // Set error as soon as possible otherwise there is a race between\r\n        // the transport closing and providing an error and the error from a close message\r\n        // We would prefer the close message error.\r\n        this._stopError = error;\r\n\r\n        try {\r\n            await this._startInternalPromise;\r\n        } catch (e) {\r\n            // This exception is returned to the user as a rejected Promise from the start method.\r\n        }\r\n\r\n        // The transport's onclose will trigger stopConnection which will run our onclose event.\r\n        // The transport should always be set if currently connected. If it wasn't set, it's likely because\r\n        // stop was called during start() and start() failed.\r\n        if (this.transport) {\r\n            try {\r\n                await this.transport.stop();\r\n            } catch (e) {\r\n                this._logger.log(LogLevel.Error, `HttpConnection.transport.stop() threw error '${e}'.`);\r\n                this._stopConnection();\r\n            }\r\n\r\n            this.transport = undefined;\r\n        } else {\r\n            this._logger.log(LogLevel.Debug, \"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.\");\r\n        }\r\n    }\r\n\r\n    private async _startInternal(transferFormat: TransferFormat): Promise<void> {\r\n        // Store the original base url and the access token factory since they may change\r\n        // as part of negotiating\r\n        let url = this.baseUrl;\r\n        this._accessTokenFactory = this._options.accessTokenFactory;\r\n        this._httpClient._accessTokenFactory = this._accessTokenFactory;\r\n\r\n        try {\r\n            if (this._options.skipNegotiation) {\r\n                if (this._options.transport === HttpTransportType.WebSockets) {\r\n                    // No need to add a connection ID in this case\r\n                    this.transport = this._constructTransport(HttpTransportType.WebSockets);\r\n                    // We should just call connect directly in this case.\r\n                    // No fallback or negotiate in this case.\r\n                    await this._startTransport(url, transferFormat);\r\n                } else {\r\n                    throw new Error(\"Negotiation can only be skipped when using the WebSocket transport directly.\");\r\n                }\r\n            } else {\r\n                let negotiateResponse: INegotiateResponse | null = null;\r\n                let redirects = 0;\r\n\r\n                do {\r\n                    negotiateResponse = await this._getNegotiationResponse(url);\r\n                    // the user tries to stop the connection when it is being started\r\n                    if (this._connectionState === ConnectionState.Disconnecting || this._connectionState === ConnectionState.Disconnected) {\r\n                        throw new AbortError(\"The connection was stopped during negotiation.\");\r\n                    }\r\n\r\n                    if (negotiateResponse.error) {\r\n                        throw new Error(negotiateResponse.error);\r\n                    }\r\n\r\n                    if ((negotiateResponse as any).ProtocolVersion) {\r\n                        throw new Error(\"Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.\");\r\n                    }\r\n\r\n                    if (negotiateResponse.url) {\r\n                        url = negotiateResponse.url;\r\n                    }\r\n\r\n                    if (negotiateResponse.accessToken) {\r\n                        // Replace the current access token factory with one that uses\r\n                        // the returned access token\r\n                        const accessToken = negotiateResponse.accessToken;\r\n                        this._accessTokenFactory = () => accessToken;\r\n                        // set the factory to undefined so the AccessTokenHttpClient won't retry with the same token, since we know it won't change until a connection restart\r\n                        this._httpClient._accessToken = accessToken;\r\n                        this._httpClient._accessTokenFactory = undefined;\r\n                    }\r\n\r\n                    redirects++;\r\n                }\r\n                while (negotiateResponse.url && redirects < MAX_REDIRECTS);\r\n\r\n                if (redirects === MAX_REDIRECTS && negotiateResponse.url) {\r\n                    throw new Error(\"Negotiate redirection limit exceeded.\");\r\n                }\r\n\r\n                await this._createTransport(url, this._options.transport, negotiateResponse, transferFormat);\r\n            }\r\n\r\n            if (this.transport instanceof LongPollingTransport) {\r\n                this.features.inherentKeepAlive = true;\r\n            }\r\n\r\n            if (this._connectionState === ConnectionState.Connecting) {\r\n                // Ensure the connection transitions to the connected state prior to completing this.startInternalPromise.\r\n                // start() will handle the case when stop was called and startInternal exits still in the disconnecting state.\r\n                this._logger.log(LogLevel.Debug, \"The HttpConnection connected successfully.\");\r\n                this._connectionState = ConnectionState.Connected;\r\n            }\r\n\r\n            // stop() is waiting on us via this.startInternalPromise so keep this.transport around so it can clean up.\r\n            // This is the only case startInternal can exit in neither the connected nor disconnected state because stopConnection()\r\n            // will transition to the disconnected state. start() will wait for the transition using the stopPromise.\r\n        } catch (e) {\r\n            this._logger.log(LogLevel.Error, \"Failed to start the connection: \" + e);\r\n            this._connectionState = ConnectionState.Disconnected;\r\n            this.transport = undefined;\r\n\r\n            // if start fails, any active calls to stop assume that start will complete the stop promise\r\n            this._stopPromiseResolver();\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n\r\n    private async _getNegotiationResponse(url: string): Promise<INegotiateResponse> {\r\n        const headers: {[k: string]: string} = {};\r\n        const [name, value] = getUserAgentHeader();\r\n        headers[name] = value;\r\n\r\n        const negotiateUrl = this._resolveNegotiateUrl(url);\r\n        this._logger.log(LogLevel.Debug, `Sending negotiation request: ${negotiateUrl}.`);\r\n        try {\r\n            const response = await this._httpClient.post(negotiateUrl, {\r\n                content: \"\",\r\n                headers: { ...headers, ...this._options.headers },\r\n                timeout: this._options.timeout,\r\n                withCredentials: this._options.withCredentials,\r\n            });\r\n\r\n            if (response.statusCode !== 200) {\r\n                return Promise.reject(new Error(`Unexpected status code returned from negotiate '${response.statusCode}'`));\r\n            }\r\n\r\n            const negotiateResponse = JSON.parse(response.content as string) as INegotiateResponse;\r\n            if (!negotiateResponse.negotiateVersion || negotiateResponse.negotiateVersion < 1) {\r\n                // Negotiate version 0 doesn't use connectionToken\r\n                // So we set it equal to connectionId so all our logic can use connectionToken without being aware of the negotiate version\r\n                negotiateResponse.connectionToken = negotiateResponse.connectionId;\r\n            }\r\n\r\n            if (negotiateResponse.useStatefulReconnect && this._options._useStatefulReconnect !== true) {\r\n                return Promise.reject(new FailedToNegotiateWithServerError(\"Client didn't negotiate Stateful Reconnect but the server did.\"));\r\n            }\r\n\r\n            return negotiateResponse;\r\n        } catch (e) {\r\n            let errorMessage = \"Failed to complete negotiation with the server: \" + e;\r\n            if (e instanceof HttpError) {\r\n                if (e.statusCode === 404) {\r\n                    errorMessage = errorMessage + \" Either this is not a SignalR endpoint or there is a proxy blocking the connection.\";\r\n                }\r\n            }\r\n            this._logger.log(LogLevel.Error, errorMessage);\r\n\r\n            return Promise.reject(new FailedToNegotiateWithServerError(errorMessage));\r\n        }\r\n    }\r\n\r\n    private _createConnectUrl(url: string, connectionToken: string | null | undefined) {\r\n        if (!connectionToken) {\r\n            return url;\r\n        }\r\n\r\n        return url + (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + `id=${connectionToken}`;\r\n    }\r\n\r\n    private async _createTransport(url: string, requestedTransport: HttpTransportType | ITransport | undefined, negotiateResponse: INegotiateResponse, requestedTransferFormat: TransferFormat): Promise<void> {\r\n        let connectUrl = this._createConnectUrl(url, negotiateResponse.connectionToken);\r\n        if (this._isITransport(requestedTransport)) {\r\n            this._logger.log(LogLevel.Debug, \"Connection was provided an instance of ITransport, using that directly.\");\r\n            this.transport = requestedTransport;\r\n            await this._startTransport(connectUrl, requestedTransferFormat);\r\n\r\n            this.connectionId = negotiateResponse.connectionId;\r\n            return;\r\n        }\r\n\r\n        const transportExceptions: any[] = [];\r\n        const transports = negotiateResponse.availableTransports || [];\r\n        let negotiate: INegotiateResponse | undefined = negotiateResponse;\r\n        for (const endpoint of transports) {\r\n            const transportOrError = this._resolveTransportOrError(endpoint, requestedTransport, requestedTransferFormat,\r\n                negotiate?.useStatefulReconnect === true);\r\n            if (transportOrError instanceof Error) {\r\n                // Store the error and continue, we don't want to cause a re-negotiate in these cases\r\n                transportExceptions.push(`${endpoint.transport} failed:`);\r\n                transportExceptions.push(transportOrError);\r\n            } else if (this._isITransport(transportOrError)) {\r\n                this.transport = transportOrError;\r\n                if (!negotiate) {\r\n                    try {\r\n                        negotiate = await this._getNegotiationResponse(url);\r\n                    } catch (ex) {\r\n                        return Promise.reject(ex);\r\n                    }\r\n                    connectUrl = this._createConnectUrl(url, negotiate.connectionToken);\r\n                }\r\n                try {\r\n                    await this._startTransport(connectUrl, requestedTransferFormat);\r\n                    this.connectionId = negotiate.connectionId;\r\n                    return;\r\n                } catch (ex) {\r\n                    this._logger.log(LogLevel.Error, `Failed to start the transport '${endpoint.transport}': ${ex}`);\r\n                    negotiate = undefined;\r\n                    transportExceptions.push(new FailedToStartTransportError(`${endpoint.transport} failed: ${ex}`, HttpTransportType[endpoint.transport]));\r\n\r\n                    if (this._connectionState !== ConnectionState.Connecting) {\r\n                        const message = \"Failed to select transport before stop() was called.\";\r\n                        this._logger.log(LogLevel.Debug, message);\r\n                        return Promise.reject(new AbortError(message));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (transportExceptions.length > 0) {\r\n            return Promise.reject(new AggregateErrors(`Unable to connect to the server with any of the available transports. ${transportExceptions.join(\" \")}`, transportExceptions));\r\n        }\r\n        return Promise.reject(new Error(\"None of the transports supported by the client are supported by the server.\"));\r\n    }\r\n\r\n    private _constructTransport(transport: HttpTransportType): ITransport {\r\n        switch (transport) {\r\n            case HttpTransportType.WebSockets:\r\n                if (!this._options.WebSocket) {\r\n                    throw new Error(\"'WebSocket' is not supported in your environment.\");\r\n                }\r\n                return new WebSocketTransport(this._httpClient, this._accessTokenFactory, this._logger, this._options.logMessageContent!,\r\n                    this._options.WebSocket, this._options.headers || {});\r\n            case HttpTransportType.ServerSentEvents:\r\n                if (!this._options.EventSource) {\r\n                    throw new Error(\"'EventSource' is not supported in your environment.\");\r\n                }\r\n                return new ServerSentEventsTransport(this._httpClient, this._httpClient._accessToken, this._logger, this._options);\r\n            case HttpTransportType.LongPolling:\r\n                return new LongPollingTransport(this._httpClient, this._logger, this._options);\r\n            default:\r\n                throw new Error(`Unknown transport: ${transport}.`);\r\n        }\r\n    }\r\n\r\n    private _startTransport(url: string, transferFormat: TransferFormat): Promise<void> {\r\n        this.transport!.onreceive = this.onreceive;\r\n        if (this.features.reconnect) {\r\n            this.transport!.onclose = async (e) => {\r\n                let callStop = false;\r\n                if (this.features.reconnect) {\r\n                    try {\r\n                        this.features.disconnected();\r\n                        await this.transport!.connect(url, transferFormat);\r\n                        await this.features.resend();\r\n                    } catch {\r\n                        callStop = true;\r\n                    }\r\n                } else {\r\n                    this._stopConnection(e);\r\n                    return;\r\n                }\r\n\r\n                if (callStop) {\r\n                    this._stopConnection(e);\r\n                }\r\n            };\r\n        } else {\r\n            this.transport!.onclose = (e) => this._stopConnection(e);\r\n        }\r\n        return this.transport!.connect(url, transferFormat);\r\n    }\r\n\r\n    private _resolveTransportOrError(endpoint: IAvailableTransport, requestedTransport: HttpTransportType | undefined,\r\n        requestedTransferFormat: TransferFormat, useStatefulReconnect: boolean): ITransport | Error | unknown {\r\n        const transport = HttpTransportType[endpoint.transport];\r\n        if (transport === null || transport === undefined) {\r\n            this._logger.log(LogLevel.Debug, `Skipping transport '${endpoint.transport}' because it is not supported by this client.`);\r\n            return new Error(`Skipping transport '${endpoint.transport}' because it is not supported by this client.`);\r\n        } else {\r\n            if (transportMatches(requestedTransport, transport)) {\r\n                const transferFormats = endpoint.transferFormats.map((s) => TransferFormat[s]);\r\n                if (transferFormats.indexOf(requestedTransferFormat) >= 0) {\r\n                    if ((transport === HttpTransportType.WebSockets && !this._options.WebSocket) ||\r\n                        (transport === HttpTransportType.ServerSentEvents && !this._options.EventSource)) {\r\n                        this._logger.log(LogLevel.Debug, `Skipping transport '${HttpTransportType[transport]}' because it is not supported in your environment.'`);\r\n                        return new UnsupportedTransportError(`'${HttpTransportType[transport]}' is not supported in your environment.`, transport);\r\n                    } else {\r\n                        this._logger.log(LogLevel.Debug, `Selecting transport '${HttpTransportType[transport]}'.`);\r\n                        try {\r\n                            this.features.reconnect = transport === HttpTransportType.WebSockets ? useStatefulReconnect : undefined;\r\n                            return this._constructTransport(transport);\r\n                        } catch (ex) {\r\n                            return ex;\r\n                        }\r\n                    }\r\n                } else {\r\n                    this._logger.log(LogLevel.Debug, `Skipping transport '${HttpTransportType[transport]}' because it does not support the requested transfer format '${TransferFormat[requestedTransferFormat]}'.`);\r\n                    return new Error(`'${HttpTransportType[transport]}' does not support ${TransferFormat[requestedTransferFormat]}.`);\r\n                }\r\n            } else {\r\n                this._logger.log(LogLevel.Debug, `Skipping transport '${HttpTransportType[transport]}' because it was disabled by the client.`);\r\n                return new DisabledTransportError(`'${HttpTransportType[transport]}' is disabled by the client.`, transport);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _isITransport(transport: any): transport is ITransport {\r\n        return transport && typeof (transport) === \"object\" && \"connect\" in transport;\r\n    }\r\n\r\n    private _stopConnection(error?: Error): void {\r\n        this._logger.log(LogLevel.Debug, `HttpConnection.stopConnection(${error}) called while in state ${this._connectionState}.`);\r\n\r\n        this.transport = undefined;\r\n\r\n        // If we have a stopError, it takes precedence over the error from the transport\r\n        error = this._stopError || error;\r\n        this._stopError = undefined;\r\n\r\n        if (this._connectionState === ConnectionState.Disconnected) {\r\n            this._logger.log(LogLevel.Debug, `Call to HttpConnection.stopConnection(${error}) was ignored because the connection is already in the disconnected state.`);\r\n            return;\r\n        }\r\n\r\n        if (this._connectionState === ConnectionState.Connecting) {\r\n            this._logger.log(LogLevel.Warning, `Call to HttpConnection.stopConnection(${error}) was ignored because the connection is still in the connecting state.`);\r\n            throw new Error(`HttpConnection.stopConnection(${error}) was called while the connection is still in the connecting state.`);\r\n        }\r\n\r\n        if (this._connectionState === ConnectionState.Disconnecting) {\r\n            // A call to stop() induced this call to stopConnection and needs to be completed.\r\n            // Any stop() awaiters will be scheduled to continue after the onclose callback fires.\r\n            this._stopPromiseResolver();\r\n        }\r\n\r\n        if (error) {\r\n            this._logger.log(LogLevel.Error, `Connection disconnected with error '${error}'.`);\r\n        } else {\r\n            this._logger.log(LogLevel.Information, \"Connection disconnected.\");\r\n        }\r\n\r\n        if (this._sendQueue) {\r\n            this._sendQueue.stop().catch((e) => {\r\n                this._logger.log(LogLevel.Error, `TransportSendQueue.stop() threw error '${e}'.`);\r\n            });\r\n            this._sendQueue = undefined;\r\n        }\r\n\r\n        this.connectionId = undefined;\r\n        this._connectionState = ConnectionState.Disconnected;\r\n\r\n        if (this._connectionStarted) {\r\n            this._connectionStarted = false;\r\n            try {\r\n                if (this.onclose) {\r\n                    this.onclose(error);\r\n                }\r\n            } catch (e) {\r\n                this._logger.log(LogLevel.Error, `HttpConnection.onclose(${error}) threw error '${e}'.`);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _resolveUrl(url: string): string {\r\n        // startsWith is not supported in IE\r\n        if (url.lastIndexOf(\"https://\", 0) === 0 || url.lastIndexOf(\"http://\", 0) === 0) {\r\n            return url;\r\n        }\r\n\r\n        if (!Platform.isBrowser) {\r\n            throw new Error(`Cannot resolve '${url}'.`);\r\n        }\r\n\r\n        // Setting the url to the href propery of an anchor tag handles normalization\r\n        // for us. There are 3 main cases.\r\n        // 1. Relative path normalization e.g \"b\" -> \"http://localhost:5000/a/b\"\r\n        // 2. Absolute path normalization e.g \"/a/b\" -> \"http://localhost:5000/a/b\"\r\n        // 3. Networkpath reference normalization e.g \"//localhost:5000/a/b\" -> \"http://localhost:5000/a/b\"\r\n        const aTag = window.document.createElement(\"a\");\r\n        aTag.href = url;\r\n\r\n        this._logger.log(LogLevel.Information, `Normalizing '${url}' to '${aTag.href}'.`);\r\n        return aTag.href;\r\n    }\r\n\r\n    private _resolveNegotiateUrl(url: string): string {\r\n        const negotiateUrl = new URL(url);\r\n\r\n        if (negotiateUrl.pathname.endsWith('/')) {\r\n            negotiateUrl.pathname += \"negotiate\";\r\n        } else {\r\n            negotiateUrl.pathname += \"/negotiate\";\r\n        }\r\n        const searchParams = new URLSearchParams(negotiateUrl.searchParams);\r\n\r\n        if (!searchParams.has(\"negotiateVersion\")) {\r\n            searchParams.append(\"negotiateVersion\", this._negotiateVersion.toString());\r\n        }\r\n\r\n        if (searchParams.has(\"useStatefulReconnect\")) {\r\n            if (searchParams.get(\"useStatefulReconnect\") === \"true\") {\r\n                this._options._useStatefulReconnect = true;\r\n            }\r\n        } else if (this._options._useStatefulReconnect === true) {\r\n            searchParams.append(\"useStatefulReconnect\", \"true\");\r\n        }\r\n\r\n        negotiateUrl.search = searchParams.toString();\r\n\r\n        return negotiateUrl.toString();\r\n    }\r\n}\r\n\r\nfunction transportMatches(requestedTransport: HttpTransportType | undefined, actualTransport: HttpTransportType) {\r\n    return !requestedTransport || ((actualTransport & requestedTransport) !== 0);\r\n}\r\n\r\n/** @private */\r\nexport class TransportSendQueue {\r\n    private _buffer: any[] = [];\r\n    private _sendBufferedData: PromiseSource;\r\n    private _executing: boolean = true;\r\n    private _transportResult?: PromiseSource;\r\n    private _sendLoopPromise: Promise<void>;\r\n\r\n    constructor(private readonly _transport: ITransport) {\r\n        this._sendBufferedData = new PromiseSource();\r\n        this._transportResult = new PromiseSource();\r\n\r\n        this._sendLoopPromise = this._sendLoop();\r\n    }\r\n\r\n    public send(data: string | ArrayBuffer): Promise<void> {\r\n        this._bufferData(data);\r\n        if (!this._transportResult) {\r\n            this._transportResult = new PromiseSource();\r\n        }\r\n        return this._transportResult.promise;\r\n    }\r\n\r\n    public stop(): Promise<void> {\r\n        this._executing = false;\r\n        this._sendBufferedData.resolve();\r\n        return this._sendLoopPromise;\r\n    }\r\n\r\n    private _bufferData(data: string | ArrayBuffer): void {\r\n        if (this._buffer.length && typeof(this._buffer[0]) !== typeof(data)) {\r\n            throw new Error(`Expected data to be of type ${typeof(this._buffer)} but was of type ${typeof(data)}`);\r\n        }\r\n\r\n        this._buffer.push(data);\r\n        this._sendBufferedData.resolve();\r\n    }\r\n\r\n    private async _sendLoop(): Promise<void> {\r\n        while (true) {\r\n            await this._sendBufferedData.promise;\r\n\r\n            if (!this._executing) {\r\n                if (this._transportResult) {\r\n                    this._transportResult.reject(\"Connection stopped.\");\r\n                }\r\n\r\n                break;\r\n            }\r\n\r\n            this._sendBufferedData = new PromiseSource();\r\n\r\n            const transportResult = this._transportResult!;\r\n            this._transportResult = undefined;\r\n\r\n            const data = typeof(this._buffer[0]) === \"string\" ?\r\n                this._buffer.join(\"\") :\r\n                TransportSendQueue._concatBuffers(this._buffer);\r\n\r\n            this._buffer.length = 0;\r\n\r\n            try {\r\n                await this._transport.send(data);\r\n                transportResult.resolve();\r\n            } catch (error) {\r\n                transportResult.reject(error);\r\n            }\r\n        }\r\n    }\r\n\r\n    private static _concatBuffers(arrayBuffers: ArrayBuffer[]): ArrayBuffer {\r\n        const totalLength = arrayBuffers.map((b) => b.byteLength).reduce((a, b) => a + b);\r\n        const result = new Uint8Array(totalLength);\r\n        let offset = 0;\r\n        for (const item of arrayBuffers) {\r\n            result.set(new Uint8Array(item), offset);\r\n            offset += item.byteLength;\r\n        }\r\n\r\n        return result.buffer;\r\n    }\r\n}\r\n\r\nclass PromiseSource {\r\n    private _resolver?: () => void;\r\n    private _rejecter!: (reason?: any) => void;\r\n    public promise: Promise<void>;\r\n\r\n    constructor() {\r\n        this.promise = new Promise((resolve, reject) => [this._resolver, this._rejecter] = [resolve, reject]);\r\n    }\r\n\r\n    public resolve(): void {\r\n        this._resolver!();\r\n    }\r\n\r\n    public reject(reason?: any): void {\r\n        this._rejecter!(reason);\r\n    }\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { DefaultReconnectPolicy } from \"./DefaultReconnectPolicy\";\r\nimport { HttpConnection } from \"./HttpConnection\";\r\nimport { HubConnection } from \"./HubConnection\";\r\nimport { IHttpConnectionOptions } from \"./IHttpConnectionOptions\";\r\nimport { IHubProtocol } from \"./IHubProtocol\";\r\nimport { ILogger, LogLevel } from \"./ILogger\";\r\nimport { IRetryPolicy } from \"./IRetryPolicy\";\r\nimport { IStatefulReconnectOptions } from \"./IStatefulReconnectOptions\";\r\nimport { HttpTransportType } from \"./ITransport\";\r\nimport { JsonHubProtocol } from \"./JsonHubProtocol\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { Arg, ConsoleLogger } from \"./Utils\";\r\n\r\nconst LogLevelNameMapping: {[k: string]: LogLevel} = {\r\n    trace: LogLevel.Trace,\r\n    debug: LogLevel.Debug,\r\n    info: LogLevel.Information,\r\n    information: LogLevel.Information,\r\n    warn: LogLevel.Warning,\r\n    warning: LogLevel.Warning,\r\n    error: LogLevel.Error,\r\n    critical: LogLevel.Critical,\r\n    none: LogLevel.None,\r\n};\r\n\r\nfunction parseLogLevel(name: string): LogLevel {\r\n    // Case-insensitive matching via lower-casing\r\n    // Yes, I know case-folding is a complicated problem in Unicode, but we only support\r\n    // the ASCII strings defined in LogLevelNameMapping anyway, so it's fine -anurse.\r\n    const mapping = LogLevelNameMapping[name.toLowerCase()];\r\n    if (typeof mapping !== \"undefined\") {\r\n        return mapping;\r\n    } else {\r\n        throw new Error(`Unknown log level: ${name}`);\r\n    }\r\n}\r\n\r\n/** A builder for configuring {@link @microsoft/signalr.HubConnection} instances. */\r\nexport class HubConnectionBuilder {\r\n    private _serverTimeoutInMilliseconds?: number;\r\n    private _keepAliveIntervalInMilliseconds ?: number;\r\n\r\n    /** @internal */\r\n    public protocol?: IHubProtocol;\r\n    /** @internal */\r\n    public httpConnectionOptions?: IHttpConnectionOptions;\r\n    /** @internal */\r\n    public url?: string;\r\n    /** @internal */\r\n    public logger?: ILogger;\r\n\r\n    /** If defined, this indicates the client should automatically attempt to reconnect if the connection is lost. */\r\n    /** @internal */\r\n    public reconnectPolicy?: IRetryPolicy;\r\n\r\n    private _statefulReconnectBufferSize?: number;\r\n\r\n    /** Configures console logging for the {@link @microsoft/signalr.HubConnection}.\r\n     *\r\n     * @param {LogLevel} logLevel The minimum level of messages to log. Anything at this level, or a more severe level, will be logged.\r\n     * @returns The {@link @microsoft/signalr.HubConnectionBuilder} instance, for chaining.\r\n     */\r\n    public configureLogging(logLevel: LogLevel): HubConnectionBuilder;\r\n\r\n    /** Configures custom logging for the {@link @microsoft/signalr.HubConnection}.\r\n     *\r\n     * @param {ILogger} logger An object implementing the {@link @microsoft/signalr.ILogger} interface, which will be used to write all log messages.\r\n     * @returns The {@link @microsoft/signalr.HubConnectionBuilder} instance, for chaining.\r\n     */\r\n    public configureLogging(logger: ILogger): HubConnectionBuilder;\r\n\r\n    /** Configures custom logging for the {@link @microsoft/signalr.HubConnection}.\r\n     *\r\n     * @param {string} logLevel A string representing a LogLevel setting a minimum level of messages to log.\r\n     *    See {@link https://learn.microsoft.com/aspnet/core/signalr/configuration#configure-logging|the documentation for client logging configuration} for more details.\r\n     */\r\n    public configureLogging(logLevel: string): HubConnectionBuilder;\r\n\r\n    /** Configures custom logging for the {@link @microsoft/signalr.HubConnection}.\r\n     *\r\n     * @param {LogLevel | string | ILogger} logging A {@link @microsoft/signalr.LogLevel}, a string representing a LogLevel, or an object implementing the {@link @microsoft/signalr.ILogger} interface.\r\n     *    See {@link https://learn.microsoft.com/aspnet/core/signalr/configuration#configure-logging|the documentation for client logging configuration} for more details.\r\n     * @returns The {@link @microsoft/signalr.HubConnectionBuilder} instance, for chaining.\r\n     */\r\n    public configureLogging(logging: LogLevel | string | ILogger): HubConnectionBuilder;\r\n    public configureLogging(logging: LogLevel | string | ILogger): HubConnectionBuilder {\r\n        Arg.isRequired(logging, \"logging\");\r\n\r\n        if (isLogger(logging)) {\r\n            this.logger = logging;\r\n        } else if (typeof logging === \"string\") {\r\n            const logLevel = parseLogLevel(logging);\r\n            this.logger = new ConsoleLogger(logLevel);\r\n        } else {\r\n            this.logger = new ConsoleLogger(logging);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /** Configures the {@link @microsoft/signalr.HubConnection} to use HTTP-based transports to connect to the specified URL.\r\n     *\r\n     * The transport will be selected automatically based on what the server and client support.\r\n     *\r\n     * @param {string} url The URL the connection will use.\r\n     * @returns The {@link @microsoft/signalr.HubConnectionBuilder} instance, for chaining.\r\n     */\r\n    public withUrl(url: string): HubConnectionBuilder;\r\n\r\n    /** Configures the {@link @microsoft/signalr.HubConnection} to use the specified HTTP-based transport to connect to the specified URL.\r\n     *\r\n     * @param {string} url The URL the connection will use.\r\n     * @param {HttpTransportType} transportType The specific transport to use.\r\n     * @returns The {@link @microsoft/signalr.HubConnectionBuilder} instance, for chaining.\r\n     */\r\n    public withUrl(url: string, transportType: HttpTransportType): HubConnectionBuilder;\r\n\r\n    /** Configures the {@link @microsoft/signalr.HubConnection} to use HTTP-based transports to connect to the specified URL.\r\n     *\r\n     * @param {string} url The URL the connection will use.\r\n     * @param {IHttpConnectionOptions} options An options object used to configure the connection.\r\n     * @returns The {@link @microsoft/signalr.HubConnectionBuilder} instance, for chaining.\r\n     */\r\n    public withUrl(url: string, options: IHttpConnectionOptions): HubConnectionBuilder;\r\n    public withUrl(url: string, transportTypeOrOptions?: IHttpConnectionOptions | HttpTransportType): HubConnectionBuilder {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isNotEmpty(url, \"url\");\r\n\r\n        this.url = url;\r\n\r\n        // Flow-typing knows where it's at. Since HttpTransportType is a number and IHttpConnectionOptions is guaranteed\r\n        // to be an object, we know (as does TypeScript) this comparison is all we need to figure out which overload was called.\r\n        if (typeof transportTypeOrOptions === \"object\") {\r\n            this.httpConnectionOptions = { ...this.httpConnectionOptions, ...transportTypeOrOptions };\r\n        } else {\r\n            this.httpConnectionOptions = {\r\n                ...this.httpConnectionOptions,\r\n                transport: transportTypeOrOptions,\r\n            };\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /** Configures the {@link @microsoft/signalr.HubConnection} to use the specified Hub Protocol.\r\n     *\r\n     * @param {IHubProtocol} protocol The {@link @microsoft/signalr.IHubProtocol} implementation to use.\r\n     */\r\n    public withHubProtocol(protocol: IHubProtocol): HubConnectionBuilder {\r\n        Arg.isRequired(protocol, \"protocol\");\r\n\r\n        this.protocol = protocol;\r\n        return this;\r\n    }\r\n\r\n    /** Configures the {@link @microsoft/signalr.HubConnection} to automatically attempt to reconnect if the connection is lost.\r\n     * By default, the client will wait 0, 2, 10 and 30 seconds respectively before trying up to 4 reconnect attempts.\r\n     */\r\n    public withAutomaticReconnect(): HubConnectionBuilder;\r\n\r\n    /** Configures the {@link @microsoft/signalr.HubConnection} to automatically attempt to reconnect if the connection is lost.\r\n     *\r\n     * @param {number[]} retryDelays An array containing the delays in milliseconds before trying each reconnect attempt.\r\n     * The length of the array represents how many failed reconnect attempts it takes before the client will stop attempting to reconnect.\r\n     */\r\n    public withAutomaticReconnect(retryDelays: number[]): HubConnectionBuilder;\r\n\r\n    /** Configures the {@link @microsoft/signalr.HubConnection} to automatically attempt to reconnect if the connection is lost.\r\n     *\r\n     * @param {IRetryPolicy} reconnectPolicy An {@link @microsoft/signalR.IRetryPolicy} that controls the timing and number of reconnect attempts.\r\n     */\r\n    public withAutomaticReconnect(reconnectPolicy: IRetryPolicy): HubConnectionBuilder;\r\n    public withAutomaticReconnect(retryDelaysOrReconnectPolicy?: number[] | IRetryPolicy): HubConnectionBuilder {\r\n        if (this.reconnectPolicy) {\r\n            throw new Error(\"A reconnectPolicy has already been set.\");\r\n        }\r\n\r\n        if (!retryDelaysOrReconnectPolicy) {\r\n            this.reconnectPolicy = new DefaultReconnectPolicy();\r\n        } else if (Array.isArray(retryDelaysOrReconnectPolicy)) {\r\n            this.reconnectPolicy = new DefaultReconnectPolicy(retryDelaysOrReconnectPolicy);\r\n        } else {\r\n            this.reconnectPolicy = retryDelaysOrReconnectPolicy;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /** Configures {@link @microsoft/signalr.HubConnection.serverTimeoutInMilliseconds} for the {@link @microsoft/signalr.HubConnection}.\r\n     *\r\n     * @returns The {@link @microsoft/signalr.HubConnectionBuilder} instance, for chaining.\r\n     */\r\n    public withServerTimeout(milliseconds: number): HubConnectionBuilder {\r\n        Arg.isRequired(milliseconds, \"milliseconds\");\r\n\r\n        this._serverTimeoutInMilliseconds = milliseconds;\r\n\r\n        return this;\r\n    }\r\n\r\n    /** Configures {@link @microsoft/signalr.HubConnection.keepAliveIntervalInMilliseconds} for the {@link @microsoft/signalr.HubConnection}.\r\n     *\r\n     * @returns The {@link @microsoft/signalr.HubConnectionBuilder} instance, for chaining.\r\n     */\r\n    public withKeepAliveInterval(milliseconds: number): HubConnectionBuilder {\r\n        Arg.isRequired(milliseconds, \"milliseconds\");\r\n\r\n        this._keepAliveIntervalInMilliseconds = milliseconds;\r\n\r\n        return this;\r\n    }\r\n\r\n    /** Enables and configures options for the Stateful Reconnect feature.\r\n     *\r\n     * @returns The {@link @microsoft/signalr.HubConnectionBuilder} instance, for chaining.\r\n     */\r\n    public withStatefulReconnect(options?: IStatefulReconnectOptions): HubConnectionBuilder {\r\n        if (this.httpConnectionOptions === undefined) {\r\n            this.httpConnectionOptions = {};\r\n        }\r\n        this.httpConnectionOptions._useStatefulReconnect = true;\r\n\r\n        this._statefulReconnectBufferSize = options?.bufferSize;\r\n\r\n        return this;\r\n    }\r\n\r\n    /** Creates a {@link @microsoft/signalr.HubConnection} from the configuration options specified in this builder.\r\n     *\r\n     * @returns {HubConnection} The configured {@link @microsoft/signalr.HubConnection}.\r\n     */\r\n    public build(): HubConnection {\r\n        // If httpConnectionOptions has a logger, use it. Otherwise, override it with the one\r\n        // provided to configureLogger\r\n        const httpConnectionOptions = this.httpConnectionOptions || {};\r\n\r\n        // If it's 'null', the user **explicitly** asked for null, don't mess with it.\r\n        if (httpConnectionOptions.logger === undefined) {\r\n            // If our logger is undefined or null, that's OK, the HttpConnection constructor will handle it.\r\n            httpConnectionOptions.logger = this.logger;\r\n        }\r\n\r\n        // Now create the connection\r\n        if (!this.url) {\r\n            throw new Error(\"The 'HubConnectionBuilder.withUrl' method must be called before building the connection.\");\r\n        }\r\n        const connection = new HttpConnection(this.url, httpConnectionOptions);\r\n\r\n        return HubConnection.create(\r\n            connection,\r\n            this.logger || NullLogger.instance,\r\n            this.protocol || new JsonHubProtocol(),\r\n            this.reconnectPolicy,\r\n            this._serverTimeoutInMilliseconds,\r\n            this._keepAliveIntervalInMilliseconds,\r\n            this._statefulReconnectBufferSize);\r\n    }\r\n}\r\n\r\nfunction isLogger(logger: any): logger is ILogger {\r\n    return logger.log !== undefined;\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { AbortSignal } from \"./AbortController\";\r\nimport { MessageHeaders } from \"./IHubProtocol\";\r\n\r\n/** Represents an HTTP request. */\r\nexport interface HttpRequest {\r\n    /** The HTTP method to use for the request. */\r\n    method?: string;\r\n\r\n    /** The URL for the request. */\r\n    url?: string;\r\n\r\n    /** The body content for the request. May be a string or an ArrayBuffer (for binary data). */\r\n    content?: string | ArrayBuffer;\r\n\r\n    /** An object describing headers to apply to the request. */\r\n    headers?: MessageHeaders;\r\n\r\n    /** The XMLHttpRequestResponseType to apply to the request. */\r\n    responseType?: XMLHttpRequestResponseType;\r\n\r\n    /** An AbortSignal that can be monitored for cancellation. */\r\n    abortSignal?: AbortSignal;\r\n\r\n    /** The time to wait for the request to complete before throwing a TimeoutError. Measured in milliseconds. */\r\n    timeout?: number;\r\n\r\n    /** This controls whether credentials such as cookies are sent in cross-site requests. */\r\n    withCredentials?: boolean;\r\n}\r\n\r\n/** Represents an HTTP response. */\r\nexport class HttpResponse {\r\n    /** Constructs a new instance of {@link @microsoft/signalr.HttpResponse} with the specified status code.\r\n     *\r\n     * @param {number} statusCode The status code of the response.\r\n     */\r\n    constructor(statusCode: number);\r\n\r\n    /** Constructs a new instance of {@link @microsoft/signalr.HttpResponse} with the specified status code and message.\r\n     *\r\n     * @param {number} statusCode The status code of the response.\r\n     * @param {string} statusText The status message of the response.\r\n     */\r\n    constructor(statusCode: number, statusText: string);\r\n\r\n    /** Constructs a new instance of {@link @microsoft/signalr.HttpResponse} with the specified status code, message and string content.\r\n     *\r\n     * @param {number} statusCode The status code of the response.\r\n     * @param {string} statusText The status message of the response.\r\n     * @param {string} content The content of the response.\r\n     */\r\n    constructor(statusCode: number, statusText: string, content: string);\r\n\r\n    /** Constructs a new instance of {@link @microsoft/signalr.HttpResponse} with the specified status code, message and binary content.\r\n     *\r\n     * @param {number} statusCode The status code of the response.\r\n     * @param {string} statusText The status message of the response.\r\n     * @param {ArrayBuffer} content The content of the response.\r\n     */\r\n    constructor(statusCode: number, statusText: string, content: ArrayBuffer);\r\n\r\n    /** Constructs a new instance of {@link @microsoft/signalr.HttpResponse} with the specified status code, message and binary content.\r\n     *\r\n     * @param {number} statusCode The status code of the response.\r\n     * @param {string} statusText The status message of the response.\r\n     * @param {string | ArrayBuffer} content The content of the response.\r\n     */\r\n    constructor(statusCode: number, statusText: string, content: string | ArrayBuffer);\r\n    constructor(\r\n        public readonly statusCode: number,\r\n        public readonly statusText?: string,\r\n        public readonly content?: string | ArrayBuffer) {\r\n    }\r\n}\r\n\r\n/** Abstraction over an HTTP client.\r\n *\r\n * This class provides an abstraction over an HTTP client so that a different implementation can be provided on different platforms.\r\n */\r\nexport abstract class HttpClient {\r\n    /** Issues an HTTP GET request to the specified URL, returning a Promise that resolves with an {@link @microsoft/signalr.HttpResponse} representing the result.\r\n     *\r\n     * @param {string} url The URL for the request.\r\n     * @returns {Promise<HttpResponse>} A Promise that resolves with an {@link @microsoft/signalr.HttpResponse} describing the response, or rejects with an Error indicating a failure.\r\n     */\r\n    public get(url: string): Promise<HttpResponse>;\r\n\r\n    /** Issues an HTTP GET request to the specified URL, returning a Promise that resolves with an {@link @microsoft/signalr.HttpResponse} representing the result.\r\n     *\r\n     * @param {string} url The URL for the request.\r\n     * @param {HttpRequest} options Additional options to configure the request. The 'url' field in this object will be overridden by the url parameter.\r\n     * @returns {Promise<HttpResponse>} A Promise that resolves with an {@link @microsoft/signalr.HttpResponse} describing the response, or rejects with an Error indicating a failure.\r\n     */\r\n    public get(url: string, options: HttpRequest): Promise<HttpResponse>;\r\n    public get(url: string, options?: HttpRequest): Promise<HttpResponse> {\r\n        return this.send({\r\n            ...options,\r\n            method: \"GET\",\r\n            url,\r\n        });\r\n    }\r\n\r\n    /** Issues an HTTP POST request to the specified URL, returning a Promise that resolves with an {@link @microsoft/signalr.HttpResponse} representing the result.\r\n     *\r\n     * @param {string} url The URL for the request.\r\n     * @returns {Promise<HttpResponse>} A Promise that resolves with an {@link @microsoft/signalr.HttpResponse} describing the response, or rejects with an Error indicating a failure.\r\n     */\r\n    public post(url: string): Promise<HttpResponse>;\r\n\r\n    /** Issues an HTTP POST request to the specified URL, returning a Promise that resolves with an {@link @microsoft/signalr.HttpResponse} representing the result.\r\n     *\r\n     * @param {string} url The URL for the request.\r\n     * @param {HttpRequest} options Additional options to configure the request. The 'url' field in this object will be overridden by the url parameter.\r\n     * @returns {Promise<HttpResponse>} A Promise that resolves with an {@link @microsoft/signalr.HttpResponse} describing the response, or rejects with an Error indicating a failure.\r\n     */\r\n    public post(url: string, options: HttpRequest): Promise<HttpResponse>;\r\n    public post(url: string, options?: HttpRequest): Promise<HttpResponse> {\r\n        return this.send({\r\n            ...options,\r\n            method: \"POST\",\r\n            url,\r\n        });\r\n    }\r\n\r\n    /** Issues an HTTP DELETE request to the specified URL, returning a Promise that resolves with an {@link @microsoft/signalr.HttpResponse} representing the result.\r\n     *\r\n     * @param {string} url The URL for the request.\r\n     * @returns {Promise<HttpResponse>} A Promise that resolves with an {@link @microsoft/signalr.HttpResponse} describing the response, or rejects with an Error indicating a failure.\r\n     */\r\n    public delete(url: string): Promise<HttpResponse>;\r\n\r\n    /** Issues an HTTP DELETE request to the specified URL, returning a Promise that resolves with an {@link @microsoft/signalr.HttpResponse} representing the result.\r\n     *\r\n     * @param {string} url The URL for the request.\r\n     * @param {HttpRequest} options Additional options to configure the request. The 'url' field in this object will be overridden by the url parameter.\r\n     * @returns {Promise<HttpResponse>} A Promise that resolves with an {@link @microsoft/signalr.HttpResponse} describing the response, or rejects with an Error indicating a failure.\r\n     */\r\n    public delete(url: string, options: HttpRequest): Promise<HttpResponse>;\r\n    public delete(url: string, options?: HttpRequest): Promise<HttpResponse> {\r\n        return this.send({\r\n            ...options,\r\n            method: \"DELETE\",\r\n            url,\r\n        });\r\n    }\r\n\r\n    /** Issues an HTTP request to the specified URL, returning a {@link Promise} that resolves with an {@link @microsoft/signalr.HttpResponse} representing the result.\r\n     *\r\n     * @param {HttpRequest} request An {@link @microsoft/signalr.HttpRequest} describing the request to send.\r\n     * @returns {Promise<HttpResponse>} A Promise that resolves with an HttpResponse describing the response, or rejects with an Error indicating a failure.\r\n     */\r\n    public abstract send(request: HttpRequest): Promise<HttpResponse>;\r\n\r\n    /** Gets all cookies that apply to the specified URL.\r\n     *\r\n     * @param url The URL that the cookies are valid for.\r\n     * @returns {string} A string containing all the key-value cookie pairs for the specified URL.\r\n     */\r\n    // @ts-ignore\r\n    public getCookieString(url: string): string {\r\n        return \"\";\r\n    }\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { ILogger } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\n\r\n/** Defines the type of a Hub Message. */\r\nexport enum MessageType {\r\n    /** Indicates the message is an Invocation message and implements the {@link @microsoft/signalr.InvocationMessage} interface. */\r\n    Invocation = 1,\r\n    /** Indicates the message is a StreamItem message and implements the {@link @microsoft/signalr.StreamItemMessage} interface. */\r\n    StreamItem = 2,\r\n    /** Indicates the message is a Completion message and implements the {@link @microsoft/signalr.CompletionMessage} interface. */\r\n    Completion = 3,\r\n    /** Indicates the message is a Stream Invocation message and implements the {@link @microsoft/signalr.StreamInvocationMessage} interface. */\r\n    StreamInvocation = 4,\r\n    /** Indicates the message is a Cancel Invocation message and implements the {@link @microsoft/signalr.CancelInvocationMessage} interface. */\r\n    CancelInvocation = 5,\r\n    /** Indicates the message is a Ping message and implements the {@link @microsoft/signalr.PingMessage} interface. */\r\n    Ping = 6,\r\n    /** Indicates the message is a Close message and implements the {@link @microsoft/signalr.CloseMessage} interface. */\r\n    Close = 7,\r\n    Ack = 8,\r\n    Sequence = 9\r\n}\r\n\r\n/** Defines a dictionary of string keys and string values representing headers attached to a Hub message. */\r\nexport interface MessageHeaders {\r\n    /** Gets or sets the header with the specified key. */\r\n    [key: string]: string;\r\n}\r\n\r\n/** Union type of all known Hub messages. */\r\nexport type HubMessage =\r\n    InvocationMessage |\r\n    StreamInvocationMessage |\r\n    StreamItemMessage |\r\n    CompletionMessage |\r\n    CancelInvocationMessage |\r\n    PingMessage |\r\n    CloseMessage |\r\n    AckMessage |\r\n    SequenceMessage;\r\n\r\n/** Defines properties common to all Hub messages. */\r\nexport interface HubMessageBase {\r\n    /** A {@link @microsoft/signalr.MessageType} value indicating the type of this message. */\r\n    readonly type: MessageType;\r\n}\r\n\r\n/** Defines properties common to all Hub messages relating to a specific invocation. */\r\nexport interface HubInvocationMessage extends HubMessageBase {\r\n    /** A {@link @microsoft/signalr.MessageHeaders} dictionary containing headers attached to the message. */\r\n    readonly headers?: MessageHeaders;\r\n    /** The ID of the invocation relating to this message.\r\n     *\r\n     * This is expected to be present for {@link @microsoft/signalr.StreamInvocationMessage} and {@link @microsoft/signalr.CompletionMessage}. It may\r\n     * be 'undefined' for an {@link @microsoft/signalr.InvocationMessage} if the sender does not expect a response.\r\n     */\r\n    readonly invocationId?: string;\r\n}\r\n\r\n/** A hub message representing a non-streaming invocation. */\r\nexport interface InvocationMessage extends HubInvocationMessage {\r\n    /** @inheritDoc */\r\n    readonly type: MessageType.Invocation;\r\n    /** The target method name. */\r\n    readonly target: string;\r\n    /** The target method arguments. */\r\n    readonly arguments: any[];\r\n    /** The target methods stream IDs. */\r\n    readonly streamIds?: string[];\r\n}\r\n\r\n/** A hub message representing a streaming invocation. */\r\nexport interface StreamInvocationMessage extends HubInvocationMessage {\r\n    /** @inheritDoc */\r\n    readonly type: MessageType.StreamInvocation;\r\n\r\n    /** The invocation ID. */\r\n    readonly invocationId: string;\r\n    /** The target method name. */\r\n    readonly target: string;\r\n    /** The target method arguments. */\r\n    readonly arguments: any[];\r\n    /** The target methods stream IDs. */\r\n    readonly streamIds?: string[];\r\n}\r\n\r\n/** A hub message representing a single item produced as part of a result stream. */\r\nexport interface StreamItemMessage extends HubInvocationMessage {\r\n    /** @inheritDoc */\r\n    readonly type: MessageType.StreamItem;\r\n\r\n    /** The invocation ID. */\r\n    readonly invocationId: string;\r\n\r\n    /** The item produced by the server. */\r\n    readonly item?: any;\r\n}\r\n\r\n/** A hub message representing the result of an invocation. */\r\nexport interface CompletionMessage extends HubInvocationMessage {\r\n    /** @inheritDoc */\r\n    readonly type: MessageType.Completion;\r\n    /** The invocation ID. */\r\n    readonly invocationId: string;\r\n    /** The error produced by the invocation, if any.\r\n     *\r\n     * Either {@link @microsoft/signalr.CompletionMessage.error} or {@link @microsoft/signalr.CompletionMessage.result} must be defined, but not both.\r\n     */\r\n    readonly error?: string;\r\n    /** The result produced by the invocation, if any.\r\n     *\r\n     * Either {@link @microsoft/signalr.CompletionMessage.error} or {@link @microsoft/signalr.CompletionMessage.result} must be defined, but not both.\r\n     */\r\n    readonly result?: any;\r\n}\r\n\r\n/** A hub message indicating that the sender is still active. */\r\nexport interface PingMessage extends HubMessageBase {\r\n    /** @inheritDoc */\r\n    readonly type: MessageType.Ping;\r\n}\r\n\r\n/** A hub message indicating that the sender is closing the connection.\r\n *\r\n * If {@link @microsoft/signalr.CloseMessage.error} is defined, the sender is closing the connection due to an error.\r\n */\r\nexport interface CloseMessage extends HubMessageBase {\r\n    /** @inheritDoc */\r\n    readonly type: MessageType.Close;\r\n    /** The error that triggered the close, if any.\r\n     *\r\n     * If this property is undefined, the connection was closed normally and without error.\r\n     */\r\n    readonly error?: string;\r\n\r\n    /** If true, clients with automatic reconnects enabled should attempt to reconnect after receiving the CloseMessage. Otherwise, they should not. */\r\n    readonly allowReconnect?: boolean;\r\n}\r\n\r\n/** A hub message sent to request that a streaming invocation be canceled. */\r\nexport interface CancelInvocationMessage extends HubInvocationMessage {\r\n    /** @inheritDoc */\r\n    readonly type: MessageType.CancelInvocation;\r\n    /** The invocation ID. */\r\n    readonly invocationId: string;\r\n}\r\n\r\nexport interface AckMessage extends HubMessageBase\r\n{\r\n    readonly type: MessageType.Ack;\r\n\r\n    readonly sequenceId: number;\r\n}\r\n\r\nexport interface SequenceMessage extends HubMessageBase\r\n{\r\n    readonly type: MessageType.Sequence;\r\n\r\n    readonly sequenceId: number;\r\n}\r\n\r\n/** A protocol abstraction for communicating with SignalR Hubs.  */\r\nexport interface IHubProtocol {\r\n    /** The name of the protocol. This is used by SignalR to resolve the protocol between the client and server. */\r\n    readonly name: string;\r\n    /** The version of the protocol. */\r\n    readonly version: number;\r\n    /** The {@link @microsoft/signalr.TransferFormat} of the protocol. */\r\n    readonly transferFormat: TransferFormat;\r\n\r\n    /** Creates an array of {@link @microsoft/signalr.HubMessage} objects from the specified serialized representation.\r\n     *\r\n     * If {@link @microsoft/signalr.IHubProtocol.transferFormat} is 'Text', the `input` parameter must be a string, otherwise it must be an ArrayBuffer.\r\n     *\r\n     * @param {string | ArrayBuffer} input A string or ArrayBuffer containing the serialized representation.\r\n     * @param {ILogger} logger A logger that will be used to log messages that occur during parsing.\r\n     */\r\n    parseMessages(input: string | ArrayBuffer, logger: ILogger): HubMessage[];\r\n\r\n    /** Writes the specified {@link @microsoft/signalr.HubMessage} to a string or ArrayBuffer and returns it.\r\n     *\r\n     * If {@link @microsoft/signalr.IHubProtocol.transferFormat} is 'Text', the result of this method will be a string, otherwise it will be an ArrayBuffer.\r\n     *\r\n     * @param {HubMessage} message The message to write.\r\n     * @returns {string | ArrayBuffer} A string or ArrayBuffer containing the serialized representation of the message.\r\n     */\r\n    writeMessage(message: HubMessage): string | ArrayBuffer;\r\n}","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { HttpTransportType } from \"./ITransport\";\r\n\r\n/** Error thrown when an HTTP request fails. */\r\nexport class HttpError extends Error {\r\n    // @ts-ignore: Intentionally unused.\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    private __proto__: Error;\r\n\r\n    /** The HTTP status code represented by this error. */\r\n    public statusCode: number;\r\n\r\n    /** Constructs a new instance of {@link @microsoft/signalr.HttpError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     * @param {number} statusCode The HTTP status code represented by this error.\r\n     */\r\n    constructor(errorMessage: string, statusCode: number) {\r\n        const trueProto = new.target.prototype;\r\n        super(`${errorMessage}: Status code '${statusCode}'`);\r\n        this.statusCode = statusCode;\r\n\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n\r\n/** Error thrown when a timeout elapses. */\r\nexport class TimeoutError extends Error {\r\n    // @ts-ignore: Intentionally unused.\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    private __proto__: Error;\r\n\r\n    /** Constructs a new instance of {@link @microsoft/signalr.TimeoutError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     */\r\n    constructor(errorMessage: string = \"A timeout occurred.\") {\r\n        const trueProto = new.target.prototype;\r\n        super(errorMessage);\r\n\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n\r\n/** Error thrown when an action is aborted. */\r\nexport class AbortError extends Error {\r\n    // @ts-ignore: Intentionally unused.\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    private __proto__: Error;\r\n\r\n    /** Constructs a new instance of {@link AbortError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     */\r\n    constructor(errorMessage: string = \"An abort occurred.\") {\r\n        const trueProto = new.target.prototype;\r\n        super(errorMessage);\r\n\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n\r\n/** Error thrown when the selected transport is unsupported by the browser. */\r\n/** @private */\r\nexport class UnsupportedTransportError extends Error {\r\n    // @ts-ignore: Intentionally unused.\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    private __proto__: Error;\r\n\r\n    /** The {@link @microsoft/signalr.HttpTransportType} this error occurred on. */\r\n    public transport: HttpTransportType;\r\n\r\n    /** The type name of this error. */\r\n    public errorType: string;\r\n\r\n    /** Constructs a new instance of {@link @microsoft/signalr.UnsupportedTransportError}.\r\n     *\r\n     * @param {string} message A descriptive error message.\r\n     * @param {HttpTransportType} transport The {@link @microsoft/signalr.HttpTransportType} this error occurred on.\r\n     */\r\n    constructor(message: string, transport: HttpTransportType) {\r\n        const trueProto = new.target.prototype;\r\n        super(message);\r\n        this.transport = transport;\r\n        this.errorType = 'UnsupportedTransportError';\r\n\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n\r\n/** Error thrown when the selected transport is disabled by the browser. */\r\n/** @private */\r\nexport class DisabledTransportError extends Error {\r\n    // @ts-ignore: Intentionally unused.\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    private __proto__: Error;\r\n\r\n    /** The {@link @microsoft/signalr.HttpTransportType} this error occurred on. */\r\n    public transport: HttpTransportType;\r\n\r\n    /** The type name of this error. */\r\n    public errorType: string;\r\n\r\n    /** Constructs a new instance of {@link @microsoft/signalr.DisabledTransportError}.\r\n     *\r\n     * @param {string} message A descriptive error message.\r\n     * @param {HttpTransportType} transport The {@link @microsoft/signalr.HttpTransportType} this error occurred on.\r\n     */\r\n    constructor(message: string, transport: HttpTransportType) {\r\n        const trueProto = new.target.prototype;\r\n        super(message);\r\n        this.transport = transport;\r\n        this.errorType = 'DisabledTransportError';\r\n\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n\r\n/** Error thrown when the selected transport cannot be started. */\r\n/** @private */\r\nexport class FailedToStartTransportError extends Error {\r\n    // @ts-ignore: Intentionally unused.\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    private __proto__: Error;\r\n\r\n    /** The {@link @microsoft/signalr.HttpTransportType} this error occurred on. */\r\n    public transport: HttpTransportType;\r\n\r\n    /** The type name of this error. */\r\n    public errorType: string;\r\n\r\n    /** Constructs a new instance of {@link @microsoft/signalr.FailedToStartTransportError}.\r\n     *\r\n     * @param {string} message A descriptive error message.\r\n     * @param {HttpTransportType} transport The {@link @microsoft/signalr.HttpTransportType} this error occurred on.\r\n     */\r\n    constructor(message: string, transport: HttpTransportType) {\r\n        const trueProto = new.target.prototype;\r\n        super(message);\r\n        this.transport = transport;\r\n        this.errorType = 'FailedToStartTransportError';\r\n\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n\r\n/** Error thrown when the negotiation with the server failed to complete. */\r\n/** @private */\r\nexport class FailedToNegotiateWithServerError extends Error {\r\n    // @ts-ignore: Intentionally unused.\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    private __proto__: Error;\r\n\r\n    /** The type name of this error. */\r\n    public errorType: string;\r\n\r\n    /** Constructs a new instance of {@link @microsoft/signalr.FailedToNegotiateWithServerError}.\r\n     *\r\n     * @param {string} message A descriptive error message.\r\n     */\r\n    constructor(message: string) {\r\n        const trueProto = new.target.prototype;\r\n        super(message);\r\n        this.errorType = 'FailedToNegotiateWithServerError';\r\n\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n\r\n/** Error thrown when multiple errors have occurred. */\r\n/** @private */\r\nexport class AggregateErrors extends Error {\r\n    // @ts-ignore: Intentionally unused.\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    private __proto__: Error;\r\n\r\n    /** The collection of errors this error is aggregating. */\r\n    public innerErrors: Error[];\r\n\r\n    /** Constructs a new instance of {@link @microsoft/signalr.AggregateErrors}.\r\n     *\r\n     * @param {string} message A descriptive error message.\r\n     * @param {Error[]} innerErrors The collection of errors this error is aggregating.\r\n     */\r\n    constructor(message: string, innerErrors: Error[]) {\r\n        const trueProto = new.target.prototype;\r\n        super(message);\r\n\r\n        this.innerErrors = innerErrors;\r\n\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { IRetryPolicy, RetryContext } from \"./IRetryPolicy\";\r\n\r\n// 0, 2, 10, 30 second delays before reconnect attempts.\r\nconst DEFAULT_RETRY_DELAYS_IN_MILLISECONDS = [0, 2000, 10000, 30000, null];\r\n\r\n/** @private */\r\nexport class DefaultReconnectPolicy implements IRetryPolicy {\r\n    private readonly _retryDelays: (number | null)[];\r\n\r\n    constructor(retryDelays?: number[]) {\r\n        this._retryDelays = retryDelays !== undefined ? [...retryDelays, null] : DEFAULT_RETRY_DELAYS_IN_MILLISECONDS;\r\n    }\r\n\r\n    public nextRetryDelayInMilliseconds(retryContext: RetryContext): number | null {\r\n        return this._retryDelays[retryContext.previousRetryCount];\r\n    }\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\n// This will be treated as a bit flag in the future, so we keep it using power-of-two values.\r\n/** Specifies a specific HTTP transport type. */\r\nexport enum HttpTransportType {\r\n    /** Specifies no transport preference. */\r\n    None = 0,\r\n    /** Specifies the WebSockets transport. */\r\n    WebSockets = 1,\r\n    /** Specifies the Server-Sent Events transport. */\r\n    ServerSentEvents = 2,\r\n    /** Specifies the Long Polling transport. */\r\n    LongPolling = 4,\r\n}\r\n\r\n/** Specifies the transfer format for a connection. */\r\nexport enum TransferFormat {\r\n    /** Specifies that only text data will be transmitted over the connection. */\r\n    Text = 1,\r\n    /** Specifies that binary data will be transmitted over the connection. */\r\n    Binary = 2,\r\n}\r\n\r\n/** An abstraction over the behavior of transports. This is designed to support the framework and not intended for use by applications. */\r\nexport interface ITransport {\r\n    connect(url: string, transferFormat: TransferFormat): Promise<void>;\r\n    send(data: any): Promise<void>;\r\n    stop(): Promise<void>;\r\n    onreceive: ((data: string | ArrayBuffer) => void) | null;\r\n    onclose: ((error?: Error) => void) | null;\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\n// Rough polyfill of https://developer.mozilla.org/en-US/docs/Web/API/AbortController\r\n// We don't actually ever use the API being polyfilled, we always use the polyfill because\r\n// it's a very new API right now.\r\n\r\n// Not exported from index.\r\n/** @private */\r\nexport class AbortController implements AbortSignal {\r\n    private _isAborted: boolean = false;\r\n    public onabort: (() => void) | null = null;\r\n\r\n    public abort(): void {\r\n        if (!this._isAborted) {\r\n            this._isAborted = true;\r\n            if (this.onabort) {\r\n                this.onabort();\r\n            }\r\n        }\r\n    }\r\n\r\n    get signal(): AbortSignal {\r\n        return this;\r\n    }\r\n\r\n    get aborted(): boolean {\r\n        return this._isAborted;\r\n    }\r\n}\r\n\r\n/** Represents a signal that can be monitored to determine if a request has been aborted. */\r\nexport interface AbortSignal {\r\n    /** Indicates if the request has been aborted. */\r\n    aborted: boolean;\r\n    /** Set this to a handler that will be invoked when the request is aborted. */\r\n    onabort: (() => void) | null;\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { ILogger, LogLevel } from \"./ILogger\";\r\n\r\n/** A logger that does nothing when log messages are sent to it. */\r\nexport class NullLogger implements ILogger {\r\n    /** The singleton instance of the {@link @microsoft/signalr.NullLogger}. */\r\n    public static instance: ILogger = new NullLogger();\r\n\r\n    private constructor() {}\r\n\r\n    /** @inheritDoc */\r\n    // eslint-disable-next-line\r\n    public log(_logLevel: LogLevel, _message: string): void {\r\n    }\r\n}\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\n// These values are designed to match the ASP.NET Log Levels since that's the pattern we're emulating here.\r\n/** Indicates the severity of a log message.\r\n *\r\n * Log Levels are ordered in increasing severity. So `Debug` is more severe than `Trace`, etc.\r\n */\r\nexport enum LogLevel {\r\n    /** Log level for very low severity diagnostic messages. */\r\n    Trace = 0,\r\n    /** Log level for low severity diagnostic messages. */\r\n    Debug = 1,\r\n    /** Log level for informational diagnostic messages. */\r\n    Information = 2,\r\n    /** Log level for diagnostic messages that indicate a non-fatal problem. */\r\n    Warning = 3,\r\n    /** Log level for diagnostic messages that indicate a failure in the current operation. */\r\n    Error = 4,\r\n    /** Log level for diagnostic messages that indicate a failure that will terminate the entire application. */\r\n    Critical = 5,\r\n    /** The highest possible log level. Used when configuring logging to indicate that no log messages should be emitted. */\r\n    None = 6,\r\n}\r\n\r\n/** An abstraction that provides a sink for diagnostic messages. */\r\nexport interface ILogger {\r\n    /** Called by the framework to emit a diagnostic message.\r\n     *\r\n     * @param {LogLevel} logLevel The severity level of the message.\r\n     * @param {string} message The message.\r\n     */\r\n    log(logLevel: LogLevel, message: string): void;\r\n}\r\n","/**\r\n * Слой данных -- типы и моки.\r\n * Сейчас захардкожено, при подключении БД замени getAgents(), getEvents() и т.д.\r\n * Компоненты трогать не нужно -- зависят только от типов.\r\n */\r\n\r\n// ===== ТИПЫ =====\r\n\r\nexport type Mood = \"happy\" | \"neutral\" | \"sad\" | \"angry\" | \"excited\" | \"anxious\"\r\n\r\nexport interface Agent {\r\n  id: string\r\n  name: string\r\n  avatar: string        // аватар буква/эмо\r\n  mood: Mood\r\n  traits: string[]      // черты\r\n  description: string\r\n  currentPlan: string\r\n  memories: string[]    // воспоминания\r\n}\r\n\r\nexport interface AgentEvent {\n  id: string\n  agentId: string\n  agentName: string\n  type: \"chat\" | \"action\" | \"emotion\" | \"system\"\n  text: string\n  timestamp: string     // ISO\n}\n\nexport type AgentMessageRole = \"user\" | \"assistant\" | \"system\"\n\nexport interface AgentConversationMessage {\n  id: string\n  agentId: string\n  agentName: string\n  role: AgentMessageRole\n  content: string\n  timestamp: string\n  correlationId?: string\n}\n\nexport interface CommandAck {\n  agentId: string\n  userId: string\n  correlationId: string\n  status: string\n  acceptedAt: string\n}\n\nexport interface BroadcastCommandItem {\n  agentId: string\n  status: string\n  correlationId?: string\n  reason?: string\n}\n\nexport interface BroadcastCommandAck {\n  userId: string\n  acceptedAt: string\n  acceptedCount: number\n  rejectedCount: number\n  items: BroadcastCommandItem[]\n}\n\nexport interface Relationship {\n  from: string          // agent id\r\n  to: string            // agent id\r\n  sentiment: number     // -1 (враг) до 1 (друг)\r\n  label?: string        // \"друзья\", \"враги\", \"знакомые\"\r\n}\r\n\r\nexport interface WorldStats {\r\n  totalEvents: number\r\n  totalConversations: number\r\n  avgMood: number       // 0-1\r\n  mostActiveAgent: string\r\n  topRelationship: { from: string; to: string; sentiment: number }\r\n  eventsByType: { type: string; count: number }[]\r\n  moodDistribution: { mood: Mood; count: number }[]\r\n}\r\n\r\n// ===== НАСТРОЕНИЯ =====\r\n\r\nexport const MOOD_CONFIG: Record<Mood, { color: string; label: string }> = {\r\n  happy:   { color: \"#4ade80\", label: \"Счастлив\" },\r\n  neutral: { color: \"#a0a0b0\", label: \"Нейтрален\" },\r\n  sad:     { color: \"#60a5fa\", label: \"Грустит\" },\r\n  angry:   { color: \"#f87171\", label: \"Злится\" },\r\n  excited: { color: \"#e5c34b\", label: \"Воодушевлён\" },\r\n  anxious: { color: \"#c084fc\", label: \"Тревожится\" },\r\n}\r\n\r\n// ===== МОКСИ =====\r\n\r\nexport const MOCK_AGENTS: Agent[] = [\r\n  {\r\n    id: \"agent-1\",\r\n    name: \"Алексей\",\r\n    avatar: \"А\",\r\n    mood: \"happy\",\r\n    traits: [\"общительный\", \"оптимист\", \"любопытный\"],\r\n    description: \"Молодой исследователь, который всегда ищет новые знакомства. Верит в лучшее в людях.\",\r\n    currentPlan: \"Поговорить с Мариной о вчерашнем событии\",\r\n    memories: [\r\n      \"Встретил Марину на площади\",\r\n      \"Поспорил с Виктором о политике\",\r\n      \"Нашёл старую книгу в библиотеке\",\r\n    ],\r\n  },\r\n  {\r\n    id: \"agent-2\",\r\n    name: \"Марина\",\r\n    avatar: \"М\",\r\n    mood: \"neutral\",\r\n    traits: [\"задумчивая\", \"художница\", \"интроверт\"],\r\n    description: \"Талантливая художница, предпочитает одиночество. Наблюдает за миром через призму искусства.\",\r\n    currentPlan: \"Закончить картину заката\",\r\n    memories: [\r\n      \"Разговор с Алексеем был приятным\",\r\n      \"Виктор показался грубым\",\r\n      \"Увидела красивый закат\",\r\n    ],\r\n  },\r\n  {\r\n    id: \"agent-3\",\r\n    name: \"Виктор\",\r\n    avatar: \"В\",\r\n    mood: \"angry\",\r\n    traits: [\"прямолинейный\", \"амбициозный\", \"упрямый\"],\r\n    description: \"Бывший военный, привык командовать. Не терпит слабости, но глубоко внутри одинок.\",\r\n    currentPlan: \"Доказать свою правоту Алексею\",\r\n    memories: [\r\n      \"Спор с Алексеем закончился ничем\",\r\n      \"Марина отвернулась при встрече\",\r\n      \"Вспомнил службу в армии\",\r\n    ],\r\n  },\r\n  {\r\n    id: \"agent-4\",\r\n    name: \"Елена\",\r\n    avatar: \"Е\",\r\n    mood: \"excited\",\r\n    traits: [\"энергичная\", \"лидер\", \"эмпат\"],\r\n    description: \"Врач по профессии и миротворец по натуре. Старается помирить всех вокруг.\",\r\n    currentPlan: \"Организовать общий ужин для всех\",\r\n    memories: [\r\n      \"Помогла незнакомцу на улице\",\r\n      \"Заметила напряжение между Виктором и Алексеем\",\r\n      \"Получила письмо от старого друга\",\r\n    ],\r\n  },\r\n  {\r\n    id: \"agent-5\",\r\n    name: \"Дмитрий\",\r\n    avatar: \"Д\",\r\n    mood: \"sad\",\r\n    traits: [\"замкнутый\", \"умный\", \"меланхоличный\"],\r\n    description: \"Бывший учёный, потерял лабораторию в пожаре. Живёт на окраине и избегает людей.\",\r\n    currentPlan: \"Попытаться восстановить записи из сгоревшей лаборатории\",\r\n    memories: [\r\n      \"Пожар уничтожил десять лет работы\",\r\n      \"Марина однажды принесла еду\",\r\n      \"Не доверяет Виктору\",\r\n    ],\r\n  },\r\n  {\r\n    id: \"agent-6\",\r\n    name: \"Ольга\",\r\n    avatar: \"О\",\r\n    mood: \"anxious\",\r\n    traits: [\"осторожная\", \"наблюдательная\", \"скрытная\"],\r\n    description: \"Торговка на рынке. Знает все сплетни города, но сама держит много секретов.\",\r\n    currentPlan: \"Разузнать, что случилось на площади вчера ночью\",\r\n    memories: [\r\n      \"Видела Виктора в переулке поздно ночью\",\r\n      \"Елена покупает у неё травы каждую неделю\",\r\n      \"Кто-то следит за ней -- уверена\",\r\n    ],\r\n  },\r\n  {\r\n    id: \"agent-7\",\r\n    name: \"Игорь\",\r\n    avatar: \"И\",\r\n    mood: \"neutral\",\r\n    traits: [\"спокойный\", \"справедливый\", \"старомодный\"],\r\n    description: \"Пожилой сторож библиотеки. Видел многое, говорит мало, но когда говорит -- все слушают.\",\r\n    currentPlan: \"Присматривать за библиотекой и читать хроники\",\r\n    memories: [\r\n      \"Алексей часто приходит читать\",\r\n      \"Помнит, каким был город до войны\",\r\n      \"Не одобряет поведение Виктора\",\r\n    ],\r\n  },\r\n  {\r\n    id: \"agent-8\",\r\n    name: \"Настя\",\r\n    avatar: \"Н\",\r\n    mood: \"happy\",\r\n    traits: [\"жизнерадостная\", \"наивная\", \"творческая\"],\r\n    description: \"Студентка-музыкант, недавно приехала в город. Ещё не знает местных интриг.\",\r\n    currentPlan: \"Найти место для репетиции и познакомиться с людьми\",\r\n    memories: [\r\n      \"Город показался красивым, но странным\",\r\n      \"Марина улыбнулась ей на улице\",\r\n      \"Услышала громкий спор на площади\",\r\n    ],\r\n  },\r\n]\r\n\r\nexport const MOCK_EVENTS: AgentEvent[] = [\r\n  {\r\n    id: \"evt-1\",\r\n    agentId: \"agent-1\",\r\n    agentName: \"Алексей\",\r\n    type: \"chat\",\r\n    text: \"Привет, Марина! Как твоя новая картина?\",\r\n    timestamp: new Date(Date.now() - 300000).toISOString(),\r\n  },\r\n  {\r\n    id: \"evt-2\",\r\n    agentId: \"agent-2\",\r\n    agentName: \"Марина\",\r\n    type: \"emotion\",\r\n    text: \"Почувствовала прилив вдохновения от заката\",\r\n    timestamp: new Date(Date.now() - 240000).toISOString(),\r\n  },\r\n  {\r\n    id: \"evt-3\",\r\n    agentId: \"agent-3\",\r\n    agentName: \"Виктор\",\r\n    type: \"action\",\r\n    text: \"Отправился на площадь, чтобы найти Алексея\",\r\n    timestamp: new Date(Date.now() - 180000).toISOString(),\r\n  },\r\n  {\r\n    id: \"evt-4\",\r\n    agentId: \"agent-4\",\r\n    agentName: \"Елена\",\r\n    type: \"chat\",\r\n    text: \"Виктор, давай поговорим спокойно. Я уверена, вы с Алексеем найдёте общий язык.\",\r\n    timestamp: new Date(Date.now() - 120000).toISOString(),\r\n  },\r\n  {\r\n    id: \"evt-5\",\r\n    agentId: \"agent-3\",\r\n    agentName: \"Виктор\",\r\n    type: \"emotion\",\r\n    text: \"Раздражён: Елена снова лезет не в своё дело\",\r\n    timestamp: new Date(Date.now() - 60000).toISOString(),\r\n  },\r\n  {\r\n    id: \"evt-6\",\r\n    agentId: \"agent-1\",\r\n    agentName: \"Алексей\",\r\n    type: \"action\",\r\n    text: \"Зашёл в библиотеку и нашёл интересную книгу об истории города\",\r\n    timestamp: new Date(Date.now() - 30000).toISOString(),\r\n  },\r\n  {\r\n    id: \"evt-7\",\r\n    agentId: \"agent-2\",\r\n    agentName: \"Марина\",\r\n    type: \"action\",\r\n    text: \"Поставила мольберт у реки и начала рисовать\",\r\n    timestamp: new Date(Date.now() - 15000).toISOString(),\r\n  },\r\n  {\r\n    id: \"evt-8\",\r\n    agentId: \"agent-4\",\r\n    agentName: \"Елена\",\r\n    type: \"system\",\r\n    text: \"Решила организовать общий ужин сегодня вечером\",\r\n    timestamp: new Date(Date.now() - 5000).toISOString(),\r\n  },\r\n  {\r\n    id: \"evt-9\",\r\n    agentId: \"agent-5\",\r\n    agentName: \"Дмитрий\",\r\n    type: \"action\",\r\n    text: \"Нашёл обгоревший дневник среди руин лаборатории\",\r\n    timestamp: new Date(Date.now() - 280000).toISOString(),\r\n  },\r\n  {\r\n    id: \"evt-10\",\r\n    agentId: \"agent-6\",\r\n    agentName: \"Ольга\",\r\n    type: \"emotion\",\r\n    text: \"Тревога нарастает -- кто-то определённо следит\",\r\n    timestamp: new Date(Date.now() - 200000).toISOString(),\r\n  },\r\n  {\r\n    id: \"evt-11\",\r\n    agentId: \"agent-7\",\r\n    agentName: \"Игорь\",\r\n    type: \"action\",\r\n    text: \"Открыл старый архив в подвале библиотеки\",\r\n    timestamp: new Date(Date.now() - 150000).toISOString(),\r\n  },\r\n  {\r\n    id: \"evt-12\",\r\n    agentId: \"agent-8\",\r\n    agentName: \"Настя\",\r\n    type: \"chat\",\r\n    text: \"Простите, вы не подскажете, где тут можно порепетировать?\",\r\n    timestamp: new Date(Date.now() - 90000).toISOString(),\r\n  },\r\n]\r\n\r\nexport const MOCK_RELATIONSHIPS: Relationship[] = [\r\n  // Алексей\r\n  { from: \"agent-1\", to: \"agent-2\", sentiment: 0.7, label: \"дружба\" },\r\n  { from: \"agent-1\", to: \"agent-3\", sentiment: -0.4, label: \"конфликт\" },\r\n  { from: \"agent-1\", to: \"agent-7\", sentiment: 0.4, label: \"уважение\" },\r\n  // Марина\r\n  { from: \"agent-2\", to: \"agent-5\", sentiment: 0.3, label: \"сочувствие\" },\r\n  { from: \"agent-2\", to: \"agent-8\", sentiment: 0.5, label: \"симпатия\" },\r\n  // Виктор\r\n  { from: \"agent-3\", to: \"agent-4\", sentiment: -0.2, label: \"раздражение\" },\r\n  { from: \"agent-3\", to: \"agent-7\", sentiment: -0.3, label: \"неприязнь\" },\r\n  // Елена\r\n  { from: \"agent-4\", to: \"agent-6\", sentiment: 0.4, label: \"торговля\" },\r\n  { from: \"agent-4\", to: \"agent-1\", sentiment: 0.5, label: \"знакомые\" },\r\n  // Ольга\r\n  { from: \"agent-6\", to: \"agent-3\", sentiment: -0.1, label: \"подозрение\" },\r\n  // Игорь -- одиночка, мало связей\r\n  // Настя -- новенькая, только одна связь\r\n  { from: \"agent-8\", to: \"agent-1\", sentiment: 0.2, label: \"знакомые\" },\r\n  // Дмитрий -- затворник, почти нет связей\r\n  { from: \"agent-5\", to: \"agent-7\", sentiment: 0.2, label: \"соседи\" },\r\n]\r\n\r\nexport const MOCK_STATS: WorldStats = {\n  totalEvents: 847,\r\n  totalConversations: 234,\r\n  avgMood: 0.62,\r\n  mostActiveAgent: \"Алексей\",\r\n  topRelationship: { from: \"agent-1\", to: \"agent-2\", sentiment: 0.7 },\r\n  eventsByType: [\r\n    { type: \"chat\", count: 312 },\r\n    { type: \"action\", count: 289 },\r\n    { type: \"emotion\", count: 178 },\r\n    { type: \"system\", count: 68 },\r\n  ],\r\n  moodDistribution: [\r\n    { mood: \"happy\", count: 2 },\r\n    { mood: \"neutral\", count: 2 },\r\n    { mood: \"sad\", count: 1 },\r\n    { mood: \"angry\", count: 1 },\r\n    { mood: \"excited\", count: 1 },\r\n    { mood: \"anxious\", count: 1 },\r\n  ],\n}\n\nconst MOCK_AGENT_MESSAGES = new Map<string, AgentConversationMessage[]>(\n  MOCK_AGENTS.map((agent) => [agent.id, []])\n)\n\nfor (const event of MOCK_EVENTS) {\n  const existing = MOCK_AGENT_MESSAGES.get(event.agentId) ?? []\n  existing.push({\n    id: `mock-msg-${event.id}`,\n    agentId: event.agentId,\n    agentName: event.agentName,\n    role: \"assistant\",\n    content: event.text,\n    timestamp: event.timestamp,\n  })\n  MOCK_AGENT_MESSAGES.set(event.agentId, existing)\n}\n\r\n// ===== ДОСТУП К ДАННЫМ (замени на реальные запросы) =====\r\n\r\ninterface BackendPersonalityTraits {\n  openness?: number\n  conscientiousness?: number\n  extraversion?: number\n  agreeableness?: number\n  neuroticism?: number\n}\n\ninterface BackendAgentDto {\n  agentId: string\n  userId: string\n  name: string\n  model: string\n  status: string\n  state: string\n  energy: number\n  personalityTraits?: BackendPersonalityTraits\n  description?: string\n  emotion?: string\n  traits?: string[]\n  memories?: string[]\n  currentPlan?: string\n}\n\ninterface BackendEventDto {\n  id: string\n  userId?: string\n  type: string\n  payload: unknown\n  createdAt: string\n}\n\ninterface BackendRelationshipDto {\n  from: string\n  to: string\n  sentiment: number\n  label?: string\n}\n\ninterface BackendWorldStatsDto {\n  totalEvents: number\n  totalConversations: number\n  avgMood: number\n  mostActiveAgent: string\n  topRelationship: { from: string; to: string; sentiment: number }\n  eventsByType: { type: string; count: number }[]\n  moodDistribution: { mood: string; count: number }[]\n}\n\ninterface BackendWorldTimeDto {\n  gameTime: string\n  speed: number\n}\n\ninterface BackendAgentMessageDto {\n  messageId: string\n  agentId: string\n  userId: string\n  threadId: string\n  role: string\n  content: string\n  createdAt: string\n  correlationId?: string\n}\n\ninterface BackendPagedResultDto<TItem> {\n  items: TItem[]\n  pagination: {\n    limit: number\n    returned: number\n  }\n}\n\ninterface BackendCommandAckDto {\n  agentId: string\n  userId: string\n  correlationId: string\n  status: string\n  acceptedAt: string\n}\n\ninterface BackendBroadcastCommandItemDto {\n  agentId: string\n  status: string\n  correlationId?: string\n  reason?: string\n}\n\ninterface BackendBroadcastCommandAckDto {\n  userId: string\n  acceptedAt: string\n  acceptedCount: number\n  rejectedCount: number\n  items: BackendBroadcastCommandItemDto[]\n}\n\nconst BACKEND_API_BASE = \"/api/backend\"\nconst DEFAULT_USER_ID = \"demo-user\"\n\nfunction getUserId(): string {\n  const fromEnv = process.env.NEXT_PUBLIC_USER_ID?.trim()\n  return fromEnv && fromEnv.length > 0 ? fromEnv : DEFAULT_USER_ID\n}\n\nasync function backendRequest<T>(path: string, init?: RequestInit): Promise<T> {\n  const headers = new Headers(init?.headers)\n  headers.set(\"Accept\", \"application/json\")\n  headers.set(\"X-User-Id\", getUserId())\n  if (init?.body && !headers.has(\"Content-Type\")) {\n    headers.set(\"Content-Type\", \"application/json\")\n  }\n\n  const response = await fetch(`${BACKEND_API_BASE}${path}`, {\n    ...init,\n    headers,\n    cache: \"no-store\",\n  })\n\n  if (!response.ok) {\n    throw new Error(`Backend request failed: ${response.status} ${response.statusText}`)\n  }\n\n  return (await response.json()) as T\n}\n\nfunction toMood(status: string, energyRaw: number, emotionRaw?: string): Mood {\n  const statusLower = status.toLowerCase()\n  const emotion = emotionRaw?.trim().toLowerCase() ?? \"\"\n  const energy = Number.isFinite(energyRaw) ? Math.max(0, Math.min(1, energyRaw)) : 0.5\n\n  if (emotion.includes(\"радост\") || emotion.includes(\"счаст\") || emotion.includes(\"вдохнов\") || emotion.includes(\"воодуш\")) return \"happy\"\n  if (emotion.includes(\"спокой\") || emotion.includes(\"нейтрал\")) return \"neutral\"\n  if (emotion.includes(\"устал\") || emotion.includes(\"груст\")) return \"sad\"\n  if (emotion.includes(\"раздраж\") || emotion.includes(\"зл\")) return \"angry\"\n  if (emotion.includes(\"тревог\") || emotion.includes(\"напряж\")) return \"anxious\"\n\n  if (statusLower.includes(\"error\") || statusLower.includes(\"failed\")) return \"angry\"\n  if (statusLower.includes(\"stop\") || statusLower.includes(\"archived\")) return \"sad\"\n  if (statusLower.includes(\"pause\")) return \"anxious\"\n  if (energy >= 0.8) return \"excited\"\n  if (energy >= 0.6) return \"happy\"\n  if (energy >= 0.4) return \"neutral\"\n  if (energy >= 0.2) return \"anxious\"\n  return \"sad\"\n}\n\nfunction toTraits(traits?: BackendPersonalityTraits, explicitTraits?: string[]): string[] {\n  if (explicitTraits && explicitTraits.length > 0) {\n    return explicitTraits.slice(0, 8)\n  }\n\n  if (!traits) return [\"adaptive\"]\n\n  const labels: Array<{ key: keyof BackendPersonalityTraits; label: string }> = [\n    { key: \"openness\", label: \"curious\" },\n    { key: \"conscientiousness\", label: \"disciplined\" },\n    { key: \"extraversion\", label: \"social\" },\n    { key: \"agreeableness\", label: \"cooperative\" },\n    { key: \"neuroticism\", label: \"sensitive\" },\n  ]\n\n  const sorted = labels\n    .map((item) => ({ label: item.label, value: Number(traits[item.key] ?? 0) }))\n    .sort((a, b) => b.value - a.value)\n    .filter((item) => item.value > 0)\n    .slice(0, 3)\n    .map((item) => item.label)\n\n  return sorted.length > 0 ? sorted : [\"adaptive\"]\n}\n\nfunction mapBackendAgent(agent: BackendAgentDto): Agent {\n  const mood = toMood(agent.status, agent.energy, agent.emotion)\n  const traits = toTraits(agent.personalityTraits, agent.traits)\n  const memories =\n    agent.memories && agent.memories.length > 0\n      ? agent.memories\n      : agent.state\n        ? [`Current state: ${agent.state}`]\n        : []\n  return {\n    id: agent.agentId,\n    name: agent.name,\n    avatar: agent.name?.trim()?.charAt(0)?.toUpperCase() || \"?\",\n    mood,\n    traits,\n    description: agent.description?.trim() || `${agent.model} - status: ${agent.status}`,\n    currentPlan: agent.currentPlan?.trim() || agent.state || \"No current plan\",\n    memories,\n  }\n}\n\nfunction asRecord(input: unknown): Record<string, unknown> | null {\n  if (!input || typeof input !== \"object\" || Array.isArray(input)) return null\n  return input as Record<string, unknown>\n}\n\nfunction readString(record: Record<string, unknown> | null, keys: string[]): string | undefined {\n  if (!record) return undefined\n  for (const key of keys) {\n    const value = record[key]\n    if (typeof value === \"string\" && value.trim().length > 0) return value.trim()\n  }\n  return undefined\n}\n\nfunction normalizeEventType(rawType: string): AgentEvent[\"type\"] {\n  const t = rawType.toLowerCase()\n  if (t.includes(\"chat\") || t.includes(\"message\")) return \"chat\"\n  if (t.includes(\"emotion\") || t.includes(\"mood\")) return \"emotion\"\n  if (t.includes(\"system\") || t.includes(\"status\") || t.includes(\"error\") || t.includes(\"progress\")) return \"system\"\n  return \"action\"\n}\n\nfunction payloadToText(payload: unknown, eventType: string): string {\n  const record = asRecord(payload)\n  const directText = readString(record, [\"text\", \"message\", \"description\", \"content\"])\n  if (directText) return directText\n  if (record) {\n    const nested = asRecord(record.payload)\n    const nestedText = readString(nested, [\"text\", \"message\", \"description\", \"content\"])\n    if (nestedText) return nestedText\n  }\n\n  try {\n    const json = JSON.stringify(payload)\n    if (!json || json === \"{}\") return eventType\n    return json.slice(0, 200)\n  } catch {\n    return eventType\n  }\n}\n\nfunction mapBackendEvent(event: BackendEventDto, agentsById: Map<string, Agent>): AgentEvent {\n  const record = asRecord(event.payload)\n  const nested = asRecord(record?.payload)\n  const source = nested ?? record\n\n  const agentId =\n    readString(source, [\"agentId\", \"agent_id\", \"id\"]) ??\n    readString(asRecord(source?.agent), [\"id\", \"agentId\"]) ??\n    \"system\"\n\n  const agentName =\n    readString(source, [\"agentName\", \"agent_name\", \"name\"]) ??\n    agentsById.get(agentId)?.name ??\n    \"System\"\n\n  return {\n    id: event.id,\n    agentId,\n    agentName,\n    type: normalizeEventType(event.type),\n    text: payloadToText(event.payload, event.type),\n    timestamp: event.createdAt,\n  }\n}\n\nfunction normalizeMessageRole(roleRaw: string): AgentMessageRole {\n  const role = roleRaw.trim().toLowerCase()\n  if (role === \"user\" || role === \"assistant\" || role === \"system\") {\n    return role\n  }\n\n  return \"assistant\"\n}\n\nfunction mapBackendMessage(\n  message: BackendAgentMessageDto,\n  agentsById: Map<string, Agent>\n): AgentConversationMessage {\n  return {\n    id: message.messageId,\n    agentId: message.agentId,\n    agentName: agentsById.get(message.agentId)?.name ?? \"Agent\",\n    role: normalizeMessageRole(message.role),\n    content: message.content,\n    timestamp: message.createdAt,\n    correlationId: message.correlationId,\n  }\n}\n\nfunction buildRelationshipsFromEvents(events: AgentEvent[], agents: Agent[]): Relationship[] {\n  const existingIds = new Set(agents.map((a) => a.id))\n  const relCounts = new Map<string, number>()\n\n  for (let i = 1; i < events.length; i += 1) {\n    const previous = events[i - 1]\n    const current = events[i]\n    if (\n      previous.agentId === current.agentId ||\n      previous.agentId === \"system\" ||\n      current.agentId === \"system\" ||\n      !existingIds.has(previous.agentId) ||\n      !existingIds.has(current.agentId)\n    ) {\n      continue\n    }\n\n    const key = `${previous.agentId}|${current.agentId}`\n    relCounts.set(key, (relCounts.get(key) ?? 0) + 1)\n  }\n\n  return Array.from(relCounts.entries())\n    .map(([key, count]) => {\n      const [from, to] = key.split(\"|\")\n      return {\n        from,\n        to,\n        sentiment: Math.min(0.8, count / 5),\n        label: \"interaction\",\n      } satisfies Relationship\n    })\n    .slice(0, 80)\n}\n\nfunction buildStats(agents: Agent[], events: AgentEvent[], relationships: Relationship[]): WorldStats {\n  const moodWeight: Record<Mood, number> = {\n    happy: 0.8,\n    neutral: 0.5,\n    sad: 0.2,\n    angry: 0.15,\n    excited: 0.9,\n    anxious: 0.35,\n  }\n\n  const eventTypeOrder: AgentEvent[\"type\"][] = [\"chat\", \"action\", \"emotion\", \"system\"]\n  const eventsByType = eventTypeOrder.map((type) => ({\n    type,\n    count: events.filter((e) => e.type === type).length,\n  }))\n\n  const moodDistribution = (Object.keys(MOOD_CONFIG) as Mood[]).map((mood) => ({\n    mood,\n    count: agents.filter((a) => a.mood === mood).length,\n  }))\n\n  const avgMood =\n    agents.length === 0\n      ? 0\n      : agents.reduce((sum, agent) => sum + moodWeight[agent.mood], 0) / agents.length\n\n  const activity = new Map<string, number>()\n  for (const event of events) {\n    if (event.agentId !== \"system\") {\n      activity.set(event.agentId, (activity.get(event.agentId) ?? 0) + 1)\n    }\n  }\n\n  const mostActiveAgentId =\n    Array.from(activity.entries()).sort((a, b) => b[1] - a[1])[0]?.[0] ?? agents[0]?.id ?? \"-\"\n  const mostActiveAgent = agents.find((a) => a.id === mostActiveAgentId)?.name ?? mostActiveAgentId\n\n  const topRelationshipRaw = relationships\n    .slice()\n    .sort((a, b) => Math.abs(b.sentiment) - Math.abs(a.sentiment))[0]\n\n  const topRelationship = topRelationshipRaw\n    ? {\n        from: agents.find((a) => a.id === topRelationshipRaw.from)?.name ?? topRelationshipRaw.from,\n        to: agents.find((a) => a.id === topRelationshipRaw.to)?.name ?? topRelationshipRaw.to,\n        sentiment: topRelationshipRaw.sentiment,\n      }\n    : { from: \"-\", to: \"-\", sentiment: 0 }\n\n  return {\n    totalEvents: events.length,\n    totalConversations: eventsByType.find((x) => x.type === \"chat\")?.count ?? 0,\n    avgMood,\n    mostActiveAgent,\n    topRelationship,\n    eventsByType,\n    moodDistribution,\n  }\n}\n\nfunction normalizeMood(rawMood: string): Mood {\n  const mood = rawMood.trim().toLowerCase()\n  if (mood === \"happy\" || mood === \"neutral\" || mood === \"sad\" || mood === \"angry\" || mood === \"excited\" || mood === \"anxious\") {\n    return mood\n  }\n\n  return \"neutral\"\n}\n\nfunction mapBackendStats(stats: BackendWorldStatsDto): WorldStats {\n  return {\n    totalEvents: stats.totalEvents,\n    totalConversations: stats.totalConversations,\n    avgMood: stats.avgMood,\n    mostActiveAgent: stats.mostActiveAgent,\n    topRelationship: stats.topRelationship,\n    eventsByType: stats.eventsByType,\n    moodDistribution: stats.moodDistribution.map((item) => ({\n      mood: normalizeMood(item.mood),\n      count: item.count,\n    })),\n  }\n}\n\nexport interface WorldTime {\n  gameTime: string\n  speed: number\n}\n\nexport async function addEvent(text: string): Promise<boolean> {\n  const payload = {\n    type: \"ui.note\",\n    payload: {\n      text,\n      message: text,\n      source: \"frontend\",\n      agentName: \"Operator\",\n    },\n  }\n\n  try {\n    await backendRequest<unknown>(\"/api/events\", {\n      method: \"POST\",\n      body: JSON.stringify(payload),\n    })\n    return true\n  } catch (error) {\n    console.warn(\"[data] addEvent fallback, backend unavailable\", error)\n    return false\n  }\n}\n\nfunction getMockAgentName(agentId: string): string {\n  return MOCK_AGENTS.find((agent) => agent.id === agentId)?.name ?? agentId\n}\n\nfunction getMockAgentMessages(agentId: string, limit: number): AgentConversationMessage[] {\n  const source = MOCK_AGENT_MESSAGES.get(agentId) ?? []\n  return source.slice(-limit)\n}\n\nfunction getAllMockAgentMessages(limitPerAgent: number): AgentConversationMessage[] {\n  const combined = Array.from(MOCK_AGENT_MESSAGES.values())\n    .flatMap((messages) => messages.slice(-limitPerAgent))\n    .sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime())\n  return combined\n}\n\nfunction pushMockConversationMessage(agentId: string, role: AgentMessageRole, content: string, correlationId: string): void {\n  const target = MOCK_AGENT_MESSAGES.get(agentId) ?? []\n  target.push({\n    id: `mock-msg-${Math.random().toString(36).slice(2, 10)}`,\n    agentId,\n    agentName: getMockAgentName(agentId),\n    role,\n    content,\n    timestamp: new Date().toISOString(),\n    correlationId,\n  })\n  MOCK_AGENT_MESSAGES.set(agentId, target)\n}\n\nexport async function getAgentMessages(agentId: string, limit = 80): Promise<AgentConversationMessage[]> {\n  const trimmedId = agentId.trim()\n  if (!trimmedId) {\n    return []\n  }\n\n  try {\n    const [paged, agents] = await Promise.all([\n      backendRequest<BackendPagedResultDto<BackendAgentMessageDto>>(\n        `/api/user-agents/${encodeURIComponent(trimmedId)}/messages?limit=${Math.max(1, Math.floor(limit))}`\n      ),\n      getAgents(),\n    ])\n    const agentsById = new Map(agents.map((agent) => [agent.id, agent]))\n    return paged.items.map((message) => mapBackendMessage(message, agentsById))\n  } catch (error) {\n    console.warn(\"[data] getAgentMessages fallback to mock\", error)\n    return getMockAgentMessages(trimmedId, Math.max(1, Math.floor(limit)))\n  }\n}\n\nexport async function getAllAgentMessages(limitPerAgent = 20): Promise<AgentConversationMessage[]> {\n  const safeLimit = Math.max(1, Math.floor(limitPerAgent))\n  try {\n    const [paged, agents] = await Promise.all([\n      backendRequest<BackendPagedResultDto<BackendAgentMessageDto>>(\n        `/api/user-agents/messages?limitPerAgent=${safeLimit}`\n      ),\n      getAgents(),\n    ])\n    const agentsById = new Map(agents.map((agent) => [agent.id, agent]))\n    return paged.items.map((message) => mapBackendMessage(message, agentsById))\n  } catch (error) {\n    console.warn(\"[data] getAllAgentMessages fallback to mock\", error)\n    return getAllMockAgentMessages(safeLimit)\n  }\n}\n\nexport async function commandAgent(\n  agentId: string,\n  message: string,\n  command?: string\n): Promise<CommandAck | null> {\n  const trimmedAgentId = agentId.trim()\n  const trimmedMessage = message.trim()\n  const trimmedCommand = command?.trim()\n\n  if (!trimmedAgentId || (!trimmedMessage && !trimmedCommand)) {\n    return null\n  }\n\n  const payload = {\n    command: trimmedCommand || undefined,\n    message: trimmedMessage || undefined,\n  }\n\n  try {\n    const accepted = await backendRequest<BackendCommandAckDto>(\n      `/api/user-agents/${encodeURIComponent(trimmedAgentId)}/commands`,\n      {\n        method: \"POST\",\n        body: JSON.stringify(payload),\n      }\n    )\n\n    return {\n      agentId: accepted.agentId,\n      userId: accepted.userId,\n      correlationId: accepted.correlationId,\n      status: accepted.status,\n      acceptedAt: accepted.acceptedAt,\n    }\n  } catch (error) {\n    console.warn(\"[data] commandAgent fallback to mock\", error)\n    const correlationId = `mock-${Date.now().toString(36)}`\n    const userText = [trimmedCommand, trimmedMessage].filter(Boolean).join(\"\\n\")\n    pushMockConversationMessage(trimmedAgentId, \"user\", userText, correlationId)\n    pushMockConversationMessage(\n      trimmedAgentId,\n      \"assistant\",\n      `${getMockAgentName(trimmedAgentId)} получил команду и готов действовать.`,\n      correlationId\n    )\n    return {\n      agentId: trimmedAgentId,\n      userId: getUserId(),\n      correlationId,\n      status: \"Working\",\n      acceptedAt: new Date().toISOString(),\n    }\n  }\n}\n\nexport async function broadcastAgentCommand(\n  message: string,\n  options?: { command?: string; agentIds?: string[] }\n): Promise<BroadcastCommandAck | null> {\n  const trimmedMessage = message.trim()\n  const trimmedCommand = options?.command?.trim()\n  if (!trimmedMessage && !trimmedCommand) {\n    return null\n  }\n\n  const payload = {\n    command: trimmedCommand || undefined,\n    message: trimmedMessage || undefined,\n    agentIds: options?.agentIds && options.agentIds.length > 0 ? options.agentIds : undefined,\n  }\n\n  try {\n    const accepted = await backendRequest<BackendBroadcastCommandAckDto>(\n      \"/api/user-agents/commands/broadcast\",\n      {\n        method: \"POST\",\n        body: JSON.stringify(payload),\n      }\n    )\n\n    return {\n      userId: accepted.userId,\n      acceptedAt: accepted.acceptedAt,\n      acceptedCount: accepted.acceptedCount,\n      rejectedCount: accepted.rejectedCount,\n      items: accepted.items.map((item) => ({\n        agentId: item.agentId,\n        status: item.status,\n        correlationId: item.correlationId,\n        reason: item.reason,\n      })),\n    }\n  } catch (error) {\n    console.warn(\"[data] broadcastAgentCommand fallback to mock\", error)\n    const targetAgentIds = options?.agentIds?.filter((id) => id.trim().length > 0) ?? MOCK_AGENTS.map((agent) => agent.id)\n    const correlationBase = `mock-${Date.now().toString(36)}`\n    const items = targetAgentIds.map((agentId, index) => {\n      const correlationId = `${correlationBase}-${index + 1}`\n      const userText = [trimmedCommand, trimmedMessage].filter(Boolean).join(\"\\n\")\n      pushMockConversationMessage(agentId, \"user\", userText, correlationId)\n      pushMockConversationMessage(\n        agentId,\n        \"assistant\",\n        `${getMockAgentName(agentId)} получил общий сигнал и приступает к задаче.`,\n        correlationId\n      )\n      return {\n        agentId,\n        status: \"accepted\",\n        correlationId,\n      } satisfies BroadcastCommandItem\n    })\n\n    return {\n      userId: getUserId(),\n      acceptedAt: new Date().toISOString(),\n      acceptedCount: items.length,\n      rejectedCount: 0,\n      items,\n    }\n  }\n}\n\nexport async function generateAgentWithAi(prompt: string, model?: string): Promise<Agent | null> {\n  const trimmedPrompt = prompt.trim()\n  if (!trimmedPrompt) {\n    return null\n  }\n\n  const payload = {\n    prompt: trimmedPrompt,\n    model: model?.trim() || undefined,\n  }\n\n  try {\n    const created = await backendRequest<BackendAgentDto>(\"/api/user-agents/generate\", {\n      method: \"POST\",\n      body: JSON.stringify(payload),\n    })\n\n    return mapBackendAgent(created)\n  } catch (error) {\n    console.warn(\"[data] generateAgentWithAi failed\", error)\n    return null\n  }\n}\n\nexport async function deleteAgent(id: string): Promise<boolean> {\n  const trimmedId = id.trim()\n  if (!trimmedId) {\n    return false\n  }\n\n  try {\n    await backendRequest<unknown>(`/api/user-agents/${encodeURIComponent(trimmedId)}`, {\n      method: \"DELETE\",\n    })\n    return true\n  } catch (error) {\n    console.warn(\"[data] deleteAgent failed\", error)\n    return false\n  }\n}\n\nexport async function getAgents(): Promise<Agent[]> {\n  try {\n    const agents = await backendRequest<BackendAgentDto[]>(\"/api/user-agents\")\n    return agents.map(mapBackendAgent)\n  } catch (error) {\n    console.warn(\"[data] getAgents fallback to mock\", error)\n    return MOCK_AGENTS\n  }\n}\n\nexport async function getAgent(id: string): Promise<Agent | undefined> {\n  try {\n    const agent = await backendRequest<BackendAgentDto>(`/api/user-agents/${encodeURIComponent(id)}`)\n    return mapBackendAgent(agent)\n  } catch {\n    return MOCK_AGENTS.find((a) => a.id === id)\n  }\n}\n\nexport async function getEvents(): Promise<AgentEvent[]> {\n  try {\n    const [agents, events] = await Promise.all([\n      getAgents(),\n      backendRequest<BackendEventDto[]>(\"/api/events\"),\n    ])\n    const agentsById = new Map(agents.map((agent) => [agent.id, agent]))\n    return events.map((event) => mapBackendEvent(event, agentsById))\n  } catch (error) {\n    console.warn(\"[data] getEvents fallback to mock\", error)\n    return MOCK_EVENTS\n  }\n}\n\nexport async function getRelationships(): Promise<Relationship[]> {\n  try {\n    const relationships = await backendRequest<BackendRelationshipDto[]>(\"/api/relationships\")\n    return relationships.map((relationship) => ({\n      from: relationship.from,\n      to: relationship.to,\n      sentiment: relationship.sentiment,\n      label: relationship.label ?? \"interaction\",\n    }))\n  } catch (error) {\n    console.warn(\"[data] getRelationships fallback to mock\", error)\n    return MOCK_RELATIONSHIPS\n  }\n}\n\nexport async function getStats(): Promise<WorldStats> {\n  try {\n    const stats = await backendRequest<BackendWorldStatsDto>(\"/api/stats\")\n    return mapBackendStats(stats)\n  } catch (error) {\n    console.warn(\"[data] getStats fallback to mock\", error)\n    return MOCK_STATS\n  }\n}\n\nexport async function getWorldTime(): Promise<WorldTime | null> {\n  try {\n    const worldTime = await backendRequest<BackendWorldTimeDto>(\"/api/world/time\")\n    return {\n      gameTime: worldTime.gameTime,\n      speed: worldTime.speed,\n    }\n  } catch (error) {\n    console.warn(\"[data] getWorldTime failed\", error)\n    return null\n  }\n}\n\nexport async function setWorldTimeSpeed(speed: number): Promise<WorldTime | null> {\n  try {\n    const updated = await backendRequest<BackendWorldTimeDto>(\"/api/world/time/speed\", {\n      method: \"POST\",\n      body: JSON.stringify({ speed }),\n    })\n    return {\n      gameTime: updated.gameTime,\n      speed: updated.speed,\n    }\n  } catch (error) {\n    console.warn(\"[data] setWorldTimeSpeed failed\", error)\n    return null\n  }\n}\n\nexport async function advanceWorldTime(minutes: number): Promise<WorldTime | null> {\n  try {\n    const updated = await backendRequest<BackendWorldTimeDto>(\"/api/world/time/advance\", {\n      method: \"POST\",\n      body: JSON.stringify({ minutes }),\n    })\n    return {\n      gameTime: updated.gameTime,\n      speed: updated.speed,\n    }\n  } catch (error) {\n    console.warn(\"[data] advanceWorldTime failed\", error)\n    return null\n  }\n}\n\nexport async function resetWorldSimulation(): Promise<WorldTime | null> {\n  try {\n    const updated = await backendRequest<BackendWorldTimeDto>(\"/api/world/time/reset\", {\n      method: \"POST\",\n    })\n    return {\n      gameTime: updated.gameTime,\n      speed: updated.speed,\n    }\n  } catch (error) {\n    console.warn(\"[data] resetWorldSimulation failed\", error)\n    return null\n  }\n}\n\r\n\r\n\r\n"],"names":[],"mappings":"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A+B,MAAhB,IAAI,CAAC,MAAM,EACzB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,mBAAmB,MAAO,CAAE,MAAO,0BAA2B,UAAW,iCAAkC,WAAY,CAAE,WACrI,qCAMT,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAA,KAGP,Q2B/iB8C,CAAC,CCFC,QDEc,IAAO,CAAF,GAAM,CAAC,CAAC,eEFe,+BFS9C,ERFE,IAAA,IQEc,CCNhD,ANGiD,CAAC,AMHlD,ADM6D,IAAI,CAAC,CAAC,AAAE,CAAD,EjBHT,AiBGA,iCAA8C,CAAC,QAInG,CAAA,YAAA,CAAc,EAAA,kBAA+B,CAAC,CAAC,OpBd5C,ICCI,ACCA,EAAE,ACFT,ACAA,ACGA,AJFS,CKDR,ACCsC,ACDsC,ACA5E,CLAC,ACGA,AFHA,CKAiH,AFAhH,ACCuD,AEDvD,ECAE,AVAS,CEEC,ADDA,CYDR,AHAA,AEAA,ADAA,CRAC,CMAC,ADAgH,AMChH,ADDA,ANCuD,ADDvD,AMAmD,EECjD,ATEA,ADHA,AWAA,CCAC,CNAC,AKAA,AVGA,ADHA,CYAC,CJAoD,ACAnD,CI8BC,Cf5BU,AYDT,AbAS,CAAC,ACCA,ACFT,CYAC,AZAA,CaAC,EEGE,ETHE,AHAA,CDGC,AIHA,AFCuD,AHDvD,AEAA,AEAgH,CDCxD,ACDyD,AMChH,CAAC,AVDA,ACGA,CcDC,ITFI,CAAC,ANAA,ACGA,GOHsD,ACAnD,EbE1B,CICP,AmBMA,4BN4DE,CZhEE,AYgEgB,APlEhB,ANDA,CFEC,ACF2B,CcoEX,CACnB,CdrE4C,AKAtB,CAAA,ALAuB,CcmE7C,AjBpE2B,CAAC,AYE+H,CHC1H,ADFZ,AICuI,CHC1H,ADFZ,CSmEtB,CAAA,UAAA,CAAA,gCAEO,CAAP,GAQlB,MAAA,gCAiBS,CAAO,QACF,qBAmBS,CF1Cd,AE0CmC,CAAA,qDAsBhC,CAAA,CAAA,CAAA,CAAA,QACH,IAAI,CAAC,IAAI,CAAA,sBAGZ,qDX1I+B,EIAc,CAAC,CLEX,AIAA,EAAE,AJAA,ICFI,EDEE,EIAE,EAAE,KJAK,CIAC,AJAA,SIAS,CAAC,aHM/C,CUDC,CbHE,ASCD,ANItB,CS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","ignoreList":[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]}